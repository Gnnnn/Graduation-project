<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>eyedb: HIdx.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>HIdx.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* </span>
<a name="l00002"></a>00002 <span class="comment">   EyeDB Object Database Management System</span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 1994-2008 SYSRA</span>
<a name="l00004"></a>00004 <span class="comment">   </span>
<a name="l00005"></a>00005 <span class="comment">   EyeDB is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
<a name="l00007"></a>00007 <span class="comment">   License as published by the Free Software Foundation; either</span>
<a name="l00008"></a>00008 <span class="comment">   version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">   </span>
<a name="l00010"></a>00010 <span class="comment">   EyeDB is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment">   Lesser General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">   </span>
<a name="l00015"></a>00015 <span class="comment">   You should have received a copy of the GNU Lesser General Public</span>
<a name="l00016"></a>00016 <span class="comment">   License along with this library; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment">   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA </span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">/*</span>
<a name="l00021"></a>00021 <span class="comment">   Author: Eric Viara &lt;viara@sysra.com&gt;</span>
<a name="l00022"></a>00022 <span class="comment">*/</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#ifndef _eyedbsm_HIdx_</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#define _eyedbsm_HIdx_</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;eyedblib/machtypes.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;eyedbsm/Idx.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">namespace </span>eyedblib {
<a name="l00036"></a>00036   <span class="keyword">class </span>ThreadPool;
<a name="l00037"></a>00037   <span class="keyword">class </span>ThreadPerformer;
<a name="l00038"></a>00038 }
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#define HAS_ALLOC_BUFFER</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="keyword">namespace </span>eyedbsm {
<a name="l00043"></a>00043 
<a name="l00049"></a>00049   <span class="keyword">class </span>HIdxCursor;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> HIdxImplHintsCount = 8;
<a name="l00052"></a>00052   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> HIdxDataVarSize = ~0U;
<a name="l00053"></a>00053 
<a name="l00058"></a><a class="code" href="classeyedbsm_1_1HIdx.html">00058</a>   <span class="keyword">class </span><a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> : <span class="keyword">public</span> Idx {
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classeyedbsm_1_1HIdxCursor.html" title="Not yet documented.">HIdxCursor</a>;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#ifdef HAS_ALLOC_BUFFER</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>    AllocBuffer insert_buffer;
<a name="l00064"></a>00064     AllocBuffer makeobj_buffer;
<a name="l00065"></a>00065 <span class="preprocessor">#endif</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067   <span class="keyword">public</span>: <span class="comment">/* conceptually private */</span>
<a name="l00068"></a>00068     <span class="keyword">class </span>CellHeader;
<a name="l00069"></a>00069     <span class="keyword">class </span>CListObjHeader;
<a name="l00070"></a>00070     <span class="keyword">class </span>CListHeader;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="keyword">public</span>:
<a name="l00073"></a>00073     <span class="keyword">enum</span> HIdxKeyType {
<a name="l00074"></a>00074       stringType = 1,
<a name="l00075"></a>00075       dataType
<a name="l00076"></a>00076     };
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="keyword">struct </span>_Idx {
<a name="l00080"></a>00080       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idxtype;
<a name="l00081"></a>00081       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> object_count;
<a name="l00082"></a>00082       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mag_order;
<a name="l00083"></a>00083       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key_count;
<a name="l00084"></a>00084       <span class="keywordtype">short</span> dspid;
<a name="l00085"></a>00085       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keytype;
<a name="l00086"></a>00086       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keysz;
<a name="l00087"></a>00087       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz;
<a name="l00088"></a>00088       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset;
<a name="l00089"></a>00089       <span class="keywordtype">int</span> impl_hints[HIdxImplHintsCount];
<a name="l00090"></a>00090       <span class="keywordtype">void</span> trace(FILE *fd = stdout) <span class="keyword">const</span>;
<a name="l00091"></a>00091       std::string toString() <span class="keyword">const</span>;
<a name="l00092"></a>00092     };
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <span class="keyword">public</span>: <span class="comment">//@@@@ A.W just try to cure</span>
<a name="l00095"></a>00095     <span class="keyword">struct </span>_Idx hidx;
<a name="l00096"></a>00096   <span class="keyword">private</span>:
<a name="l00097"></a>00097     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mask;
<a name="l00098"></a>00098     Boolean pow2;
<a name="l00099"></a>00099     Boolean uextend;
<a name="l00100"></a>00100     Boolean data_grouped_by_key;
<a name="l00101"></a>00101     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> data_grouped_sizeof;
<a name="l00102"></a>00102     Oid treeoid;
<a name="l00103"></a>00103     Status stat;
<a name="l00104"></a>00104     DbHandle *dbh;
<a name="l00105"></a>00105     <span class="keywordtype">int</span> bsize;
<a name="l00106"></a>00106     hash_key_t hash_key;
<a name="l00107"></a>00107     <span class="keywordtype">void</span> *hash_data;
<a name="l00108"></a>00108     <span class="keywordtype">int</span> version;
<a name="l00109"></a>00109     Boolean nocopy;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="keyword">class </span>HKey {
<a name="l00112"></a>00112       <span class="keyword">const</span> <span class="keywordtype">void</span> *key;
<a name="l00113"></a>00113       <a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *hidx;
<a name="l00114"></a>00114       <span class="keywordtype">bool</span> _garbage;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="keyword">public</span>:
<a name="l00117"></a>00117 
<a name="l00118"></a>00118       HKey(<a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *hidx, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">bool</span> <a class="code" href="classeyedbsm_1_1HIdx.html#a61d870226eb26716189be5d45459a357" title="Not yet documented.">copy</a> = <span class="keyword">false</span>);
<a name="l00119"></a>00119       HKey(<span class="keyword">const</span> HKey &amp;);
<a name="l00120"></a>00120       HKey&amp; operator=(<span class="keyword">const</span> HKey &amp;);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122       <span class="keywordtype">int</span> operator&lt;(<span class="keyword">const</span> HKey &amp;okey)<span class="keyword"> const </span>{
<a name="l00123"></a>00123         <span class="keywordflow">return</span> hidx-&gt;cmp(key, okey.key, 0) &lt; 0 ? 1 : 0;
<a name="l00124"></a>00124       }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126       <span class="keyword">const</span> <span class="keywordtype">void</span> *getKey()<span class="keyword"> const </span>{<span class="keywordflow">return</span> key;}
<a name="l00127"></a>00127 
<a name="l00128"></a>00128       <span class="keywordtype">void</span> garbage() {
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (_garbage) {
<a name="l00130"></a>00130           free((<span class="keywordtype">char</span> *)key);
<a name="l00131"></a>00131           key = 0;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133       }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135       ~HKey() {
<a name="l00136"></a>00136         garbage();
<a name="l00137"></a>00137       }
<a name="l00138"></a>00138     };
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="keyword">friend</span> <span class="keyword">class </span>HKey;
<a name="l00141"></a>00141    
<a name="l00142"></a>00142     std::map&lt;HKey, std::vector&lt;const void *&gt; &gt; cache_map;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keyword">static</span> <span class="keywordtype">void</span> *copy_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, Boolean, Boolean *state = 0);
<a name="l00145"></a>00145     Status dumpMemoryMap(<span class="keyword">const</span> CListHeader &amp;, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg = <span class="stringliteral">&quot;&quot;</span>, FILE *fd = stdout);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     Status readCellHeader(<span class="keywordtype">int</span> off, <span class="keyword">const</span> Oid &amp;, CellHeader &amp;) <span class="keyword">const</span>;
<a name="l00148"></a>00148     Status writeCellHeader(<span class="keywordtype">int</span> off, <span class="keyword">const</span> Oid &amp;, <span class="keyword">const</span> CellHeader &amp;) <span class="keyword">const</span>;
<a name="l00149"></a>00149     Status readCListObjHeader(<span class="keyword">const</span> Oid &amp;, CListObjHeader &amp;) <span class="keyword">const</span>;
<a name="l00150"></a>00150     Status writeCListObjHeader(<span class="keyword">const</span> Oid &amp;, <span class="keyword">const</span> CListObjHeader &amp;) <span class="keyword">const</span>;
<a name="l00151"></a>00151     Status readCListHeader(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k, CListHeader &amp;chd) <span class="keyword">const</span>;
<a name="l00152"></a>00152     Status writeCListHeader(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k, <span class="keyword">const</span> CListHeader &amp;chd) <span class="keyword">const</span>;
<a name="l00153"></a>00153     Status readCListHeaders(CListHeader *&amp;chds) <span class="keyword">const</span>;
<a name="l00154"></a>00154     Status writeCListHeaders(<span class="keyword">const</span> CListHeader *chds) <span class="keyword">const</span>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     Status insertCell(<span class="keywordtype">int</span> offset, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size, CListObjHeader &amp;h,
<a name="l00157"></a>00157                       <span class="keyword">const</span> Oid &amp;koid) <span class="keyword">const</span>;
<a name="l00158"></a>00158     Status suppressCell(<span class="keywordtype">int</span> offset, CListObjHeader &amp;h, <span class="keyword">const</span> Oid &amp;koid) <span class="keyword">const</span>;
<a name="l00159"></a>00159     Status get_key(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;, <span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * = 0) <span class="keyword">const</span>;
<a name="l00160"></a>00160     <span class="keywordtype">int</span> cmp(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) <span class="keyword">const</span>;
<a name="l00161"></a>00161     Status count_manage(DbHandle *dbh, <span class="keywordtype">int</span> inc);
<a name="l00162"></a>00162     Status getCell(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size, CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k,
<a name="l00163"></a>00163                    Oid &amp;koid, CListObjHeader &amp;h, <span class="keywordtype">int</span> &amp;offset, CellHeader &amp;o);
<a name="l00164"></a>00164     Status insert_realize(CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, <span class="keyword">const</span> <span class="keywordtype">void</span> *key,
<a name="l00165"></a>00165                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size, <span class="keyword">const</span> <span class="keywordtype">void</span> *xdata,
<a name="l00166"></a>00166                           <span class="keyword">const</span> Oid &amp;koid, CListObjHeader &amp;h, <span class="keywordtype">int</span> offset,
<a name="l00167"></a>00167                           CellHeader &amp;o, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz);
<a name="l00168"></a>00168     Status insert_perform(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, std::vector&lt;const void *&gt; &amp;xdata_v, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz);
<a name="l00169"></a>00169     Status insert_perform(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *xdata, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz);
<a name="l00170"></a>00170     Status remove_perform(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *xdata, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz, Boolean *found, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **prdata, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *pdatacnt, <span class="keywordtype">int</span> *found_idx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> incr_alloc);
<a name="l00171"></a>00171     Status remove_realize(CListHeader *chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_key,
<a name="l00172"></a>00172                           <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *,
<a name="l00173"></a>00173                           <span class="keyword">const</span> CellHeader *, <span class="keyword">const</span> Oid *);
<a name="l00174"></a>00174     Status search_realize(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *found_cnt, Boolean found_any, <span class="keywordtype">void</span> * data);
<a name="l00175"></a>00175     Status getObjectToExtend(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size, CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k,
<a name="l00176"></a>00176                              Oid &amp;koid, CListObjHeader &amp;h, <span class="keywordtype">int</span> &amp;offset,
<a name="l00177"></a>00177                              CellHeader &amp;o, Boolean &amp;found);
<a name="l00178"></a>00178     Status extendObject(CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, <span class="keyword">const</span> Oid &amp;koid,
<a name="l00179"></a>00179                         CListObjHeader &amp;h, Boolean &amp;extended);
<a name="l00180"></a>00180     Status extendObject(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size, CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, Oid &amp;koid,
<a name="l00181"></a>00181                         CListObjHeader &amp;h, <span class="keywordtype">int</span> &amp;offset, CellHeader &amp;o,
<a name="l00182"></a>00182                         Boolean &amp;extended);
<a name="l00183"></a>00183     Boolean candidateForExtension(<span class="keyword">const</span> CListObjHeader &amp;);
<a name="l00184"></a>00184     Status makeObject(CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, Oid &amp;koid, <span class="keywordtype">int</span> &amp;offset,
<a name="l00185"></a>00185                       CListObjHeader &amp;h, CellHeader &amp;o, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> objsize);
<a name="l00186"></a>00186     <span class="keyword">static</span> <span class="keywordtype">bool</span> inFreeList(<span class="keyword">const</span> CListObjHeader &amp;h, <span class="keyword">const</span> CListHeader &amp;chd, <span class="keyword">const</span> Oid &amp;koid);
<a name="l00187"></a>00187     Status insertObjectInFreeList(CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, CListObjHeader &amp;h,
<a name="l00188"></a>00188                                   <span class="keyword">const</span> Oid &amp;koid);
<a name="l00189"></a>00189     Status suppressObjectFromFreeList(CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, CListObjHeader &amp;h,
<a name="l00190"></a>00190                                       <span class="keyword">const</span> Oid &amp;koid);
<a name="l00191"></a>00191     Status suppressObjectFromList(CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, CListObjHeader &amp;h,
<a name="l00192"></a>00192                                   <span class="keyword">const</span> Oid &amp;koid);
<a name="l00193"></a>00193     Status replaceObjectInList(CListHeader &amp;chd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chd_k, CListObjHeader &amp;h,
<a name="l00194"></a>00194                                <span class="keyword">const</span> Oid &amp;koid, <span class="keyword">const</span> Oid &amp;nkoid);
<a name="l00195"></a>00195     Status modifyObjectSize(<span class="keywordtype">int</span> osize, <span class="keywordtype">int</span> nsize, <span class="keyword">const</span> Oid &amp;koid, 
<a name="l00196"></a>00196                             Oid &amp;nkoid);
<a name="l00197"></a>00197     Status headPrint(FILE *, <span class="keywordtype">int</span>, Oid *, <span class="keywordtype">int</span>&amp;) <span class="keyword">const</span>;
<a name="l00198"></a>00198     Status getEntryCount(Oid *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; ) <span class="keyword">const</span>;
<a name="l00199"></a>00199     Status getHashObjectBusySize(<span class="keyword">const</span> Oid *koid, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;busysize,
<a name="l00200"></a>00200                                  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;count, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = 0) <span class="keyword">const</span>;
<a name="l00201"></a>00201     <span class="keyword">static</span> Status get_def_string_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len,
<a name="l00202"></a>00202                                           <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00203"></a>00203     <span class="keyword">static</span> Status get_def_nstring_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len,
<a name="l00204"></a>00204                                            <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00205"></a>00205     <span class="keyword">static</span> Status get_def_rawdata_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len,
<a name="l00206"></a>00206                                            <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00207"></a>00207     <span class="keyword">static</span> Status get_def_int16data_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key,
<a name="l00208"></a>00208                                              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00209"></a>00209     <span class="keyword">static</span> Status get_def_int32data_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key,
<a name="l00210"></a>00210                                              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00211"></a>00211     <span class="keyword">static</span> Status get_def_int64data_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key,
<a name="l00212"></a>00212                                              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00213"></a>00213     <span class="keyword">static</span> Status get_def_oiddata_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len,
<a name="l00214"></a>00214                                            <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00215"></a>00215     <span class="keyword">static</span> Status get_def_float32data_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key,
<a name="l00216"></a>00216                                                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len,
<a name="l00217"></a>00217                                                <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00218"></a>00218     <span class="keyword">static</span> Status get_def_float64data_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key,
<a name="l00219"></a>00219                                                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len,
<a name="l00220"></a>00220                                                <span class="keywordtype">void</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     Status get_string_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;) <span class="keyword">const</span>;
<a name="l00223"></a>00223     Status get_rawdata_hash_key(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;) <span class="keyword">const</span>;
<a name="l00224"></a>00224     <span class="keywordtype">void</span> printCellHeader(<span class="keyword">const</span> HIdx::CellHeader *o, <span class="keywordtype">int</span> offset) <span class="keyword">const</span>;
<a name="l00225"></a>00225     <span class="keywordtype">void</span> checkCellHeader(<span class="keywordtype">int</span> offset, <span class="keyword">const</span> Oid *koid) <span class="keyword">const</span>;
<a name="l00226"></a>00226     <span class="keywordtype">void</span> printCListObjHeader(<span class="keyword">const</span> HIdx::CListObjHeader *h) <span class="keyword">const</span>;
<a name="l00227"></a>00227     <span class="keywordtype">void</span> checkCListObjHeader(<span class="keyword">const</span> Oid *koid) <span class="keyword">const</span>;
<a name="l00228"></a>00228     <span class="keywordtype">void</span> checkChain(<span class="keyword">const</span> Oid *koid) <span class="keyword">const</span>;
<a name="l00229"></a>00229     <span class="keywordtype">void</span> checkChain(<span class="keyword">const</span> CListHeader *chd, <span class="keyword">const</span> std::string &amp;msg) <span class="keyword">const</span>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     <span class="keywordtype">void</span> set_hash_key();
<a name="l00232"></a>00232     Status destroy_r();
<a name="l00233"></a>00233     Status copy_realize(Idx *) <span class="keyword">const</span>;
<a name="l00234"></a>00234     <span class="keywordtype">void</span> init(DbHandle *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keytype, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keysz,
<a name="l00235"></a>00235               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset,
<a name="l00236"></a>00236               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz, <span class="keywordtype">short</span> dspid,
<a name="l00237"></a>00237               <span class="keywordtype">int</span> mag_order, <span class="keywordtype">int</span> key_count,
<a name="l00238"></a>00238               <span class="keyword">const</span> <span class="keywordtype">int</span> *impl_hints,
<a name="l00239"></a>00239               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> impl_hints_cnt);
<a name="l00240"></a>00240     KeyType keytype;
<a name="l00241"></a>00241     Status collapse_realize(<span class="keywordtype">short</span> dspid, <a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *idx_n);
<a name="l00242"></a>00242     Status h2x_datacnt_cpy(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *rdata, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *pdatacnt) <span class="keyword">const</span>;
<a name="l00243"></a>00243     Status x2h_datacnt_cpy(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *pdatacnt, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pdata) <span class="keyword">const</span>;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <span class="keyword">public</span>:
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <span class="keyword">enum</span> Hints {
<a name="l00248"></a>00248       IniSize_Hints,
<a name="l00249"></a>00249       IniObjCnt_Hints,
<a name="l00250"></a>00250       XCoef_Hints,
<a name="l00251"></a>00251       SzMax_Hints,
<a name="l00252"></a>00252       DataGroupedByKey_Hints
<a name="l00253"></a>00253     };
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MaxKeys;
<a name="l00256"></a>00256     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> VarSize;
<a name="l00257"></a>00257     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MagorderKeycountCoef;
<a name="l00258"></a>00258 
<a name="l00270"></a>00270     <a class="code" href="classeyedbsm_1_1HIdx.html#a550ece58eb70ec91d93d4b586b95666d" title="Not yet documented.">HIdx</a>(DbHandle *vh, KeyType type,
<a name="l00271"></a>00271          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz, <span class="keywordtype">short</span> dspid,
<a name="l00272"></a>00272          <span class="keywordtype">int</span> magorder, <span class="keywordtype">int</span> key_count = 0,
<a name="l00273"></a>00273          <span class="keyword">const</span> <span class="keywordtype">int</span> *impl_hints = 0,
<a name="l00274"></a>00274          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> impl_hints_cnt = 0);
<a name="l00275"></a>00275 
<a name="l00284"></a>00284     <a class="code" href="classeyedbsm_1_1HIdx.html#a550ece58eb70ec91d93d4b586b95666d" title="Not yet documented.">HIdx</a>(DbHandle *vh, <span class="keyword">const</span> Oid *poid,
<a name="l00285"></a>00285          hash_key_t hash_key = 0,
<a name="l00286"></a>00286          <span class="keywordtype">void</span> *hash_data = 0,
<a name="l00287"></a>00287          Boolean (*precmp)(<span class="keywordtype">void</span> <span class="keyword">const</span> * p, <span class="keywordtype">void</span> <span class="keyword">const</span> * q,
<a name="l00288"></a>00288                            KeyType <span class="keyword">const</span> * type, <span class="keywordtype">int</span> &amp; r) = 0);
<a name="l00289"></a>00289 
<a name="l00296"></a>00296     <span class="keywordtype">void</span> <a class="code" href="classeyedbsm_1_1HIdx.html#ad63311b1209b685bfdf8a23e34c18b52" title="Not yet documented.">open</a>(hash_key_t hash_key = 0,
<a name="l00297"></a>00297               <span class="keywordtype">void</span> *hash_data = 0,
<a name="l00298"></a>00298               Boolean (*precmp)(<span class="keywordtype">void</span> <span class="keyword">const</span> * p, <span class="keywordtype">void</span> <span class="keyword">const</span> * q,
<a name="l00299"></a>00299                                 KeyType <span class="keyword">const</span> * type, <span class="keywordtype">int</span> &amp; r) = 0);
<a name="l00300"></a>00300 
<a name="l00305"></a>00305     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classeyedbsm_1_1HIdx.html#a4a1776668092d49a37a337cc92523e0f" title="Not yet documented.">getCount</a>() <span class="keyword">const</span>;
<a name="l00306"></a>00306 
<a name="l00311"></a>00311     <span class="keywordtype">short</span> <a class="code" href="classeyedbsm_1_1HIdx.html#a56f76f7a34686d98c6a216a32bef7549" title="Not yet documented.">getDefaultDspid</a>() <span class="keyword">const</span>;
<a name="l00312"></a>00312 
<a name="l00317"></a>00317     <span class="keywordtype">void</span> <a class="code" href="classeyedbsm_1_1HIdx.html#a63fe975871302cba2e5428ad47b65b1f" title="Not yet documented.">setDefaultDspid</a>(<span class="keywordtype">short</span> dspid);
<a name="l00318"></a>00318 
<a name="l00325"></a>00325     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a7327abf781c4a5612579f21edc34b830" title="Not yet documented.">getObjects</a>(Oid *&amp;oids, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;cnt) <span class="keyword">const</span>;
<a name="l00326"></a>00326 
<a name="l00331"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a0883029bcec4aabdb5900cbc9db93dc1">00331</a>     <span class="keyword">virtual</span> <a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *<a class="code" href="classeyedbsm_1_1HIdx.html#a0883029bcec4aabdb5900cbc9db93dc1" title="Not yet documented.">asHIdx</a>() {<span class="keywordflow">return</span> <span class="keyword">this</span>;}
<a name="l00332"></a>00332 
<a name="l00337"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a759e4f02cbe7fb9c489328872ffb6ba9">00337</a>     <span class="keyword">const</span> KeyType &amp; <a class="code" href="classeyedbsm_1_1HIdx.html#a759e4f02cbe7fb9c489328872ffb6ba9" title="Not yet documented.">getKeyType</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> keytype;}
<a name="l00338"></a>00338 
<a name="l00343"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a0bb5f3bea89611a69143809983ee5f00">00343</a>     <span class="keyword">const</span> HIdx::_Idx &amp; <a class="code" href="classeyedbsm_1_1HIdx.html#a0bb5f3bea89611a69143809983ee5f00" title="Not yet documented.">getIdx</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> hidx;}
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     ~<a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a>();
<a name="l00346"></a>00346   
<a name="l00353"></a>00353     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a6e08c1ba728aa7c4e0a8421694412f7e" title="Not yet documented.">insert</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *data);
<a name="l00354"></a>00354 
<a name="l00362"></a>00362     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a6e08c1ba728aa7c4e0a8421694412f7e" title="Not yet documented.">insert</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz);
<a name="l00363"></a>00363 
<a name="l00370"></a>00370     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a6e08c1ba728aa7c4e0a8421694412f7e" title="Not yet documented.">insert</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, std::vector&lt;const void *&gt; &amp;data_v);
<a name="l00371"></a>00371 
<a name="l00378"></a>00378     Status <a class="code" href="classeyedbsm_1_1HIdx.html#aab1d52d08d7b3f4d3523654f6d984479" title="Not yet documented.">insert_cache</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *data);
<a name="l00379"></a>00379 
<a name="l00386"></a>00386     Status <a class="code" href="classeyedbsm_1_1HIdx.html#aab1d52d08d7b3f4d3523654f6d984479" title="Not yet documented.">insert_cache</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, std::vector&lt;const void *&gt; &amp;data_v);
<a name="l00387"></a>00387 
<a name="l00392"></a>00392     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a54fef60f1dedcbf237513e413a5f0c4e" title="Not yet documented.">flush_cache</a>(<span class="keywordtype">bool</span> insert_data = <span class="keyword">true</span>);
<a name="l00393"></a>00393 
<a name="l00401"></a>00401     Status <span class="keyword">remove</span>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, Boolean *found = 0);
<a name="l00402"></a>00402 
<a name="l00411"></a>00411     Status <span class="keyword">remove</span>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datasz, Boolean *found = 0);
<a name="l00412"></a>00412 
<a name="l00420"></a>00420     Status <a class="code" href="classeyedbsm_1_1HIdx.html#aa1fce6266491b6cbd6b4905201d6b30d" title="Not yet documented.">search</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *found_cnt);
<a name="l00421"></a>00421 
<a name="l00429"></a>00429     Status <a class="code" href="classeyedbsm_1_1HIdx.html#ade18c6b5a84d3011de444b5e217a6c31" title="Not yet documented.">searchAny</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, Boolean *found, <span class="keywordtype">void</span> *data = 0);
<a name="l00430"></a>00430 
<a name="l00435"></a>00435     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a5d0f946b0e687d888e0da37a25dcca3b" title="Not yet documented.">destroy</a>();
<a name="l00436"></a>00436 
<a name="l00442"></a>00442     Status <a class="code" href="classeyedbsm_1_1HIdx.html#afd6d4edf2eb4c3bcf8dfcb66606f988b" title="Not yet documented.">printStat</a>(FILE *fd = stdout) <span class="keyword">const</span>;
<a name="l00443"></a>00443 
<a name="l00449"></a>00449     Status dumpMemoryMap(FILE *fd = stdout);
<a name="l00450"></a>00450 
<a name="l00455"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a1394aa7916e5cb8214280f96d6cce83a">00455</a>     Oid <span class="keyword">const</span>&amp; <a class="code" href="classeyedbsm_1_1HIdx.html#a1394aa7916e5cb8214280f96d6cce83a" title="Not yet documented.">oid</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> treeoid;}
<a name="l00456"></a>00456 
<a name="l00461"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a6edcbff89fe6e741ea297618b6cba094">00461</a>     Boolean <a class="code" href="classeyedbsm_1_1HIdx.html#a6edcbff89fe6e741ea297618b6cba094" title="Not yet documented.">isDataGroupedByKey</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> data_grouped_by_key;}
<a name="l00462"></a>00462 
<a name="l00467"></a><a class="code" href="classeyedbsm_1_1HIdx.html#af12d3e210afcd58ad73aa93908890a15">00467</a>     <span class="keywordtype">bool</span> <a class="code" href="classeyedbsm_1_1HIdx.html#af12d3e210afcd58ad73aa93908890a15" title="Not yet documented.">isDataVarSize</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> hidx.datasz == HIdxDataVarSize;}
<a name="l00468"></a>00468 
<a name="l00473"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a7cd65fb73e73f725ff5516dbe3c483c2">00473</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classeyedbsm_1_1HIdx.html#a7cd65fb73e73f725ff5516dbe3c483c2" title="Not yet documented.">getDataGroupedSizeof</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> data_grouped_sizeof;}
<a name="l00474"></a>00474 
<a name="l00479"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a7bd8908faa60890c69a91e4904fb780a">00479</a>     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a7bd8908faa60890c69a91e4904fb780a" title="Not yet documented.">status</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> stat;}
<a name="l00480"></a>00480 
<a name="l00485"></a><a class="code" href="classeyedbsm_1_1HIdx.html#a7580fdf0eae875286cda3167896a22b7">00485</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classeyedbsm_1_1HIdx.html#a7580fdf0eae875286cda3167896a22b7" title="Not yet documented.">getKeyCount</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> hidx.key_count;}
<a name="l00486"></a>00486 
<a name="l00491"></a>00491     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a53a17768b3c1414673efff597c0c18d3" title="Not yet documented.">collapse</a>();
<a name="l00492"></a>00492 
<a name="l00506"></a>00506     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a61d870226eb26716189be5d45459a357" title="Not yet documented.">copy</a>(<a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *&amp;idx_n, <span class="keywordtype">int</span> key_count, <span class="keywordtype">int</span> mag_order = 0,
<a name="l00507"></a>00507                 <span class="keywordtype">short</span> dspid = DefaultDspid,
<a name="l00508"></a>00508                 <span class="keyword">const</span> <span class="keywordtype">int</span> *impl_hints = 0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> impl_hints_cnt = 0,
<a name="l00509"></a>00509                 hash_key_t _hash_key = 0,
<a name="l00510"></a>00510                 <span class="keywordtype">void</span> *_hash_data = 0,
<a name="l00511"></a>00511                 KeyType *ktype = 0) <span class="keyword">const</span>;
<a name="l00512"></a>00512 
<a name="l00518"></a>00518     <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classeyedbsm_1_1HIdx.html#ada3505cfeb52a2ec93a35d05ff0817ad" title="Not yet documented.">getMagOrder</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keycount);
<a name="l00519"></a>00519 
<a name="l00525"></a>00525     <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classeyedbsm_1_1HIdx.html#a7580fdf0eae875286cda3167896a22b7" title="Not yet documented.">getKeyCount</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> magorder);
<a name="l00526"></a>00526 
<a name="l00532"></a>00532     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a328cc50cf1e6ab2148dba572d60a90b8" title="Not yet documented.">getStats</a>(std::string&amp; stats) <span class="keyword">const</span>;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="keyword">struct </span>Stats {
<a name="l00535"></a>00535       _Idx idx;
<a name="l00536"></a>00536       <span class="keyword">struct </span>Entry {
<a name="l00537"></a>00537         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> object_count;
<a name="l00538"></a>00538         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash_object_count;
<a name="l00539"></a>00539         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash_object_size;
<a name="l00540"></a>00540         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash_object_busy_size;
<a name="l00541"></a>00541       } *entries;
<a name="l00542"></a>00542       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> min_objects_per_entry;
<a name="l00543"></a>00543       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_objects_per_entry;
<a name="l00544"></a>00544       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_object_count;
<a name="l00545"></a>00545       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_hash_object_count;
<a name="l00546"></a>00546       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_hash_object_size;
<a name="l00547"></a>00547       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_hash_object_busy_size;
<a name="l00548"></a>00548       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> busy_key_count;
<a name="l00549"></a>00549       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> free_key_count;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       Stats();
<a name="l00552"></a>00552       ~Stats();
<a name="l00553"></a>00553       <span class="keywordtype">void</span> trace(Boolean full = True, FILE *fd = stdout) <span class="keyword">const</span>;
<a name="l00554"></a>00554       std::string toString(Boolean full = True) <span class="keyword">const</span>;
<a name="l00555"></a>00555     };
<a name="l00556"></a>00556 
<a name="l00562"></a>00562     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a328cc50cf1e6ab2148dba572d60a90b8" title="Not yet documented.">getStats</a>(HIdx::Stats &amp;stats) <span class="keyword">const</span>;
<a name="l00563"></a>00563 
<a name="l00569"></a>00569     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a384583150d8d84ec2a67df41ee8cf14c" title="Not yet documented.">move</a>(<span class="keywordtype">short</span> dspid, eyedbsm::Oid &amp;newoid,
<a name="l00570"></a>00570                 hash_key_t hash_key = 0,
<a name="l00571"></a>00571                 <span class="keywordtype">void</span> *hash_data = 0);
<a name="l00572"></a>00572 
<a name="l00586"></a>00586     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a24cc0af476fda37816e1849c0a3eadac" title="Not yet documented.">reimplementToHash</a>(Oid &amp;newoid, <span class="keywordtype">int</span> key_count, <span class="keywordtype">int</span> mag_order = 0,
<a name="l00587"></a>00587                              <span class="keywordtype">short</span> dspid = DefaultDspid,
<a name="l00588"></a>00588                              <span class="keyword">const</span> <span class="keywordtype">int</span> *impl_hints = 0,
<a name="l00589"></a>00589                              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> impl_hints_cnt = 0,
<a name="l00590"></a>00590                              hash_key_t hash_key = 0,
<a name="l00591"></a>00591                              <span class="keywordtype">void</span> *hash_data = 0,
<a name="l00592"></a>00592                              KeyType *ktype = 0);
<a name="l00593"></a>00593 
<a name="l00601"></a>00601     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a38d54561d762c58b656085e9ec4b472f" title="Not yet documented.">reimplementToBTree</a>(Oid &amp;newoid, <span class="keywordtype">int</span> degree = 0,
<a name="l00602"></a>00602                               <span class="keywordtype">short</span> dspid = DefaultDspid);
<a name="l00603"></a>00603 
<a name="l00615"></a>00615     Status <a class="code" href="classeyedbsm_1_1HIdx.html#a02421404f1d8338bb1be9ef1ff7106d4" title="Not yet documented.">simulate</a>(HIdx::Stats &amp;stats, <span class="keywordtype">int</span> key_count,
<a name="l00616"></a>00616                     <span class="keywordtype">int</span> mag_order = 0,
<a name="l00617"></a>00617                     <span class="keyword">const</span> <span class="keywordtype">int</span> *impl_hints = 0,
<a name="l00618"></a>00618                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> impl_hints_cnt = 0,
<a name="l00619"></a>00619                     hash_key_t hash_key = 0,
<a name="l00620"></a>00620                     <span class="keywordtype">void</span> *hash_data = 0) <span class="keyword">const</span>;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   <span class="keyword">public</span>: <span class="comment">/* conceptually private */</span>
<a name="l00623"></a>00623     <span class="keyword">struct </span>CellHeader {
<a name="l00624"></a>00624     <span class="keyword">public</span>:
<a name="l00625"></a>00625       eyedblib::uint32 free:1, size:31;
<a name="l00626"></a>00626       eyedblib::int32 cell_free_prev, cell_free_next;
<a name="l00627"></a>00627     };
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     <span class="keyword">struct </span>CListObjHeader {
<a name="l00630"></a>00630     <span class="keyword">public</span>:
<a name="l00631"></a>00631       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size;
<a name="l00632"></a>00632       eyedblib::uint16 free_cnt, alloc_cnt;
<a name="l00633"></a>00633       eyedblib::uint32 free_whole;
<a name="l00634"></a>00634       eyedblib::int32 cell_free_first;
<a name="l00635"></a>00635       Oid clobj_free_prev, clobj_free_next;
<a name="l00636"></a>00636       Oid clobj_prev, clobj_next;
<a name="l00637"></a>00637     };
<a name="l00638"></a>00638   
<a name="l00639"></a>00639     <span class="keyword">struct </span>CListHeader {
<a name="l00640"></a>00640     <span class="keyword">public</span>:
<a name="l00641"></a>00641       Oid clobj_first, clobj_last;
<a name="l00642"></a>00642       Oid clobj_free_first;
<a name="l00643"></a>00643     };
<a name="l00644"></a>00644   };
<a name="l00645"></a>00645 
<a name="l00649"></a><a class="code" href="classeyedbsm_1_1HIdxCursor.html">00649</a>   <span class="keyword">class </span><a class="code" href="classeyedbsm_1_1HIdxCursor.html" title="Not yet documented.">HIdxCursor</a> : <span class="keyword">public</span> IdxCursor {
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="keyword">const</span> <a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *idx;
<a name="l00652"></a>00652     <span class="keywordtype">void</span> *skey, *ekey;
<a name="l00653"></a>00653     Boolean sexcl, eexcl;
<a name="l00654"></a>00654     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> defaultSKey[];
<a name="l00655"></a>00655     <span class="keywordtype">char</span> *sdata, *edata, *cur;
<a name="l00656"></a>00656     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datacnt, idata;
<a name="l00657"></a>00657     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jumpsize;
<a name="l00658"></a>00658     Boolean nocopy;
<a name="l00659"></a>00659     Boolean data_tofree;
<a name="l00660"></a>00660     Status read(Boolean&amp; end);
<a name="l00661"></a>00661     Boolean equal;
<a name="l00662"></a>00662     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_cur, k_end;
<a name="l00663"></a>00663     <span class="keywordtype">int</span> cmp_realize(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *, Boolean, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) <span class="keyword">const</span>;
<a name="l00664"></a>00664     <span class="keywordtype">int</span> cmp(<span class="keyword">const</span> <span class="keywordtype">void</span> *) <span class="keyword">const</span>;
<a name="l00665"></a>00665     Oid koid;
<a name="l00666"></a>00666     Boolean state;
<a name="l00667"></a>00667     Boolean (*user_cmp)(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">void</span> *cmp_arg);
<a name="l00668"></a>00668     <span class="keywordtype">void</span> *cmp_arg;
<a name="l00669"></a>00669     <span class="keywordtype">void</span> append_next(<span class="keywordtype">void</span> *data, Idx::Key *key, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n, DataBuffer *dataBuffer);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordtype">void</span> init(DbHandle *);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     <span class="comment">// parallel management</span>
<a name="l00674"></a>00674     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> perf_cnt, perf_end_cnt;
<a name="l00675"></a>00675     Boolean master, slave;
<a name="l00676"></a>00676     <span class="keyword">class </span>LinkList;
<a name="l00677"></a>00677     Boolean parallelInit(<span class="keywordtype">int</span> thread_cnt);
<a name="l00678"></a>00678     eyedblib::ThreadPerformer **perfs;
<a name="l00679"></a>00679     <a class="code" href="classeyedbsm_1_1HIdxCursor.html" title="Not yet documented.">HIdxCursor</a> **perf_curs;
<a name="l00680"></a>00680     LinkList *list;
<a name="l00681"></a>00681     LinkList **lists;
<a name="l00682"></a>00682     eyedblib::ThreadPool *thrpool;
<a name="l00683"></a>00683     <a class="code" href="classeyedbsm_1_1HIdxCursor.html" title="Not yet documented.">HIdxCursor</a>(<span class="keyword">const</span> <a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *,
<a name="l00684"></a>00684                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_start,
<a name="l00685"></a>00685                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k_end,
<a name="l00686"></a>00686                <span class="keyword">const</span> <span class="keywordtype">void</span> *,
<a name="l00687"></a>00687                <span class="keyword">const</span> <span class="keywordtype">void</span> *,
<a name="l00688"></a>00688                Boolean,
<a name="l00689"></a>00689                Boolean,
<a name="l00690"></a>00690                Boolean (*user_cmp)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keywordtype">void</span> *),
<a name="l00691"></a>00691                <span class="keywordtype">void</span> *cmp_arg,
<a name="l00692"></a>00692                LinkList *);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     Status next(Boolean *found, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *found_cnt, <span class="keywordtype">void</span> *data, Idx::Key *key, DataBuffer *dataBuffer);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   <span class="keyword">public</span>:
<a name="l00708"></a>00708     <a class="code" href="classeyedbsm_1_1HIdxCursor.html" title="Not yet documented.">HIdxCursor</a>(<span class="keyword">const</span> <a class="code" href="classeyedbsm_1_1HIdx.html" title="Not yet documented.">HIdx</a> *idx,
<a name="l00709"></a>00709                <span class="keyword">const</span> <span class="keywordtype">void</span> *skey = 0,
<a name="l00710"></a>00710                <span class="keyword">const</span> <span class="keywordtype">void</span> *ekey = defaultSKey,
<a name="l00711"></a>00711                Boolean sexcl = False,
<a name="l00712"></a>00712                Boolean eexcl = False,
<a name="l00713"></a>00713                Boolean (*user_cmp)(<span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">void</span> *cmp_arg) = 0,
<a name="l00714"></a>00714                <span class="keywordtype">void</span> *cmp_arg = 0,
<a name="l00715"></a>00715                <span class="keywordtype">int</span> thread_cnt = 0);
<a name="l00716"></a>00716 
<a name="l00724"></a>00724     Status next(Boolean *found, <span class="keywordtype">void</span> *data = 0, Idx::Key *key = 0);
<a name="l00725"></a>00725 
<a name="l00733"></a>00733     Status next(Boolean *found, DataBuffer &amp;data, Idx::Key *key = 0);
<a name="l00734"></a>00734 
<a name="l00741"></a>00741     <span class="comment">// note: can be only used on data_grouped_by_key index</span>
<a name="l00742"></a>00742     Status next(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *found_cnt, Idx::Key *key = 0);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     ~<a class="code" href="classeyedbsm_1_1HIdxCursor.html" title="Not yet documented.">HIdxCursor</a>();
<a name="l00745"></a>00745   };
<a name="l00746"></a>00746 
<a name="l00751"></a>00751 };
<a name="l00752"></a>00752 
<a name="l00753"></a>00753 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 26 10:24:59 2010 for eyedb by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>

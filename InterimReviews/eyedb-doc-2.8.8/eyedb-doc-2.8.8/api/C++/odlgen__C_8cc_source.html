<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>eyedb: odlgen_C.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>odlgen_C.cc</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* </span>
<a name="l00002"></a>00002 <span class="comment">   EyeDB Object Database Management System</span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 1994-2008 SYSRA</span>
<a name="l00004"></a>00004 <span class="comment">   </span>
<a name="l00005"></a>00005 <span class="comment">   EyeDB is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment">   modify it under the terms of the GNU Lesser General Public</span>
<a name="l00007"></a>00007 <span class="comment">   License as published by the Free Software Foundation; either</span>
<a name="l00008"></a>00008 <span class="comment">   version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment">   </span>
<a name="l00010"></a>00010 <span class="comment">   EyeDB is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment">   Lesser General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment">   </span>
<a name="l00015"></a>00015 <span class="comment">   You should have received a copy of the GNU Lesser General Public</span>
<a name="l00016"></a>00016 <span class="comment">   License along with this library; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment">   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA </span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">/*</span>
<a name="l00021"></a>00021 <span class="comment">   Author: Eric Viara &lt;viara@sysra.com&gt;</span>
<a name="l00022"></a>00022 <span class="comment">*/</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;eyedb_p.h&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;CollectionBE.h&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;Attribute_p.h&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;odl.h&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">//#define DEF_PREFIX &quot;idb&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#define DEF_PREFIX &quot;&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="comment">//#define DEF_PREFIX2 &quot;idb&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#define DEF_PREFIX2 &quot;&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="preprocessor">#define NEW_ARGARR // 8/02/03</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#define NO_COMMENTS</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define NEW_COMP_POLICY</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#define IDBBOOL_STR(X) ((X) ? &quot;eyedb::True&quot; : &quot;eyedb::False&quot;)</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="preprocessor">#define ATTR_CACHE_DIRECT</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="comment">//#define NO_DIRECT_SET // added the 22/09/98</span>
<a name="l00044"></a>00044 <span class="preprocessor">#define SET_COUNT_DIRECT // added the 27/10/98</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#define ODL_STD_STRING</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="keyword">namespace </span>eyedb {
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   <span class="keyword">extern</span> Bool odl_smartptr;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="comment">// get pointer return form</span>
<a name="l00053"></a>00053   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *getPtrRet()
<a name="l00054"></a>00054   {
<a name="l00055"></a>00055     <span class="keywordflow">if</span> (odl_smartptr)
<a name="l00056"></a>00056       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Ptr &quot;</span>;
<a name="l00057"></a>00057     <span class="keywordflow">return</span> <span class="stringliteral">&quot;*&quot;</span>;
<a name="l00058"></a>00058   }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060   <span class="comment">// get pointer set form</span>
<a name="l00061"></a>00061   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *getPtrSet()
<a name="l00062"></a>00062   {
<a name="l00063"></a>00063     <span class="keywordflow">if</span> (odl_smartptr)
<a name="l00064"></a>00064       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Ptr &amp;&quot;</span>;
<a name="l00065"></a>00065     <span class="keywordflow">return</span> <span class="stringliteral">&quot;*&quot;</span>;
<a name="l00066"></a>00066   }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00069"></a>00069   gbx_suspend(GenContext *ctx)
<a name="l00070"></a>00070   {
<a name="l00071"></a>00071     fprintf(ctx-&gt;getFile(), <span class="stringliteral">&quot;%seyedb::gbxAutoGarbSuspender _gbxsusp_;\n&quot;</span>,
<a name="l00072"></a>00072             ctx-&gt;get());
<a name="l00073"></a>00073   }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> classSuffix[] = <span class="stringliteral">&quot;_Class&quot;</span>;
<a name="l00076"></a>00076   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> __agritems[] = <span class="stringliteral">&quot;getClass()-&gt;getAttributes()&quot;</span>;
<a name="l00077"></a>00077   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> __agrdyn[] = <span class="stringliteral">&quot;_attr&quot;</span>;
<a name="l00078"></a>00078   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> downCastPrefix[] = <span class="stringliteral">&quot;as&quot;</span>;
<a name="l00079"></a>00079   <span class="keyword">static</span> Bool class_enums;
<a name="l00080"></a>00080   <span class="keyword">static</span> Bool attr_cache;
<a name="l00081"></a>00081   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> enum_type[] = <span class="stringliteral">&quot;Type&quot;</span>;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#define STRBOOL(X) ((X) ? &quot;eyedb::True&quot; : &quot;eyedb::False&quot;)</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085 <span class="preprocessor">#define IS_STRING() (typmod.ndims == 1 &amp;&amp; \</span>
<a name="l00086"></a>00086 <span class="preprocessor">                     !strcmp(cls-&gt;getName(), char_class_name) &amp;&amp; \</span>
<a name="l00087"></a>00087 <span class="preprocessor">                     !isIndirect())</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a>00089 <span class="preprocessor">#define IS_RAW() (typmod.ndims == 1 &amp;&amp; \</span>
<a name="l00090"></a>00090 <span class="preprocessor">                  !strcmp(cls-&gt;getName(), byte_class_name) &amp;&amp; \</span>
<a name="l00091"></a>00091 <span class="preprocessor">                  !isIndirect())</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093 <span class="preprocessor">#define SCLASS()  (is_string ? &quot;char&quot; : &quot;unsigned char&quot;)</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#define SARGIN()  (is_string ? &quot;&quot; : &quot;, unsigned int len&quot;)</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#define SARGOUT() ((is_raw &amp;&amp; isVarDim()) ? &quot;unsigned int *len, &quot; : &quot;&quot;)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097   <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l00098"></a>00098   purge(<span class="keyword">const</span> <span class="keywordtype">char</span> *x)
<a name="l00099"></a>00099   {
<a name="l00100"></a>00100     <span class="keywordtype">char</span> *s = (<span class="keywordtype">char</span> *)malloc(2 * strlen(x) + 1);
<a name="l00101"></a>00101     <span class="keywordtype">char</span> *p = s;
<a name="l00102"></a>00102     <span class="keywordtype">char</span> c;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="keywordflow">while</span> (c = *x++)
<a name="l00105"></a>00105       {
<a name="l00106"></a>00106         <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;&quot;&apos;</span>)
<a name="l00107"></a>00107           {
<a name="l00108"></a>00108             *p++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l00109"></a>00109             *p++ = <span class="charliteral">&apos;&quot;&apos;</span>;
<a name="l00110"></a>00110           }
<a name="l00111"></a>00111         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\\&apos;</span>)
<a name="l00112"></a>00112           {
<a name="l00113"></a>00113             *p++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l00114"></a>00114             *p++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l00115"></a>00115           }
<a name="l00116"></a>00116         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l00117"></a>00117           *p++ = <span class="charliteral">&apos; &apos;</span>;
<a name="l00118"></a>00118         <span class="keywordflow">else</span>
<a name="l00119"></a>00119           *p++ = c;
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     *p = 0;
<a name="l00123"></a>00123     <span class="keywordflow">return</span> s;
<a name="l00124"></a>00124   }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00127"></a>00127   atc_set(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00128"></a>00128   {
<a name="l00129"></a>00129     <span class="keyword">static</span> <span class="keywordtype">char</span> _set[128];
<a name="l00130"></a>00130     sprintf(_set, <span class="stringliteral">&quot;__%s_isset__&quot;</span>, name);
<a name="l00131"></a>00131     <span class="keywordflow">return</span> _set;
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00135"></a>00135   atc_cnt(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00136"></a>00136   {
<a name="l00137"></a>00137     <span class="keyword">static</span> <span class="keywordtype">char</span> _cnt[128];
<a name="l00138"></a>00138     sprintf(_cnt, <span class="stringliteral">&quot;__%s_cnt__&quot;</span>, name);
<a name="l00139"></a>00139     <span class="keywordflow">return</span> _cnt;
<a name="l00140"></a>00140   }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00143"></a>00143   atc_name(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00144"></a>00144   {
<a name="l00145"></a>00145     <span class="keyword">static</span> <span class="keywordtype">char</span> _name[128];
<a name="l00146"></a>00146     sprintf(_name, <span class="stringliteral">&quot;__%s__&quot;</span>, name);
<a name="l00147"></a>00147     <span class="keywordflow">return</span> _name;
<a name="l00148"></a>00148   }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00151"></a>00151   atc_this(<span class="keyword">const</span> <span class="keywordtype">char</span> *classname)
<a name="l00152"></a>00152   {
<a name="l00153"></a>00153     <span class="keyword">static</span> <span class="keywordtype">char</span> _this[128];
<a name="l00154"></a>00154     sprintf(_this, <span class="stringliteral">&quot;((%s *)this)&quot;</span>, classname);
<a name="l00155"></a>00155     <span class="comment">//  return &quot;__this__&quot;;</span>
<a name="l00156"></a>00156     <span class="keywordflow">return</span> _this;
<a name="l00157"></a>00157   }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="preprocessor">#define RETURN_ERROR(FD, CTX, MCLASS, INDENT) \</span>
<a name="l00160"></a>00160 <span class="preprocessor">do { \</span>
<a name="l00161"></a>00161 <span class="preprocessor">  if ((MCLASS)-&gt;asEnumClass()) \</span>
<a name="l00162"></a>00162 <span class="preprocessor">    fprintf((FD), &quot;%s%sif (s) {if (rs) *rs = s; return (%s)0;}\n&quot;, (CTX)-&gt;get(), INDENT, \</span>
<a name="l00163"></a>00163 <span class="preprocessor">            className(MCLASS, False)); \</span>
<a name="l00164"></a>00164 <span class="preprocessor">  else \</span>
<a name="l00165"></a>00165 <span class="preprocessor">    fprintf((FD), &quot;%s%sif (s) {if (rs) *rs = s; return 0;}\n&quot;, (CTX)-&gt;get(), INDENT); \</span>
<a name="l00166"></a>00166 <span class="preprocessor">} while(0)</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a>00168 <span class="preprocessor">#define ATTRNAME(NAME, OPTYPE, HINTS) \</span>
<a name="l00169"></a>00169 <span class="preprocessor">  (HINTS).style-&gt;getString(GenCodeHints::OPTYPE, NAME)</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>
<a name="l00171"></a>00171 <span class="preprocessor">#define ATTRNAME_1(NAME, OPTYPE, HINTS) \</span>
<a name="l00172"></a>00172 <span class="preprocessor">  (HINTS).style-&gt;getString(OPTYPE, NAME)</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>
<a name="l00174"></a>00174 <span class="preprocessor">#define ATTRGET(CL) ((CL)-&gt;asCollectionClass() ? \</span>
<a name="l00175"></a>00175 <span class="preprocessor">                     GenCodeHints::tGetColl : GenCodeHints::tGet)</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00177"></a>00177 <span class="preprocessor">#define ATTRSET(CL) ((CL)-&gt;asCollectionClass() ? \</span>
<a name="l00178"></a>00178 <span class="preprocessor">                     GenCodeHints::tSetColl : GenCodeHints::tSet)</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a>00180   <span class="keyword">static</span> <span class="keyword">const</span> GenCodeHints *phints;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00183"></a>00183   make_int(<span class="keywordtype">int</span> i)
<a name="l00184"></a>00184   {
<a name="l00185"></a>00185     <span class="keyword">static</span> <span class="keywordtype">char</span> x[16];
<a name="l00186"></a>00186     sprintf(x, <span class="stringliteral">&quot;%d&quot;</span>, i);
<a name="l00187"></a>00187     <span class="keywordflow">return</span> x;
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00191"></a>00191   pre(<span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *pre)
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     <span class="keywordtype">int</span> len = strlen(pre);
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (!strncmp(name, pre, len))
<a name="l00195"></a>00195       {
<a name="l00196"></a>00196         name[len] += <span class="charliteral">&apos;A&apos;</span> - <span class="charliteral">&apos;a&apos;</span>;
<a name="l00197"></a>00197         <span class="keywordflow">return</span> 1;
<a name="l00198"></a>00198       }
<a name="l00199"></a>00199     <span class="keywordflow">return</span> 0;
<a name="l00200"></a>00200   }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *className(<span class="keyword">const</span> Class *cls,
<a name="l00203"></a>00203                                Bool makeC = True,
<a name="l00204"></a>00204                                Bool makeAlias = False)
<a name="l00205"></a>00205   {
<a name="l00206"></a>00206     <span class="keyword">const</span> <span class="keywordtype">char</span> *name = (makeAlias ? cls-&gt;getAliasName() : cls-&gt;getName());
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (!strncmp(name, <span class="stringliteral">&quot;set&lt;&quot;</span>, 4))
<a name="l00209"></a>00209       <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::CollSet&quot;</span>;
<a name="l00210"></a>00210   
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (!strncmp(name, <span class="stringliteral">&quot;bag&lt;&quot;</span>, 4))
<a name="l00212"></a>00212       <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::CollBag&quot;</span>;
<a name="l00213"></a>00213   
<a name="l00214"></a>00214     <span class="keywordflow">if</span> (!strncmp(name, <span class="stringliteral">&quot;array&lt;&quot;</span>, 6))
<a name="l00215"></a>00215       <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::CollArray&quot;</span>;
<a name="l00216"></a>00216   
<a name="l00217"></a>00217     <span class="keywordflow">if</span> (!strncmp(name, <span class="stringliteral">&quot;list&lt;&quot;</span>, 5))
<a name="l00218"></a>00218       <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::CollList&quot;</span>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; idbLAST_Type; i++)
<a name="l00221"></a>00221       <span class="keywordflow">if</span> (!strcmp(name, class_info[i].name))
<a name="l00222"></a>00222         <span class="keywordflow">return</span> Class::classNameToCName(name);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (makeC) {
<a name="l00225"></a>00225       <span class="keywordflow">if</span> (!strcmp(name, char_class_name))
<a name="l00226"></a>00226         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::Char&quot;</span>;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       <span class="keywordflow">if</span> (!strcmp(name, int32_class_name))
<a name="l00229"></a>00229         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::Int32&quot;</span>;
<a name="l00230"></a>00230     
<a name="l00231"></a>00231       <span class="keywordflow">if</span> (!strcmp(name, int64_class_name))
<a name="l00232"></a>00232         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::Int64&quot;</span>;
<a name="l00233"></a>00233       
<a name="l00234"></a>00234       <span class="keywordflow">if</span> (!strcmp(name, int16_class_name))
<a name="l00235"></a>00235         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::Int16&quot;</span>;
<a name="l00236"></a>00236       
<a name="l00237"></a>00237       <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;float&quot;</span>))
<a name="l00238"></a>00238         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::Float&quot;</span>;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240       <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;oid&quot;</span>))
<a name="l00241"></a>00241         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::OidP&quot;</span>;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243       <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;byte&quot;</span>))
<a name="l00244"></a>00244         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::Byte&quot;</span>;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246     <span class="keywordflow">else</span> {
<a name="l00247"></a>00247       <span class="keywordflow">if</span> (!strcmp(name, int32_class_name))
<a name="l00248"></a>00248         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedblib::int32&quot;</span>;
<a name="l00249"></a>00249     
<a name="l00250"></a>00250       <span class="keywordflow">if</span> (!strcmp(name, int64_class_name))
<a name="l00251"></a>00251         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedblib::int64&quot;</span>;
<a name="l00252"></a>00252     
<a name="l00253"></a>00253       <span class="keywordflow">if</span> (!strcmp(name, int16_class_name))
<a name="l00254"></a>00254         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedblib::int16&quot;</span>;
<a name="l00255"></a>00255     
<a name="l00256"></a>00256       <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;oid&quot;</span>))
<a name="l00257"></a>00257         <span class="keywordflow">return</span> <span class="stringliteral">&quot;eyedb::Oid&quot;</span>;
<a name="l00258"></a>00258     
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;byte&quot;</span>))
<a name="l00260"></a>00260         <span class="keywordflow">return</span> <span class="stringliteral">&quot;unsigned char&quot;</span>;
<a name="l00261"></a>00261     
<a name="l00262"></a>00262       <span class="keywordflow">if</span> (!strcmp(name, <span class="stringliteral">&quot;float&quot;</span>))
<a name="l00263"></a>00263         <span class="keywordflow">return</span> <span class="stringliteral">&quot;double&quot;</span>;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (cls-&gt;asEnumClass() &amp;&amp; class_enums) {
<a name="l00267"></a>00267       <span class="keywordflow">if</span> (Class::isBoolClass(cls)) {
<a name="l00268"></a>00268         <span class="keywordflow">return</span> cls-&gt;getCName(True);
<a name="l00269"></a>00269       }
<a name="l00270"></a>00270       <span class="keyword">static</span> std::string enum_s;
<a name="l00271"></a>00271       enum_s = std::string(name) + <span class="stringliteral">&quot;::&quot;</span> + enum_type;
<a name="l00272"></a>00272       <span class="keywordflow">return</span> enum_s.c_str();
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keyword">const</span> <span class="keywordtype">char</span> *sCName = Class::getSCName(name);
<a name="l00276"></a>00276     <span class="keywordflow">return</span> sCName ? sCName : name;
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <span class="keyword">static</span> <span class="keywordtype">void</span> dimArgsGen(FILE *fd, <span class="keywordtype">int</span> ndims, Bool named = True)
<a name="l00280"></a>00280   {
<a name="l00281"></a>00281     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ndims; i++)
<a name="l00282"></a>00282       {
<a name="l00283"></a>00283         <span class="keywordflow">if</span> (i)
<a name="l00284"></a>00284           fprintf(fd, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l00285"></a>00285         fprintf(fd, <span class="stringliteral">&quot;unsigned int&quot;</span>);
<a name="l00286"></a>00286         <span class="keywordflow">if</span> (named)
<a name="l00287"></a>00287           fprintf(fd, <span class="stringliteral">&quot; a%d&quot;</span>, i);
<a name="l00288"></a>00288       }
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   Status Attribute::generateClassDesc_C(GenContext *ctx)
<a name="l00292"></a>00292   {
<a name="l00293"></a>00293     FILE *fd = ctx-&gt;getFile();
<a name="l00294"></a>00294     <span class="keywordtype">int</span> ndims = typmod.ndims;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     fprintf(fd, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (ndims)
<a name="l00298"></a>00298       {
<a name="l00299"></a>00299         fprintf(fd, <span class="stringliteral">&quot;%sdims = new int[%d];\n&quot;</span>, ctx-&gt;get(), ndims);
<a name="l00300"></a>00300         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ndims; i++)
<a name="l00301"></a>00301           fprintf(fd, <span class="stringliteral">&quot;%sdims[%d] = %d;\n&quot;</span>, ctx-&gt;get(), i, typmod.dims[i]);
<a name="l00302"></a>00302       }
<a name="l00303"></a>00303     <span class="keywordflow">else</span>
<a name="l00304"></a>00304       fprintf(fd, <span class="stringliteral">&quot;%sdims = 0;\n&quot;</span>, ctx-&gt;get());
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     fprintf(fd, <span class="stringliteral">&quot;%sattr[%d] = new eyedb::Attribute(&quot;</span>, ctx-&gt;get(), num);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     <span class="keywordflow">if</span> (cls-&gt;asCollectionClass())
<a name="l00309"></a>00309       fprintf(fd, <span class="stringliteral">&quot;(m ? m-&gt;getClass(\&quot;%s\&quot;) : %s%s), \&quot;%s\&quot;, &quot;</span>,
<a name="l00310"></a>00310               cls-&gt;getAliasName(), cls-&gt;getCName(), classSuffix, name);
<a name="l00311"></a>00311     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cls-&gt;asEnumClass())
<a name="l00312"></a>00312       fprintf(fd, <span class="stringliteral">&quot;(m ? m-&gt;getClass(\&quot;%s\&quot;) : %s%s), \&quot;%s\&quot;, &quot;</span>,
<a name="l00313"></a>00313               cls-&gt;getAliasName(), cls-&gt;getCName(False), classSuffix, name);
<a name="l00314"></a>00314     <span class="keywordflow">else</span>
<a name="l00315"></a>00315       fprintf(fd, <span class="stringliteral">&quot;(m ? m-&gt;getClass(\&quot;%s\&quot;) : %s%s), \&quot;%s\&quot;, &quot;</span>,
<a name="l00316"></a>00316               cls-&gt;getAliasName(), className(cls), classSuffix, name);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     fprintf(fd, <span class="stringliteral">&quot;%s, %d, dims);\n&quot;</span>, (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() ? <span class="stringliteral">&quot;eyedb::True&quot;</span> : <span class="stringliteral">&quot;eyedb::False&quot;</span>), ndims);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="comment">/*</span>
<a name="l00321"></a>00321 <span class="comment">      fprintf(fd, &quot;%sattr[%d]-&gt;setMagOrder(%d);\n&quot;, ctx-&gt;get(), num,</span>
<a name="l00322"></a>00322 <span class="comment">      getMagOrder());</span>
<a name="l00323"></a>00323 <span class="comment">    */</span>
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (ndims)
<a name="l00326"></a>00326       fprintf(fd, <span class="stringliteral">&quot;%sdelete[] dims;\n&quot;</span>, ctx-&gt;get());
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="keywordflow">if</span> (inv_spec.clsname)
<a name="l00329"></a>00329       fprintf(fd, <span class="stringliteral">&quot;%sattr[%d]-&gt;setInverse(\&quot;%s\&quot;, \&quot;%s\&quot;);\n&quot;</span>, ctx-&gt;get(), num,
<a name="l00330"></a>00330               inv_spec.clsname, inv_spec.fname);
<a name="l00331"></a>00331     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inv_spec.item)
<a name="l00332"></a>00332       fprintf(fd, <span class="stringliteral">&quot;%sattr[%d]-&gt;setInverse(\&quot;%s\&quot;, \&quot;%s\&quot;);\n&quot;</span>, ctx-&gt;get(), num,
<a name="l00333"></a>00333               inv_spec.item-&gt;getClassOwner()-&gt;getName(), inv_spec.item-&gt;getName());
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">return</span> Success;
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   <span class="keyword">enum</span> OP {
<a name="l00339"></a>00339     op_GET = 1,
<a name="l00340"></a>00340     op_SET,
<a name="l00341"></a>00341     op_OTHER
<a name="l00342"></a>00342   };
<a name="l00343"></a>00343 
<a name="l00344"></a>00344   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00345"></a>00345   dynamic_attr_gen(FILE *fd, GenContext *ctx,
<a name="l00346"></a>00346                    <span class="keyword">const</span> Attribute *attr,
<a name="l00347"></a>00347                    OP <span class="keyword">set</span>,
<a name="l00348"></a>00348                    Bool isoid = False,
<a name="l00349"></a>00349                    Bool is_string = False,
<a name="l00350"></a>00350                    <span class="keyword">const</span> <span class="keywordtype">char</span> *cast = 0)
<a name="l00351"></a>00351   {
<a name="l00352"></a>00352     fprintf(fd, <span class="stringliteral">&quot;%sconst eyedb::Attribute *%s = getClass()-&gt;getAttribute(\&quot;%s\&quot;);\n&quot;</span>,
<a name="l00353"></a>00353             ctx-&gt;get(), __agrdyn, attr-&gt;getName());
<a name="l00354"></a>00354     fprintf(fd, <span class="stringliteral">&quot;%sif (!%s) {\n&quot;</span>, ctx-&gt;get(), __agrdyn);
<a name="l00355"></a>00355     ctx-&gt;push();
<a name="l00356"></a>00356     <span class="keywordflow">if</span> (<span class="keyword">set</span> == op_GET &amp;&amp; !isoid)
<a name="l00357"></a>00357       fprintf(fd, <span class="stringliteral">&quot;%sif (isnull) *isnull = eyedb::True;\n&quot;</span>, ctx-&gt;get());
<a name="l00358"></a>00358     fprintf(fd, <span class="stringliteral">&quot;%sif (dyn%s_error_policy) {\n&quot;</span>, ctx-&gt;get(), (<span class="keyword">set</span> ? <span class="stringliteral">&quot;set&quot;</span> : <span class="stringliteral">&quot;get&quot;</span>));
<a name="l00359"></a>00359     fprintf(fd, <span class="stringliteral">&quot;%s  eyedb::Status s = eyedb::Exception::make(eyedb::IDB_ATTRIBUTE_ERROR, &quot;</span>
<a name="l00360"></a>00360             <span class="stringliteral">&quot;\&quot;object %%s: attribute %%s::%%s not found\&quot;, oid.toString(), getClass()-&gt;getName(), \&quot;%s\&quot;);\n&quot;</span>,
<a name="l00361"></a>00361             ctx-&gt;get(), attr-&gt;getName());
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (<span class="keyword">set</span> == op_SET) {
<a name="l00363"></a>00363       fprintf(fd, <span class="stringliteral">&quot;%s  return s;\n&quot;</span>, ctx-&gt;get());
<a name="l00364"></a>00364       fprintf(fd, <span class="stringliteral">&quot;%s}\n&quot;</span>, ctx-&gt;get());
<a name="l00365"></a>00365       fprintf(fd, <span class="stringliteral">&quot;%sreturn eyedb::Success;\n&quot;</span>, ctx-&gt;get());
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367     <span class="keywordflow">else</span> {
<a name="l00368"></a>00368       fprintf(fd, <span class="stringliteral">&quot;%s  if (rs) *rs = s;\n&quot;</span>, ctx-&gt;get());
<a name="l00369"></a>00369       fprintf(fd, <span class="stringliteral">&quot;%s}\n&quot;</span>, ctx-&gt;get());
<a name="l00370"></a>00370       <span class="keywordflow">if</span> (isoid)
<a name="l00371"></a>00371         fprintf(fd, <span class="stringliteral">&quot;%sreturn nulloid;\n&quot;</span>, ctx-&gt;get());
<a name="l00372"></a>00372       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_string)
<a name="l00373"></a>00373         fprintf(fd, <span class="stringliteral">&quot;%sreturn \&quot;\&quot;;\n&quot;</span>, ctx-&gt;get());
<a name="l00374"></a>00374       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cast)
<a name="l00375"></a>00375         fprintf(fd, <span class="stringliteral">&quot;%sreturn (%s)0;\n&quot;</span>, ctx-&gt;get(), cast);
<a name="l00376"></a>00376       <span class="keywordflow">else</span>
<a name="l00377"></a>00377         fprintf(fd, <span class="stringliteral">&quot;%sreturn 0;\n&quot;</span>, ctx-&gt;get());
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379     ctx-&gt;pop();
<a name="l00380"></a>00380     fprintf(fd, <span class="stringliteral">&quot;%s}\n\n&quot;</span>, ctx-&gt;get());
<a name="l00381"></a>00381   }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   Status
<a name="l00384"></a>00384   Attribute::generateCollRealizeClassMethod_C(Class *own,
<a name="l00385"></a>00385                                               GenContext *ctx,
<a name="l00386"></a>00386                                               <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l00387"></a>00387                                               Bool isoid,
<a name="l00388"></a>00388                                               <span class="keywordtype">int</span> xacctype)
<a name="l00389"></a>00389   {
<a name="l00390"></a>00390     FILE *fd = ctx-&gt;getFile();
<a name="l00391"></a>00391     <span class="keywordtype">int</span> ndims = typmod.ndims, i;
<a name="l00392"></a>00392     <span class="keyword">const</span> <span class="keywordtype">char</span> *comma = (ndims ? <span class="stringliteral">&quot;, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00393"></a>00393     Bool _isref;
<a name="l00394"></a>00394     eyedblib::int16 _dim;
<a name="l00395"></a>00395     Class *cl =
<a name="l00396"></a>00396       ((CollectionClass *)cls)-&gt;getCollClass(&amp;_isref, &amp;_dim);
<a name="l00397"></a>00397     GenCodeHints::OpType acctype = (GenCodeHints::OpType)xacctype;
<a name="l00398"></a>00398     <span class="keyword">const</span> <span class="keywordtype">char</span> *etc = (acctype == GenCodeHints::tAddItemToColl ?
<a name="l00399"></a>00399                        <span class="stringliteral">&quot;, const eyedb::CollImpl *collimpl&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00400"></a>00400     <span class="keyword">const</span> <span class="keywordtype">char</span> *accmth = (acctype == GenCodeHints::tAddItemToColl ? <span class="stringliteral">&quot;insert&quot;</span> : <span class="stringliteral">&quot;suppress&quot;</span>);
<a name="l00401"></a>00401     <span class="keyword">const</span> <span class="keywordtype">char</span> *oclassname = _isref ?
<a name="l00402"></a>00402       className(cl, True) : className(cl, False);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     <span class="keywordflow">if</span> (isoid &amp;&amp; cl-&gt;asBasicClass())
<a name="l00405"></a>00405       <span class="keywordflow">return</span> Success;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="keyword">const</span> <span class="keywordtype">char</span> *cast = (cl-&gt;asBasicClass() ? <span class="stringliteral">&quot;(eyedb::Value)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keyword">const</span> <span class="keywordtype">char</span> *classname;
<a name="l00410"></a>00410     Bool ordered;
<a name="l00411"></a>00411     CollectionClass *mcoll = (CollectionClass *)cls;
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (mcoll-&gt;asCollSetClass())
<a name="l00413"></a>00413       {
<a name="l00414"></a>00414         classname = <span class="stringliteral">&quot;eyedb::CollSet&quot;</span>;
<a name="l00415"></a>00415         ordered = False;
<a name="l00416"></a>00416       }
<a name="l00417"></a>00417     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mcoll-&gt;asCollBagClass())
<a name="l00418"></a>00418       {
<a name="l00419"></a>00419         classname = <span class="stringliteral">&quot;eyedb::CollBag&quot;</span>;
<a name="l00420"></a>00420         ordered = False;
<a name="l00421"></a>00421       }
<a name="l00422"></a>00422     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mcoll-&gt;asCollArrayClass())
<a name="l00423"></a>00423       {
<a name="l00424"></a>00424         classname = <span class="stringliteral">&quot;eyedb::CollArray&quot;</span>;
<a name="l00425"></a>00425         ordered = True;
<a name="l00426"></a>00426       }
<a name="l00427"></a>00427     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mcoll-&gt;asCollListClass())
<a name="l00428"></a>00428       {
<a name="l00429"></a>00429         classname = <span class="stringliteral">&quot;eyedb::CollList&quot;</span>;
<a name="l00430"></a>00430         ordered = True;
<a name="l00431"></a>00431       }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <span class="keyword">const</span> <span class="keywordtype">char</span> *At = ((acctype == GenCodeHints::tAddItemToColl ||
<a name="l00434"></a>00434                        acctype == GenCodeHints::tRmvItemFromColl)
<a name="l00435"></a>00435                       &amp;&amp; ordered ? <span class="stringliteral">&quot;At&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="keyword">const</span> <span class="keywordtype">char</span> *etc1 = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00438"></a>00438     <span class="keyword">const</span> <span class="keywordtype">char</span> *etc2 = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00439"></a>00439     Bool rmv_from_array = (acctype == GenCodeHints::tRmvItemFromColl)
<a name="l00440"></a>00440       &amp;&amp; ordered ? True : False;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (rmv_from_array &amp;&amp; isoid)
<a name="l00443"></a>00443       <span class="keywordflow">return</span> Success;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     GenCodeHints::OpType nacctype;
<a name="l00446"></a>00446     <span class="keywordflow">if</span> (ordered)
<a name="l00447"></a>00447       nacctype = (acctype == GenCodeHints::tRmvItemFromColl ?
<a name="l00448"></a>00448                   GenCodeHints::tUnsetItemInColl :
<a name="l00449"></a>00449                   GenCodeHints::tSetItemInColl);
<a name="l00450"></a>00450     <span class="keywordflow">else</span>
<a name="l00451"></a>00451       nacctype = acctype;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (!*At)
<a name="l00454"></a>00454       {
<a name="l00455"></a>00455         <span class="keywordflow">if</span> (acctype == GenCodeHints::tAddItemToColl)
<a name="l00456"></a>00456           {
<a name="l00457"></a>00457             etc1 = <span class="stringliteral">&quot;, eyedb::Bool noDup&quot;</span>;
<a name="l00458"></a>00458             etc2 = <span class="stringliteral">&quot;, noDup&quot;</span>;
<a name="l00459"></a>00459           }
<a name="l00460"></a>00460         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (acctype == GenCodeHints::tRmvItemFromColl)
<a name="l00461"></a>00461           {
<a name="l00462"></a>00462             etc1 = <span class="stringliteral">&quot;, eyedb::Bool checkFirst&quot;</span>;
<a name="l00463"></a>00463             etc2 = <span class="stringliteral">&quot;, checkFirst&quot;</span>;
<a name="l00464"></a>00464           }
<a name="l00465"></a>00465       }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="keywordflow">if</span> (_dim == 1)
<a name="l00468"></a>00468       {
<a name="l00469"></a>00469         fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(%s%s&quot;</span>, className(own),
<a name="l00470"></a>00470                 ATTRNAME_1(name, nacctype, hints),
<a name="l00471"></a>00471                 (*At ? <span class="stringliteral">&quot;int where&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00472"></a>00472                 (*At &amp;&amp; (!rmv_from_array || ndims &gt;= 1) ? <span class="stringliteral">&quot;, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l00473"></a>00473         dimArgsGen(fd, ndims);
<a name="l00474"></a>00474         <span class="keywordflow">if</span> (rmv_from_array)
<a name="l00475"></a>00475           fprintf(fd, <span class="stringliteral">&quot;)\n{\n&quot;</span>);
<a name="l00476"></a>00476         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isoid)
<a name="l00477"></a>00477           fprintf(fd, <span class="stringliteral">&quot;%sconst eyedb::Oid &amp;_oid%s)\n{\n&quot;</span>, comma, etc);
<a name="l00478"></a>00478         <span class="keywordflow">else</span>
<a name="l00479"></a>00479           fprintf(fd, <span class="stringliteral">&quot;%s%s%s_%s%s%s)\n{\n&quot;</span>, comma, oclassname,
<a name="l00480"></a>00480                   (_isref || !cl-&gt;asBasicClass() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>), name,
<a name="l00481"></a>00481                   etc1, etc);
<a name="l00482"></a>00482       }
<a name="l00483"></a>00483     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cl-&gt;getName(), char_class_name) &amp;&amp; _dim &gt; 1)
<a name="l00484"></a>00484       {
<a name="l00485"></a>00485         fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(%s&quot;</span>, className(own),
<a name="l00486"></a>00486                 ATTRNAME_1(name, nacctype, hints),
<a name="l00487"></a>00487                 (*At ? <span class="stringliteral">&quot;int where, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l00488"></a>00488         dimArgsGen(fd, ndims);
<a name="l00489"></a>00489         fprintf(fd, <span class="stringliteral">&quot;%sconst char *_%s%s%s)\n{\n&quot;</span>, comma, name, etc1, etc);
<a name="l00490"></a>00490       }
<a name="l00491"></a>00491     <span class="keywordflow">else</span>
<a name="l00492"></a>00492       <span class="keywordflow">return</span> Success;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     gbx_suspend(ctx);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status status;\n&quot;</span>, ctx-&gt;get());
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     fprintf(fd, <span class="stringliteral">&quot;%s%s *_coll;\n&quot;</span>, ctx-&gt;get(), classname);
<a name="l00499"></a>00499     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Bool _not_set = eyedb::False;\n&quot;</span>, ctx-&gt;get());
<a name="l00500"></a>00500     <span class="keywordflow">if</span> (ndims &gt; 1)
<a name="l00501"></a>00501       {
<a name="l00502"></a>00502         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size from = a%d;\n&quot;</span>, ctx-&gt;get(), ndims-1);
<a name="l00503"></a>00503         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = ndims - 2 ; i &gt;= 0; i--)
<a name="l00504"></a>00504           fprintf(fd, <span class="stringliteral">&quot;%sfrom += a%d * %d;\n&quot;</span>, ctx-&gt;get(), i, typmod.dims[i]);
<a name="l00505"></a>00505       }
<a name="l00506"></a>00506     <span class="keywordflow">else</span>
<a name="l00507"></a>00507       fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size from = 0;\n&quot;</span>, ctx-&gt;get());
<a name="l00508"></a>00508   
<a name="l00509"></a>00509     <span class="keywordflow">if</span> (odl_dynamic_attr) {
<a name="l00510"></a>00510       dynamic_attr_gen(fd, ctx, <span class="keyword">this</span>, op_SET, isoid);
<a name="l00511"></a>00511       fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;getValue(this, (eyedb::Data *)&amp;_coll, 1, from);\n&quot;</span>,
<a name="l00512"></a>00512               ctx-&gt;get(), __agrdyn, name);
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514     <span class="keywordflow">else</span>
<a name="l00515"></a>00515       fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;getValue(this, (eyedb::Data *)&amp;_coll, 1, from);\n&quot;</span>,
<a name="l00516"></a>00516               ctx-&gt;get(), __agritems, num, name);
<a name="l00517"></a>00517     fprintf(fd, <span class="stringliteral">&quot;%sif (status)\n%s  return status;\n\n&quot;</span>, ctx-&gt;get(), ctx-&gt;get());
<a name="l00518"></a>00518     fprintf(fd, <span class="stringliteral">&quot;%sif (!_coll)\n&quot;</span>, ctx-&gt;get());
<a name="l00519"></a>00519     fprintf(fd, <span class="stringliteral">&quot;%s  {\n&quot;</span>, ctx-&gt;get());
<a name="l00520"></a>00520     ctx-&gt;push();
<a name="l00521"></a>00521     fprintf(fd, <span class="stringliteral">&quot;%s _not_set = eyedb::True;\n&quot;</span>, ctx-&gt;get());
<a name="l00522"></a>00522     fprintf(fd, <span class="stringliteral">&quot;%s eyedb::Oid _coll_oid;\n&quot;</span>, ctx-&gt;get());
<a name="l00523"></a>00523     <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00524"></a>00524       fprintf(fd, <span class="stringliteral">&quot;%s status = %s-&gt;getOid(this, &amp;_coll_oid, 1, from);\n&quot;</span>,
<a name="l00525"></a>00525               ctx-&gt;get(), __agrdyn, name);
<a name="l00526"></a>00526     <span class="keywordflow">else</span>
<a name="l00527"></a>00527       fprintf(fd, <span class="stringliteral">&quot;%s status = %s[%d]-&gt;getOid(this, &amp;_coll_oid, 1, from);\n&quot;</span>,
<a name="l00528"></a>00528               ctx-&gt;get(), __agritems, num, name);
<a name="l00529"></a>00529     fprintf(fd, <span class="stringliteral">&quot;%s if (status)\n%s  return status;\n\n&quot;</span>, ctx-&gt;get(), ctx-&gt;get());
<a name="l00530"></a>00530     fprintf(fd, <span class="stringliteral">&quot;%s if (_coll_oid.isValid())\n&quot;</span>, ctx-&gt;get());
<a name="l00531"></a>00531     fprintf(fd, <span class="stringliteral">&quot;%s   {\n&quot;</span>, ctx-&gt;get());
<a name="l00532"></a>00532     ctx-&gt;push();
<a name="l00533"></a>00533     fprintf(fd, <span class="stringliteral">&quot;%s status = db-&gt;loadObject(&amp;_coll_oid, (eyedb::Object **)&amp;_coll);\n&quot;</span>,
<a name="l00534"></a>00534             ctx-&gt;get());
<a name="l00535"></a>00535     fprintf(fd, <span class="stringliteral">&quot;%s if (status)\n%s  return status;\n&quot;</span>, ctx-&gt;get(), ctx-&gt;get());
<a name="l00536"></a>00536     ctx-&gt;pop();
<a name="l00537"></a>00537     fprintf(fd, <span class="stringliteral">&quot;%s   }\n&quot;</span>, ctx-&gt;get());
<a name="l00538"></a>00538     fprintf(fd, <span class="stringliteral">&quot;%s else\n&quot;</span>, ctx-&gt;get());
<a name="l00539"></a>00539     <span class="keywordflow">if</span> (acctype == GenCodeHints::tAddItemToColl)
<a name="l00540"></a>00540       {
<a name="l00541"></a>00541         fprintf(fd, <span class="stringliteral">&quot;%s   {\n&quot;</span>, ctx-&gt;get());
<a name="l00542"></a>00542         <span class="comment">// TBD: 2009-03-31: must have impl_type as parameter (or CollImpl)</span>
<a name="l00543"></a>00543         fprintf(fd, <span class="stringliteral">&quot;%s     _coll = new %s(db, \&quot;\&quot;, &quot;</span>
<a name="l00544"></a>00544                 <span class="stringliteral">&quot;db-&gt;getSchema()-&gt;getClass(\&quot;%s\&quot;), %s, collimpl);\n&quot;</span>,
<a name="l00545"></a>00545                 ctx-&gt;get(), classname,
<a name="l00546"></a>00546                 cl-&gt;getAliasName(), (_isref ? <span class="stringliteral">&quot;eyedb::True&quot;</span> : make_int(_dim)));
<a name="l00547"></a>00547         <span class="comment">//fprintf(fd, &quot;%s     _coll-&gt;setMagOrder(mag_order);\n&quot;, ctx-&gt;get());</span>
<a name="l00548"></a>00548         fprintf(fd, <span class="stringliteral">&quot;%s   }\n&quot;</span>, ctx-&gt;get());
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550     <span class="keywordflow">else</span>
<a name="l00551"></a>00551       fprintf(fd, <span class="stringliteral">&quot;%s    return eyedb::Exception::make(eyedb::IDB_ERROR, \&quot;no valid collection in attribute %s::%s\&quot;);\n\n&quot;</span>, ctx-&gt;get(), class_owner-&gt;getName(), name);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     ctx-&gt;pop();
<a name="l00554"></a>00554     fprintf(fd, <span class="stringliteral">&quot;%s  }\n&quot;</span>, ctx-&gt;get());
<a name="l00555"></a>00555     <span class="keywordflow">if</span> (rmv_from_array)
<a name="l00556"></a>00556       fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = _coll-&gt;suppressAt(where);\n&quot;</span>, ctx-&gt;get());
<a name="l00557"></a>00557     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isoid)
<a name="l00558"></a>00558       fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = _coll-&gt;%s%s(%s_oid);\n&quot;</span>, ctx-&gt;get(),
<a name="l00559"></a>00559               accmth, At, (*At ? <span class="stringliteral">&quot;where, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l00560"></a>00560     <span class="keywordflow">else</span>
<a name="l00561"></a>00561       fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = _coll-&gt;%s%s(%s%s_%s%s);\n&quot;</span>, ctx-&gt;get(),
<a name="l00562"></a>00562               accmth, At, (*At ? <span class="stringliteral">&quot;where, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>),  cast, name,
<a name="l00563"></a>00563               etc2);
<a name="l00564"></a>00564     fprintf(fd, <span class="stringliteral">&quot;%sif (status || !_not_set)\n%s  return status;\n\n&quot;</span>, ctx-&gt;get(), ctx-&gt;get());
<a name="l00565"></a>00565     <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00566"></a>00566       fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setValue(this, (eyedb::Data)&amp;_coll, 1, from);\n&quot;</span>,
<a name="l00567"></a>00567               ctx-&gt;get(), __agrdyn);
<a name="l00568"></a>00568     <span class="keywordflow">else</span>
<a name="l00569"></a>00569       fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)&amp;_coll, 1, from);\n&quot;</span>,
<a name="l00570"></a>00570               ctx-&gt;get(), __agritems, num);
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     fprintf(fd, <span class="stringliteral">&quot;%s   _coll-&gt;release();\n&quot;</span>, ctx-&gt;get());
<a name="l00573"></a>00573     fprintf(fd, <span class="stringliteral">&quot;\n%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00574"></a>00574     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l00575"></a>00575     <span class="keywordflow">return</span> Success;
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578   Status
<a name="l00579"></a>00579   Attribute::generateCollInsertClassMethod_C(Class *own,
<a name="l00580"></a>00580                                              GenContext *ctx,
<a name="l00581"></a>00581                                              <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l00582"></a>00582                                              Bool isoid)
<a name="l00583"></a>00583   {
<a name="l00584"></a>00584     <span class="keywordflow">return</span> generateCollRealizeClassMethod_C(own, ctx, hints,
<a name="l00585"></a>00585                                             isoid,
<a name="l00586"></a>00586                                             GenCodeHints::tAddItemToColl);
<a name="l00587"></a>00587   }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   Status
<a name="l00590"></a>00590   Attribute::generateCollSuppressClassMethod_C(Class *own,
<a name="l00591"></a>00591                                                GenContext *ctx,
<a name="l00592"></a>00592                                                <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l00593"></a>00593                                                Bool isoid)
<a name="l00594"></a>00594   {
<a name="l00595"></a>00595     <span class="keywordflow">return</span> generateCollRealizeClassMethod_C(own, ctx, hints,
<a name="l00596"></a>00596                                             isoid, 
<a name="l00597"></a>00597                                             GenCodeHints::tRmvItemFromColl);
<a name="l00598"></a>00598   }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600   Status
<a name="l00601"></a>00601   Attribute::generateSetMethod_C(Class *own, GenContext *ctx,
<a name="l00602"></a>00602                                  <span class="keyword">const</span> GenCodeHints &amp;hints)
<a name="l00603"></a>00603   {
<a name="l00604"></a>00604     <span class="keywordflow">if</span> (cls-&gt;asCollectionClass())
<a name="l00605"></a>00605       {
<a name="l00606"></a>00606         (void)generateCollInsertClassMethod_C(own, ctx, hints, False);
<a name="l00607"></a>00607         (void)generateCollInsertClassMethod_C(own, ctx, hints, True);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609         (void)generateCollSuppressClassMethod_C(own, ctx, hints, False);
<a name="l00610"></a>00610         (void)generateCollSuppressClassMethod_C(own, ctx, hints, True);
<a name="l00611"></a>00611       }
<a name="l00612"></a>00612     <span class="keywordflow">return</span> Success;
<a name="l00613"></a>00613   }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 <span class="preprocessor">#define NOT_BASIC() \</span>
<a name="l00616"></a>00616 <span class="preprocessor">        (isIndirect() || (!cls-&gt;asBasicClass() &amp;&amp; !cls-&gt;asEnumClass()))</span>
<a name="l00617"></a>00617 <span class="preprocessor"></span>
<a name="l00618"></a>00618   Status
<a name="l00619"></a>00619   Attribute::generateSetMethod_C(Class *own, GenContext *ctx,
<a name="l00620"></a>00620                                  Bool isoid,
<a name="l00621"></a>00621                                  <span class="keyword">const</span> GenCodeHints &amp;hints)
<a name="l00622"></a>00622   {
<a name="l00623"></a>00623     FILE *fd = ctx-&gt;getFile();
<a name="l00624"></a>00624     <span class="keywordtype">int</span> ndims = typmod.ndims, i;
<a name="l00625"></a>00625     <span class="keywordtype">int</span> not_basic = NOT_BASIC();
<a name="l00626"></a>00626     <span class="keyword">const</span> <span class="keywordtype">char</span> *ref = (not_basic ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>);
<a name="l00627"></a>00627     <span class="keyword">const</span> <span class="keywordtype">char</span> *ref_set = (not_basic ? getPtrSet() : <span class="stringliteral">&quot; &quot;</span>);
<a name="l00628"></a>00628     <span class="keyword">const</span> <span class="keywordtype">char</span> *comma = (ndims ? <span class="stringliteral">&quot;, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00629"></a>00629     <span class="keyword">const</span> <span class="keywordtype">char</span> *classname = <a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() ?
<a name="l00630"></a>00630       className(cls, True) : className(cls, False);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632     <span class="keywordflow">if</span> (isoid)
<a name="l00633"></a>00633       fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(&quot;</span>, className(own),
<a name="l00634"></a>00634               ATTRNAME(name, tSetOid, hints));
<a name="l00635"></a>00635     <span class="keywordflow">else</span>
<a name="l00636"></a>00636       fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(&quot;</span>, className(own),
<a name="l00637"></a>00637               ATTRNAME_1(name, ATTRSET(cls), hints));
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     dimArgsGen(fd, ndims, True);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">if</span> (isoid)
<a name="l00642"></a>00642       fprintf(fd, <span class="stringliteral">&quot;%sconst eyedb::Oid &amp;_oid)\n{\n&quot;</span>, comma);
<a name="l00643"></a>00643     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cls-&gt;asEnumClass())
<a name="l00644"></a>00644       fprintf(fd, <span class="stringliteral">&quot;%s%s%s_%s, eyedb::Bool _check_value)\n{\n&quot;</span>,
<a name="l00645"></a>00645               comma, classname, ref, name);
<a name="l00646"></a>00646     <span class="keywordflow">else</span>
<a name="l00647"></a>00647       fprintf(fd, <span class="stringliteral">&quot;%s%s%s_%s)\n{\n&quot;</span>, comma, classname, ref_set, name);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     GenCodeHints::OpType optype = (isoid ? GenCodeHints::tSetOid:
<a name="l00650"></a>00650                                    GenCodeHints::tSet);
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="keywordflow">if</span> (attr_cache)
<a name="l00653"></a>00653       genAttrCacheSetPrologue(ctx, optype);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00656"></a>00656       dynamic_attr_gen(fd, ctx, <span class="keyword">this</span>, op_SET, isoid);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     gbx_suspend(ctx);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status status;\n&quot;</span>, ctx-&gt;get());
<a name="l00661"></a>00661 
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (ndims) {
<a name="l00663"></a>00663       fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size from = a%d;\n&quot;</span>, ctx-&gt;get(), ndims-1);
<a name="l00664"></a>00664       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = ndims - 2 ; i &gt;= 0; i--)
<a name="l00665"></a>00665         fprintf(fd, <span class="stringliteral">&quot;%sfrom += a%d * %d;\n&quot;</span>, ctx-&gt;get(), i, typmod.dims[i]);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667       <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>()) {
<a name="l00668"></a>00668         fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Size size;\n&quot;</span>, ctx-&gt;get());
<a name="l00669"></a>00669         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00670"></a>00670           fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;getSize(this, size);\n&quot;</span>,
<a name="l00671"></a>00671                   ctx-&gt;get(), __agrdyn);
<a name="l00672"></a>00672         <span class="keywordflow">else</span>
<a name="l00673"></a>00673           fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;getSize(this, size);\n&quot;</span>,
<a name="l00674"></a>00674                   ctx-&gt;get(), __agritems, num);
<a name="l00675"></a>00675         fprintf(fd, <span class="stringliteral">&quot;%sif (status)\n%s  return status;\n\n&quot;</span>, ctx-&gt;get(),
<a name="l00676"></a>00676                 ctx-&gt;get());
<a name="l00677"></a>00677         fprintf(fd, <span class="stringliteral">&quot;%sif (size &lt;= from)\n&quot;</span>, ctx-&gt;get());
<a name="l00678"></a>00678         ctx-&gt;push();
<a name="l00679"></a>00679         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00680"></a>00680           fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setSize(this, from+1);\n&quot;</span>,
<a name="l00681"></a>00681                   ctx-&gt;get(), __agrdyn);
<a name="l00682"></a>00682         <span class="keywordflow">else</span>
<a name="l00683"></a>00683           fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setSize(this, from+1);\n&quot;</span>,
<a name="l00684"></a>00684                   ctx-&gt;get(), __agritems, num);
<a name="l00685"></a>00685         ctx-&gt;pop();
<a name="l00686"></a>00686         fprintf(fd, <span class="stringliteral">&quot;%sif (status)\n%s  return status;\n&quot;</span>, ctx-&gt;get(),
<a name="l00687"></a>00687                 ctx-&gt;get());
<a name="l00688"></a>00688       }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690       <span class="keywordflow">if</span> (isoid) {
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00692"></a>00692           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setOid(this, &amp;_oid, 1, from, oid_check);\n&quot;</span>,
<a name="l00693"></a>00693                   ctx-&gt;get(), __agrdyn);
<a name="l00694"></a>00694         <span class="keywordflow">else</span>
<a name="l00695"></a>00695           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setOid(this, &amp;_oid, 1, from, oid_check);\n&quot;</span>,
<a name="l00696"></a>00696                   ctx-&gt;get(), __agritems, num);
<a name="l00697"></a>00697         <span class="keywordflow">if</span> (attr_cache)
<a name="l00698"></a>00698           genAttrCacheSetEpilogue(ctx, optype);
<a name="l00699"></a>00699         fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00700"></a>00700       }
<a name="l00701"></a>00701 
<a name="l00702"></a>00702       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cls-&gt;asEnumClass()) {
<a name="l00703"></a>00703         fprintf(fd, <span class="stringliteral">&quot;%seyedblib::int32 __tmp = _%s;\n&quot;</span>, ctx-&gt;get(), name);
<a name="l00704"></a>00704         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00705"></a>00705           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setValue(this, (eyedb::Data)&amp;__tmp, 1, from, _check_value);\n&quot;</span>,
<a name="l00706"></a>00706                   ctx-&gt;get(), __agrdyn, name);
<a name="l00707"></a>00707         <span class="keywordflow">else</span>
<a name="l00708"></a>00708           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)&amp;__tmp, 1, from, _check_value);\n&quot;</span>,
<a name="l00709"></a>00709                   ctx-&gt;get(), __agritems, num, name);
<a name="l00710"></a>00710         <span class="keywordflow">if</span> (attr_cache)
<a name="l00711"></a>00711           genAttrCacheSetEpilogue(ctx, optype);
<a name="l00712"></a>00712         fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00713"></a>00713       }
<a name="l00714"></a>00714       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (not_basic) {
<a name="l00715"></a>00715         <span class="keywordflow">if</span> (odl_smartptr)
<a name="l00716"></a>00716           fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Object *_o%s = _%s.getObject();\n&quot;</span>, ctx-&gt;get(),
<a name="l00717"></a>00717                   name, name);
<a name="l00718"></a>00718         <span class="keywordflow">else</span>
<a name="l00719"></a>00719           fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Object *_o%s = _%s;\n&quot;</span>, ctx-&gt;get(), name,
<a name="l00720"></a>00720                   name);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00723"></a>00723           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setValue(this, (eyedb::Data)&amp;_o%s, 1, from);\n&quot;</span>,
<a name="l00724"></a>00724                   ctx-&gt;get(), __agrdyn, name);
<a name="l00725"></a>00725         <span class="keywordflow">else</span>
<a name="l00726"></a>00726           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)&amp;_o%s, 1, from);\n&quot;</span>,
<a name="l00727"></a>00727                   ctx-&gt;get(), __agritems, num, name);
<a name="l00728"></a>00728         <span class="keywordflow">if</span> (attr_cache)
<a name="l00729"></a>00729           genAttrCacheSetEpilogue(ctx, optype);
<a name="l00730"></a>00730         fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00731"></a>00731       }
<a name="l00732"></a>00732       <span class="keywordflow">else</span> {
<a name="l00733"></a>00733         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00734"></a>00734           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setValue(this, (eyedb::Data)&amp;_%s, 1, from);\n&quot;</span>,
<a name="l00735"></a>00735                   ctx-&gt;get(), __agrdyn, name);
<a name="l00736"></a>00736         <span class="keywordflow">else</span>
<a name="l00737"></a>00737           fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)&amp;_%s, 1, from);\n&quot;</span>,
<a name="l00738"></a>00738                   ctx-&gt;get(), __agritems, num, name);
<a name="l00739"></a>00739         <span class="keywordflow">if</span> (attr_cache)
<a name="l00740"></a>00740           genAttrCacheSetEpilogue(ctx, optype);
<a name="l00741"></a>00741         fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00742"></a>00742       }
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isoid) {
<a name="l00745"></a>00745       <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00746"></a>00746         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setOid(this, &amp;_oid, 1, 0, oid_check);\n&quot;</span>,
<a name="l00747"></a>00747                 ctx-&gt;get(), __agrdyn);
<a name="l00748"></a>00748       <span class="keywordflow">else</span>
<a name="l00749"></a>00749         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setOid(this, &amp;_oid, 1, 0, oid_check);\n&quot;</span>,
<a name="l00750"></a>00750                 ctx-&gt;get(), __agritems, num);
<a name="l00751"></a>00751       <span class="keywordflow">if</span> (attr_cache)
<a name="l00752"></a>00752         genAttrCacheSetEpilogue(ctx, optype);
<a name="l00753"></a>00753       fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cls-&gt;asEnumClass()) {
<a name="l00756"></a>00756       fprintf(fd, <span class="stringliteral">&quot;%seyedblib::int32 __tmp = _%s;\n&quot;</span>, ctx-&gt;get(), name);
<a name="l00757"></a>00757       <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00758"></a>00758         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setValue(this, (eyedb::Data)&amp;__tmp, 1, 0, _check_value);\n&quot;</span>,
<a name="l00759"></a>00759                 ctx-&gt;get(), __agrdyn, name);
<a name="l00760"></a>00760       <span class="keywordflow">else</span>
<a name="l00761"></a>00761         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)&amp;__tmp, 1, 0, _check_value);\n&quot;</span>,
<a name="l00762"></a>00762                 ctx-&gt;get(), __agritems, num, name);
<a name="l00763"></a>00763       <span class="keywordflow">if</span> (attr_cache)
<a name="l00764"></a>00764         genAttrCacheSetEpilogue(ctx, optype);
<a name="l00765"></a>00765       fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (not_basic) {
<a name="l00768"></a>00768       <span class="keywordflow">if</span> (odl_smartptr)
<a name="l00769"></a>00769         fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Object *_o%s = _%s.getObject();\n&quot;</span>, ctx-&gt;get(),
<a name="l00770"></a>00770               name, name);
<a name="l00771"></a>00771       <span class="keywordflow">else</span>
<a name="l00772"></a>00772         fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Object *_o%s = _%s;\n&quot;</span>, ctx-&gt;get(), name, name);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774       <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00775"></a>00775         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setValue(this, (eyedb::Data)&amp;_o%s, 1, 0);\n&quot;</span>,
<a name="l00776"></a>00776                 ctx-&gt;get(), __agrdyn, name);
<a name="l00777"></a>00777       <span class="keywordflow">else</span>
<a name="l00778"></a>00778         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)&amp;_o%s, 1, 0);\n&quot;</span>,
<a name="l00779"></a>00779                 ctx-&gt;get(), __agritems, num, name);
<a name="l00780"></a>00780       <span class="keywordflow">if</span> (attr_cache)
<a name="l00781"></a>00781         genAttrCacheSetEpilogue(ctx, optype);
<a name="l00782"></a>00782       fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784     <span class="keywordflow">else</span> {
<a name="l00785"></a>00785       <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00786"></a>00786         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s-&gt;setValue(this, (eyedb::Data)&amp;_%s, 1, 0);\n&quot;</span>,
<a name="l00787"></a>00787                 ctx-&gt;get(), __agrdyn, name);
<a name="l00788"></a>00788       <span class="keywordflow">else</span>
<a name="l00789"></a>00789         fprintf(fd, <span class="stringliteral">&quot;\n%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)&amp;_%s, 1, 0);\n&quot;</span>,
<a name="l00790"></a>00790                 ctx-&gt;get(), __agritems, num, name);
<a name="l00791"></a>00791       <span class="keywordflow">if</span> (attr_cache)
<a name="l00792"></a>00792         genAttrCacheSetEpilogue(ctx, optype);
<a name="l00793"></a>00793       fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get());
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <span class="keywordflow">return</span> Success;
<a name="l00799"></a>00799   }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 <span class="preprocessor">#define STATUS_ARG(HINTS, COMMA) \</span>
<a name="l00803"></a>00803 <span class="preprocessor">(((HINTS).error_policy == GenCodeHints::StatusErrorPolicy) ? \</span>
<a name="l00804"></a>00804 <span class="preprocessor"> ((COMMA) ? &quot;, eyedb::Status *rs&quot; : &quot;eyedb::Status *rs&quot;) : &quot;&quot;)</span>
<a name="l00805"></a>00805 <span class="preprocessor"></span>
<a name="l00806"></a>00806 <span class="preprocessor">#define STATUS_PROTO(HINTS, COMMA) \</span>
<a name="l00807"></a>00807 <span class="preprocessor">(((HINTS).error_policy == GenCodeHints::StatusErrorPolicy) ? \</span>
<a name="l00808"></a>00808 <span class="preprocessor"> ((COMMA) ? &quot;, eyedb::Status * = 0&quot; : &quot;eyedb::Status * = 0&quot;) : &quot;&quot;)</span>
<a name="l00809"></a>00809 <span class="preprocessor"></span>
<a name="l00810"></a>00810   Status
<a name="l00811"></a>00811   Attribute::generateCollGetMethod_C(Class *own, GenContext *ctx,
<a name="l00812"></a>00812                                      Bool isoid,
<a name="l00813"></a>00813                                      <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l00814"></a>00814                                      <span class="keyword">const</span> <span class="keywordtype">char</span> *_const)
<a name="l00815"></a>00815   {
<a name="l00816"></a>00816     FILE *fd = ctx-&gt;getFile();
<a name="l00817"></a>00817     <span class="keywordtype">int</span> ndims = typmod.ndims, i;
<a name="l00818"></a>00818     Bool _isref;
<a name="l00819"></a>00819     eyedblib::int16 _dim;
<a name="l00820"></a>00820     Class *cl = <span class="keyword">const_cast&lt;</span>Class *<span class="keyword">&gt;</span>(cls-&gt;asCollectionClass()-&gt;getCollClass(&amp;_isref, &amp;_dim));
<a name="l00821"></a>00821     <span class="keywordtype">int</span> not_basic = _isref || (!cl-&gt;asBasicClass() &amp;&amp; !cl-&gt;asEnumClass());
<a name="l00822"></a>00822     <span class="keyword">const</span> <span class="keywordtype">char</span> *ref = (not_basic ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>);
<a name="l00823"></a>00823     <span class="keyword">const</span> <span class="keywordtype">char</span> *starg    = STATUS_ARG(hints, False);
<a name="l00824"></a>00824     <span class="keyword">const</span> <span class="keywordtype">char</span> *stargcom = STATUS_ARG(hints, True);
<a name="l00825"></a>00825     <span class="keyword">const</span> <span class="keywordtype">char</span> *classname = <a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() ?
<a name="l00826"></a>00826       className(cls, True) : className(cls, False);
<a name="l00827"></a>00827     <span class="keyword">const</span> <span class="keywordtype">char</span> *oclassname = _isref ?
<a name="l00828"></a>00828       className(cl, True) : className(cl, False);
<a name="l00829"></a>00829     <span class="keyword">const</span> <span class="keywordtype">char</span> *comma = (ndims ? <span class="stringliteral">&quot;, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     Bool ordered = (cls-&gt;asCollArrayClass() || cls-&gt;asCollListClass()) ? True : False;
<a name="l00832"></a>00832     <span class="keywordflow">if</span> (isoid) {
<a name="l00833"></a>00833       <span class="keywordflow">if</span> (!_isref)
<a name="l00834"></a>00834         <span class="keywordflow">return</span> Success;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836       <span class="keywordflow">if</span> (ordered) { <span class="comment">// 24/09/05</span>
<a name="l00837"></a>00837         fprintf(fd, <span class="stringliteral">&quot;eyedb::Oid %s::%s(unsigned int ind, &quot;</span>,
<a name="l00838"></a>00838                 own-&gt;getName(),
<a name="l00839"></a>00839                 ATTRNAME_1(name, (ordered ? GenCodeHints::tRetrieveOidItemAt : GenCodeHints::tGetOidItemAt), hints));
<a name="l00840"></a>00840         dimArgsGen(fd, ndims, True);
<a name="l00841"></a>00841         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status *rs) const\n&quot;</span>, comma);
<a name="l00842"></a>00842         fprintf(fd, <span class="stringliteral">&quot;{\n&quot;</span>);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Oid tmp;;\n&quot;</span>, ctx-&gt;get());
<a name="l00845"></a>00845         <span class="comment">/*</span>
<a name="l00846"></a>00846 <span class="comment">          fprintf(fd, &quot;%seyedb::Status s, *ps;\n&quot;, ctx-&gt;get());</span>
<a name="l00847"></a>00847 <span class="comment">          fprintf(fd, &quot;%sps = (rs ? rs : &amp;s);\n\n&quot;, ctx-&gt;get());</span>
<a name="l00848"></a>00848 <span class="comment">        */</span>
<a name="l00849"></a>00849         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status s;\n&quot;</span>, ctx-&gt;get());
<a name="l00850"></a>00850       
<a name="l00851"></a>00851         fprintf(fd, <span class="stringliteral">&quot;%sconst eyedb::Collection%s coll = %s(&quot;</span>, ctx-&gt;get(),
<a name="l00852"></a>00852                 getPtrRet(),
<a name="l00853"></a>00853                 ATTRNAME(name, tGetColl, hints));
<a name="l00854"></a>00854 
<a name="l00855"></a>00855         <span class="keywordflow">for</span> (i = 0; i &lt; ndims; i++)
<a name="l00856"></a>00856           fprintf(fd, <span class="stringliteral">&quot;a%d, &quot;</span>, i);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         fprintf(fd, <span class="stringliteral">&quot;(eyedb::Bool *)0, rs);\n\n&quot;</span>, ctx-&gt;get());
<a name="l00859"></a>00859         fprintf(fd, <span class="stringliteral">&quot;%sif (!coll || (rs &amp;&amp; *rs))\n&quot;</span>, ctx-&gt;get());
<a name="l00860"></a>00860         fprintf(fd, <span class="stringliteral">&quot;%s  return tmp;\n\n&quot;</span>, ctx-&gt;get());
<a name="l00861"></a>00861       
<a name="l00862"></a>00862         <span class="keywordflow">if</span> (cls-&gt;asCollArrayClass() || cls-&gt;asCollListClass())
<a name="l00863"></a>00863           fprintf(fd, <span class="stringliteral">&quot;%ss = coll-&gt;asCollArray()-&gt;retrieveAt(ind, tmp);\n&quot;</span>, ctx-&gt;get());
<a name="l00864"></a>00864         <span class="keywordflow">else</span>
<a name="l00865"></a>00865           fprintf(fd, <span class="stringliteral">&quot;%ss = coll-&gt;getOidAt(ind, tmp);\n&quot;</span>, ctx-&gt;get());
<a name="l00866"></a>00866         fprintf(fd, <span class="stringliteral">&quot;%sif (s &amp;&amp; rs) *rs = s;\n&quot;</span>, ctx-&gt;get());
<a name="l00867"></a>00867         fprintf(fd, <span class="stringliteral">&quot;%sreturn tmp;\n&quot;</span>, ctx-&gt;get());
<a name="l00868"></a>00868         fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l00869"></a>00869         <span class="keywordflow">return</span> Success;
<a name="l00870"></a>00870       }
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="keywordflow">if</span> (!*_const &amp;&amp; cl-&gt;asBasicClass())
<a name="l00874"></a>00874       <span class="keywordflow">return</span> Success;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876     <span class="comment">// 24/09/05</span>
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (!ordered)
<a name="l00878"></a>00878       <span class="keywordflow">return</span> Success;
<a name="l00879"></a>00879       
<a name="l00880"></a>00880     <span class="keywordflow">if</span> (!strcmp(cl-&gt;getName(), char_class_name) &amp;&amp; _dim &gt; 1) {
<a name="l00881"></a>00881       fprintf(fd, <span class="stringliteral">&quot;const char *%s::%s(unsigned int ind, &quot;</span>,
<a name="l00882"></a>00882               own-&gt;getName(),
<a name="l00883"></a>00883               ATTRNAME_1(name, (ordered ? GenCodeHints::tRetrieveItemAt : GenCodeHints::tGetItemAt), hints));
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_dim == 1)
<a name="l00886"></a>00886       fprintf(fd, <span class="stringliteral">&quot;%s%s%s%s::%s(unsigned int ind, &quot;</span>,
<a name="l00887"></a>00887               _const, oclassname, ref, own-&gt;getName(),
<a name="l00888"></a>00888               ATTRNAME_1(name, (ordered ? GenCodeHints::tRetrieveItemAt : GenCodeHints::tGetItemAt), hints));
<a name="l00889"></a>00889     <span class="keywordflow">else</span> {
<a name="l00890"></a>00890       <span class="comment">//fprintf(stderr, &quot;collection of dimensional item is not implemented: %s::%s\n&quot;, class_owner-&gt;getName(), name);</span>
<a name="l00891"></a>00891       <span class="keywordflow">return</span> Success;
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     dimArgsGen(fd, ndims, True);
<a name="l00895"></a>00895     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Bool *isnull, eyedb::Status *rs) %s\n&quot;</span>, comma, _const);
<a name="l00896"></a>00896     fprintf(fd, <span class="stringliteral">&quot;{\n&quot;</span>);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898     <span class="comment">/*</span>
<a name="l00899"></a>00899 <span class="comment">      fprintf(fd, &quot;%seyedb::Status s, *ps;\n&quot;, ctx-&gt;get());</span>
<a name="l00900"></a>00900 <span class="comment">      fprintf(fd, &quot;%sps = (rs ? rs : &amp;s);\n\n&quot;, ctx-&gt;get());</span>
<a name="l00901"></a>00901 <span class="comment">    */</span>
<a name="l00902"></a>00902     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status s;\n&quot;</span>, ctx-&gt;get());
<a name="l00903"></a>00903 
<a name="l00904"></a>00904     fprintf(fd, <span class="stringliteral">&quot;%sconst eyedb::Collection%s coll = %s(&quot;</span>, ctx-&gt;get(),
<a name="l00905"></a>00905             getPtrRet(),
<a name="l00906"></a>00906             ATTRNAME(name, tGetColl, hints));
<a name="l00907"></a>00907 
<a name="l00908"></a>00908     <span class="keywordflow">for</span> (i = 0; i &lt; ndims; i++)
<a name="l00909"></a>00909       fprintf(fd, <span class="stringliteral">&quot;a%d, &quot;</span>, i);
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     fprintf(fd, <span class="stringliteral">&quot;isnull, rs);\n\n&quot;</span>, ctx-&gt;get());
<a name="l00912"></a>00912     fprintf(fd, <span class="stringliteral">&quot;%sif (!coll || (rs &amp;&amp; *rs))\n&quot;</span>, ctx-&gt;get());
<a name="l00913"></a>00913     <span class="keywordflow">if</span> (not_basic)
<a name="l00914"></a>00914       {
<a name="l00915"></a>00915         fprintf(fd, <span class="stringliteral">&quot;%s  return (%s *)0;\n\n&quot;</span>, ctx-&gt;get(), oclassname);
<a name="l00916"></a>00916         fprintf(fd, <span class="stringliteral">&quot;%s%s *tmp = 0;\n&quot;</span>, ctx-&gt;get(), oclassname);
<a name="l00917"></a>00917         <span class="keywordflow">if</span> (cls-&gt;asCollArrayClass() || cls-&gt;asCollListClass())
<a name="l00918"></a>00918           fprintf(fd, <span class="stringliteral">&quot;%ss = coll-&gt;asCollArray()-&gt;retrieveAt(ind, (eyedb::Object*&amp;)tmp);\n&quot;</span>, ctx-&gt;get());
<a name="l00919"></a>00919         <span class="keywordflow">else</span>
<a name="l00920"></a>00920           fprintf(fd, <span class="stringliteral">&quot;%ss = coll-&gt;getObjectAt(ind, (eyedb::Object*&amp;)tmp);\n&quot;</span>, ctx-&gt;get());
<a name="l00921"></a>00921       }
<a name="l00922"></a>00922     <span class="keywordflow">else</span>
<a name="l00923"></a>00923       {
<a name="l00924"></a>00924         fprintf(fd, <span class="stringliteral">&quot;%s  return 0;\n\n&quot;</span>, ctx-&gt;get(), oclassname);
<a name="l00925"></a>00925         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Value tmp;\n&quot;</span>, ctx-&gt;get());
<a name="l00926"></a>00926         <span class="keywordflow">if</span> (cls-&gt;asCollArrayClass() || cls-&gt;asCollListClass())
<a name="l00927"></a>00927           fprintf(fd, <span class="stringliteral">&quot;%ss = coll-&gt;asCollArray()-&gt;retrieveAt(ind, tmp);\n&quot;</span>, ctx-&gt;get());
<a name="l00928"></a>00928         <span class="keywordflow">else</span>
<a name="l00929"></a>00929           fprintf(fd, <span class="stringliteral">&quot;%ss = coll-&gt;getValueAt(ind, tmp);\n&quot;</span>, ctx-&gt;get());
<a name="l00930"></a>00930       }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932     <span class="keywordflow">if</span> (not_basic)
<a name="l00933"></a>00933       {
<a name="l00934"></a>00934         fprintf(fd, <span class="stringliteral">&quot;%sif (s) {if (rs) *rs = s; return (%s *)0;}\n&quot;</span>, ctx-&gt;get(), oclassname);
<a name="l00935"></a>00935         fprintf(fd, <span class="stringliteral">&quot;%sreturn tmp;\n&quot;</span>, ctx-&gt;get());
<a name="l00936"></a>00936       }
<a name="l00937"></a>00937     <span class="keywordflow">else</span>
<a name="l00938"></a>00938       {
<a name="l00939"></a>00939         fprintf(fd, <span class="stringliteral">&quot;%sif (s) {if (rs) *rs = s; return 0;}\n&quot;</span>, ctx-&gt;get());
<a name="l00940"></a>00940         fprintf(fd, <span class="stringliteral">&quot;%sreturn tmp.%s;\n&quot;</span>, ctx-&gt;get(),
<a name="l00941"></a>00941                 <a class="code" href="classeyedb_1_1Value.html#ab7e9bc5860c356416cc6e5535afa2ad0" title="Not yet documented.">Value::getAttributeName</a>(cl, (_isref || (_dim &gt; 1)) ?
<a name="l00942"></a>00942                                         True : False));
<a name="l00943"></a>00943       }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l00946"></a>00946     <span class="keywordflow">return</span> Success;
<a name="l00947"></a>00947   }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949   Status
<a name="l00950"></a>00950   Attribute::generateGetMethod_C(Class *own, GenContext *ctx,
<a name="l00951"></a>00951                                  Bool isoid,
<a name="l00952"></a>00952                                  <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l00953"></a>00953                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *_const)
<a name="l00954"></a>00954   {
<a name="l00955"></a>00955     FILE *fd = ctx-&gt;getFile();
<a name="l00956"></a>00956     <span class="keywordtype">int</span> ndims = typmod.ndims, i;
<a name="l00957"></a>00957     <span class="keywordtype">int</span> not_basic = NOT_BASIC();
<a name="l00958"></a>00958     <span class="keyword">const</span> <span class="keywordtype">char</span> *ref = (not_basic ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>);
<a name="l00959"></a>00959     <span class="keyword">const</span> <span class="keywordtype">char</span> *pure_ref = (not_basic ? <span class="stringliteral">&quot;*&quot;</span> : <span class="stringliteral">&quot; &quot;</span>);
<a name="l00960"></a>00960     <span class="keyword">const</span> <span class="keywordtype">char</span> *starg    = STATUS_ARG(hints, False);
<a name="l00961"></a>00961     <span class="keyword">const</span> <span class="keywordtype">char</span> *stargcom = STATUS_ARG(hints, True);
<a name="l00962"></a>00962     <span class="keyword">const</span> <span class="keywordtype">char</span> *classname = <a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() ?
<a name="l00963"></a>00963       className(cls, True) : className(cls, False);
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <span class="keywordflow">if</span> (isoid)
<a name="l00966"></a>00966       fprintf(fd, <span class="stringliteral">&quot;eyedb::Oid %s::%s(&quot;</span>, className(own),
<a name="l00967"></a>00967               ATTRNAME(name, tGetOid, hints));
<a name="l00968"></a>00968     <span class="keywordflow">else</span>
<a name="l00969"></a>00969       fprintf(fd, <span class="stringliteral">&quot;%s%s%s%s::%s(&quot;</span>, _const, classname, ref,
<a name="l00970"></a>00970               className(own), ATTRNAME_1(name, ATTRGET(cls), hints));
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     dimArgsGen(fd, ndims, True);
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     <span class="keywordflow">if</span> (isoid)
<a name="l00975"></a>00975       <span class="comment">//      fprintf(fd, &quot;%s) %s\n{\n&quot;, (ndims ? stargcom : starg), _const);</span>
<a name="l00976"></a>00976       fprintf(fd, <span class="stringliteral">&quot;%s) %s\n{\n&quot;</span>, (ndims ? stargcom : starg), <span class="stringliteral">&quot;const&quot;</span>);
<a name="l00977"></a>00977     <span class="keywordflow">else</span>
<a name="l00978"></a>00978       fprintf(fd, <span class="stringliteral">&quot;%seyedb::Bool *isnull%s) %s\n{\n&quot;</span>, (ndims ? <span class="stringliteral">&quot;, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00979"></a>00979               stargcom, (!not_basic ? <span class="stringliteral">&quot;const&quot;</span> : _const));
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordtype">int</span> const_obj = (!isoid &amp;&amp; not_basic);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     GenCodeHints::OpType optype = (isoid ? GenCodeHints::tGetOid:
<a name="l00984"></a>00984                                    GenCodeHints::tGet);
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (attr_cache)
<a name="l00986"></a>00986       genAttrCacheGetPrologue(ctx, optype);
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l00989"></a>00989       dynamic_attr_gen(fd, ctx, <span class="keyword">this</span>, op_GET, isoid, False,
<a name="l00990"></a>00990                        cls-&gt;asEnumClass() ?
<a name="l00991"></a>00991                        className(cls, True) : 0);
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     gbx_suspend(ctx);
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     <span class="keywordflow">if</span> (isoid)
<a name="l00996"></a>00996       fprintf(fd, <span class="stringliteral">&quot;%seyedb::Oid __tmp;\n&quot;</span>, ctx-&gt;get());
<a name="l00997"></a>00997     <span class="keywordflow">else</span>
<a name="l00998"></a>00998       {
<a name="l00999"></a>00999         <span class="keywordflow">if</span> (const_obj)
<a name="l01000"></a>01000           fprintf(fd, <span class="stringliteral">&quot;%seyedb::Object *__o = 0, *__go;\n&quot;</span>, ctx-&gt;get());
<a name="l01001"></a>01001         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cls-&gt;asEnumClass())
<a name="l01002"></a>01002           fprintf(fd, <span class="stringliteral">&quot;%seyedblib::int32 %s__tmp%s;\n&quot;</span>, ctx-&gt;get(),
<a name="l01003"></a>01003                   ref,
<a name="l01004"></a>01004                   (!strcmp(cls-&gt;getName(), <span class="stringliteral">&quot;oid&quot;</span>) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot; = 0&quot;</span>));
<a name="l01005"></a>01005         <span class="keywordflow">else</span>
<a name="l01006"></a>01006           fprintf(fd, <span class="stringliteral">&quot;%s%s%s__tmp%s;\n&quot;</span>, ctx-&gt;get(),
<a name="l01007"></a>01007                   classname, ref,
<a name="l01008"></a>01008                   (!strcmp(cls-&gt;getName(), <span class="stringliteral">&quot;oid&quot;</span>) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot; = 0&quot;</span>));
<a name="l01009"></a>01009       }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="keyword">const</span> <span class="keywordtype">char</span> *psret = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01012"></a>01012     <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01013"></a>01013       {
<a name="l01014"></a>01014         <span class="comment">/*</span>
<a name="l01015"></a>01015 <span class="comment">          fprintf(fd, &quot;%seyedb::Status s, *ps;\n&quot;, ctx-&gt;get());</span>
<a name="l01016"></a>01016 <span class="comment">          fprintf(fd, &quot;%sps = (rs ? rs : &amp;s);\n&quot;, ctx-&gt;get());</span>
<a name="l01017"></a>01017 <span class="comment">          psret = &quot;*ps = &quot;;</span>
<a name="l01018"></a>01018 <span class="comment">        */</span>
<a name="l01019"></a>01019         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status s;\n&quot;</span>, ctx-&gt;get());
<a name="l01020"></a>01020         psret = <span class="stringliteral">&quot;s = &quot;</span>;
<a name="l01021"></a>01021       }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (ndims)
<a name="l01024"></a>01024       {
<a name="l01025"></a>01025         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size from = a%d;\n&quot;</span>, ctx-&gt;get(), ndims-1);
<a name="l01026"></a>01026         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = ndims - 2 ; i &gt;= 0; i--)
<a name="l01027"></a>01027           fprintf(fd, <span class="stringliteral">&quot;%sfrom += a%d * %d;\n&quot;</span>, ctx-&gt;get(), i, typmod.dims[i]);
<a name="l01028"></a>01028 
<a name="l01029"></a>01029         <span class="keywordflow">if</span> (odl_dynamic_attr) {
<a name="l01030"></a>01030           <span class="keywordflow">if</span> (isoid)
<a name="l01031"></a>01031             fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s-&gt;getOid(this, &amp;__tmp, 1, from);\n&quot;</span>,
<a name="l01032"></a>01032                     ctx-&gt;get(), psret, __agrdyn);
<a name="l01033"></a>01033           <span class="keywordflow">else</span>
<a name="l01034"></a>01034             fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s-&gt;getValue(this, (eyedb::Data *)&amp;%s, 1, from, isnull);\n&quot;</span>,
<a name="l01035"></a>01035                     ctx-&gt;get(), psret, __agrdyn, (const_obj ? <span class="stringliteral">&quot;__o&quot;</span> : <span class="stringliteral">&quot;__tmp&quot;</span>));
<a name="l01036"></a>01036         }
<a name="l01037"></a>01037         <span class="keywordflow">else</span> {
<a name="l01038"></a>01038           <span class="keywordflow">if</span> (isoid)
<a name="l01039"></a>01039             fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s[%d]-&gt;getOid(this, &amp;__tmp, 1, from);\n&quot;</span>,
<a name="l01040"></a>01040                     ctx-&gt;get(), psret, __agritems, num);
<a name="l01041"></a>01041           <span class="keywordflow">else</span>
<a name="l01042"></a>01042             fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s[%d]-&gt;getValue(this, (eyedb::Data *)&amp;%s, 1, from, isnull);\n&quot;</span>,
<a name="l01043"></a>01043                     ctx-&gt;get(), psret, __agritems, num, (const_obj ? <span class="stringliteral">&quot;__o&quot;</span> : <span class="stringliteral">&quot;__tmp&quot;</span>));
<a name="l01044"></a>01044         }
<a name="l01045"></a>01045       }
<a name="l01046"></a>01046     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isoid) {
<a name="l01047"></a>01047       <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01048"></a>01048         fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s-&gt;getOid(this, &amp;__tmp, 1, 0);\n&quot;</span>,
<a name="l01049"></a>01049                 ctx-&gt;get(), psret, __agrdyn);
<a name="l01050"></a>01050       <span class="keywordflow">else</span>
<a name="l01051"></a>01051         fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s[%d]-&gt;getOid(this, &amp;__tmp, 1, 0);\n&quot;</span>,
<a name="l01052"></a>01052                 ctx-&gt;get(), psret, __agritems, num);
<a name="l01053"></a>01053     }
<a name="l01054"></a>01054     <span class="keywordflow">else</span> {
<a name="l01055"></a>01055       <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01056"></a>01056         fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s-&gt;getValue(this, (eyedb::Data *)&amp;%s, 1, 0, isnull);\n&quot;</span>,
<a name="l01057"></a>01057                 ctx-&gt;get(), psret, __agrdyn, (const_obj ? <span class="stringliteral">&quot;__o&quot;</span> : <span class="stringliteral">&quot;__tmp&quot;</span>));
<a name="l01058"></a>01058       <span class="keywordflow">else</span>
<a name="l01059"></a>01059         fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s[%d]-&gt;getValue(this, (eyedb::Data *)&amp;%s, 1, 0, isnull);\n&quot;</span>,
<a name="l01060"></a>01060                 ctx-&gt;get(), psret, __agritems, num, (const_obj ? <span class="stringliteral">&quot;__o&quot;</span> : <span class="stringliteral">&quot;__tmp&quot;</span>));
<a name="l01061"></a>01061     }
<a name="l01062"></a>01062 
<a name="l01063"></a>01063     <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01064"></a>01064       {
<a name="l01065"></a>01065         <span class="keywordflow">if</span> (isoid || !strcmp(cls-&gt;getName(), <span class="stringliteral">&quot;oid&quot;</span>))
<a name="l01066"></a>01066           fprintf(fd, <span class="stringliteral">&quot;%sif (s) {if (rs) *rs = s; return nulloid;}\n\n&quot;</span>,
<a name="l01067"></a>01067                   ctx-&gt;get());
<a name="l01068"></a>01068         <span class="keywordflow">else</span>
<a name="l01069"></a>01069           RETURN_ERROR(fd, ctx, cls, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01070"></a>01070       }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="keywordflow">if</span> (const_obj)
<a name="l01073"></a>01073       {
<a name="l01074"></a>01074         <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>())
<a name="l01075"></a>01075           {
<a name="l01076"></a>01076             fprintf(fd, <span class="stringliteral">&quot;\n%sif (__o)\n&quot;</span>, ctx-&gt;get());
<a name="l01077"></a>01077             fprintf(fd, <span class="stringliteral">&quot;%s  {\n&quot;</span>, ctx-&gt;get());
<a name="l01078"></a>01078             <span class="keywordflow">if</span> (!cls-&gt;asCollectionClass()) <span class="comment">// added the 23/08/99</span>
<a name="l01079"></a>01079               {
<a name="l01080"></a>01080                 fprintf(fd, <span class="stringliteral">&quot;   %sif (eyedb::ObjectPeer::isGRTObject(__o)) {\n&quot;</span>, ctx-&gt;get());
<a name="l01081"></a>01081                 <span class="keywordflow">if</span> (attr_cache)
<a name="l01082"></a>01082                   {
<a name="l01083"></a>01083                     ctx-&gt;push();
<a name="l01084"></a>01084                     ctx-&gt;push();
<a name="l01085"></a>01085                     genAttrCacheGetEpilogue(ctx, optype);
<a name="l01086"></a>01086                     ctx-&gt;pop();
<a name="l01087"></a>01087                     ctx-&gt;pop();
<a name="l01088"></a>01088                   }
<a name="l01089"></a>01089               
<a name="l01090"></a>01090                 fprintf(fd, <span class="stringliteral">&quot;     %sreturn (%s *)__o;\n&quot;</span>, ctx-&gt;get(),
<a name="l01091"></a>01091                         classname);
<a name="l01092"></a>01092                 fprintf(fd, <span class="stringliteral">&quot;   %s}\n&quot;</span>, ctx-&gt;get());
<a name="l01093"></a>01093                 fprintf(fd, <span class="stringliteral">&quot;   %s__go = (%s *)make_object(__o, eyedb::False);\n&quot;</span>, ctx-&gt;get(), classname);
<a name="l01094"></a>01094                 fprintf(fd, <span class="stringliteral">&quot;   %sif (__go)\n&quot;</span>, ctx-&gt;get());
<a name="l01095"></a>01095                 fprintf(fd, <span class="stringliteral">&quot;   %s {\n&quot;</span>, ctx-&gt;get());
<a name="l01096"></a>01096                 ctx-&gt;push();
<a name="l01097"></a>01097                 fprintf(fd, <span class="stringliteral">&quot;   %s__o = __go;\n&quot;</span>, ctx-&gt;get());
<a name="l01098"></a>01098                 <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01099"></a>01099                   fprintf(fd, <span class="stringliteral">&quot;   %s%s%s-&gt;setValue((Agregat *)this, (eyedb::Data)&amp;__o, 1, %s);\n&quot;</span>,
<a name="l01100"></a>01100                           ctx-&gt;get(), psret, __agrdyn, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01101"></a>01101                 <span class="keywordflow">else</span>
<a name="l01102"></a>01102                   fprintf(fd, <span class="stringliteral">&quot;   %s%s%s[%d]-&gt;setValue((Agregat *)this, (eyedb::Data)&amp;__o, 1, %s);\n&quot;</span>,
<a name="l01103"></a>01103                           ctx-&gt;get(), psret, __agritems, num, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01104"></a>01104 
<a name="l01105"></a>01105                 fprintf(fd, <span class="stringliteral">&quot;   %seyedb::ObjectPeer::decrRefCount(__o);\n&quot;</span>, ctx-&gt;get());
<a name="l01106"></a>01106           
<a name="l01107"></a>01107                 <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01108"></a>01108                   RETURN_ERROR(fd, ctx, cls, <span class="stringliteral">&quot;   &quot;</span>);
<a name="l01109"></a>01109               
<a name="l01110"></a>01110                 ctx-&gt;pop();
<a name="l01111"></a>01111                 fprintf(fd, <span class="stringliteral">&quot;   %s }\n&quot;</span>, ctx-&gt;get());
<a name="l01112"></a>01112 
<a name="l01113"></a>01113                 <span class="keywordflow">if</span> (attr_cache)
<a name="l01114"></a>01114                   {
<a name="l01115"></a>01115                     ctx-&gt;push();
<a name="l01116"></a>01116                     genAttrCacheGetEpilogue(ctx, optype);
<a name="l01117"></a>01117                     ctx-&gt;pop();
<a name="l01118"></a>01118                   }
<a name="l01119"></a>01119               }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121             fprintf(fd, <span class="stringliteral">&quot;   %sreturn (%s%s)__o;\n&quot;</span>, ctx-&gt;get(),
<a name="l01122"></a>01122                     classname, pure_ref);
<a name="l01123"></a>01123             fprintf(fd, <span class="stringliteral">&quot;%s  }\n\n&quot;</span>, ctx-&gt;get());
<a name="l01124"></a>01124 
<a name="l01125"></a>01125             fprintf(fd, <span class="stringliteral">&quot;%seyedb::Bool wasnull = (!__o ? eyedb::True : eyedb::False);\n&quot;</span>, ctx-&gt;get());
<a name="l01126"></a>01126             fprintf(fd, <span class="stringliteral">&quot;%sif (!__o &amp;&amp; db)\n&quot;</span>, ctx-&gt;get());
<a name="l01127"></a>01127             fprintf(fd, <span class="stringliteral">&quot;%s  {\n&quot;</span>, ctx-&gt;get());
<a name="l01128"></a>01128             fprintf(fd, <span class="stringliteral">&quot;%s    eyedb::Oid toid;\n&quot;</span>, ctx-&gt;get());
<a name="l01129"></a>01129             <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01130"></a>01130               fprintf(fd, <span class="stringliteral">&quot;%s    %s%s-&gt;getOid(this, &amp;toid, 1, %s);\n&quot;</span>,
<a name="l01131"></a>01131                       ctx-&gt;get(), psret, __agrdyn, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01132"></a>01132             <span class="keywordflow">else</span>
<a name="l01133"></a>01133               fprintf(fd, <span class="stringliteral">&quot;%s    %s%s[%d]-&gt;getOid(this, &amp;toid, 1, %s);\n&quot;</span>,
<a name="l01134"></a>01134                       ctx-&gt;get(), psret, __agritems, num, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01135"></a>01135             <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01136"></a>01136               RETURN_ERROR(fd, ctx, cls, <span class="stringliteral">&quot;    &quot;</span>);
<a name="l01137"></a>01137 
<a name="l01138"></a>01138             fprintf(fd, <span class="stringliteral">&quot;%s    if (toid.isValid())\n&quot;</span>, ctx-&gt;get());
<a name="l01139"></a>01139             fprintf(fd, <span class="stringliteral">&quot;%s      {\n&quot;</span>, ctx-&gt;get());
<a name="l01140"></a>01140             fprintf(fd, <span class="stringliteral">&quot;%s        %sdb-&gt;loadObject(&amp;toid, &amp;__o);\n&quot;</span>,
<a name="l01141"></a>01141                     ctx-&gt;get(), psret);
<a name="l01142"></a>01142             <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01143"></a>01143               RETURN_ERROR(fd, ctx, cls, <span class="stringliteral">&quot;        &quot;</span>);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145             <span class="comment">// ---- added the 4/05/99</span>
<a name="l01146"></a>01146             <span class="keywordflow">if</span> (!cls-&gt;asCollectionClass()) <span class="comment">// added the 23/08/99</span>
<a name="l01147"></a>01147               {
<a name="l01148"></a>01148                 fprintf(fd, <span class="stringliteral">&quot;%s        if (!eyedb::ObjectPeer::isGRTObject(__o))\n&quot;</span>,
<a name="l01149"></a>01149                         ctx-&gt;get());
<a name="l01150"></a>01150                 fprintf(fd, <span class="stringliteral">&quot;%s         {\n&quot;</span>, ctx-&gt;get());
<a name="l01151"></a>01151                 fprintf(fd, <span class="stringliteral">&quot;%s           __go = (%s *)make_object&quot;</span>
<a name="l01152"></a>01152                         <span class="stringliteral">&quot;(__o, eyedb::False);\n&quot;</span>, ctx-&gt;get(), classname);
<a name="l01153"></a>01153                 fprintf(fd, <span class="stringliteral">&quot;%s           if (__go) __o = __go;\n&quot;</span>, ctx-&gt;get());
<a name="l01154"></a>01154                 fprintf(fd, <span class="stringliteral">&quot;%s         }\n&quot;</span>, ctx-&gt;get());
<a name="l01155"></a>01155               }
<a name="l01156"></a>01156             <span class="comment">// ----</span>
<a name="l01157"></a>01157             fprintf(fd, <span class="stringliteral">&quot;%s      }\n&quot;</span>, ctx-&gt;get());
<a name="l01158"></a>01158             fprintf(fd, <span class="stringliteral">&quot;%s  }\n&quot;</span>, ctx-&gt;get());
<a name="l01159"></a>01159           
<a name="l01160"></a>01160             fprintf(fd, <span class="stringliteral">&quot;\n%sif (__o &amp;&amp; wasnull)\n&quot;</span>, ctx-&gt;get());
<a name="l01161"></a>01161             fprintf(fd, <span class="stringliteral">&quot;%s  {\n&quot;</span>, ctx-&gt;get());
<a name="l01162"></a>01162             <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01163"></a>01163               fprintf(fd, <span class="stringliteral">&quot;   %s%s%s-&gt;setValue((eyedb::Agregat *)this, (eyedb::Data)&amp;__o, 1, %s);\n&quot;</span>,
<a name="l01164"></a>01164                       ctx-&gt;get(), psret, __agrdyn, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01165"></a>01165             <span class="keywordflow">else</span>
<a name="l01166"></a>01166               fprintf(fd, <span class="stringliteral">&quot;   %s%s%s[%d]-&gt;setValue((eyedb::Agregat *)this, (eyedb::Data)&amp;__o, 1, %s);\n&quot;</span>,
<a name="l01167"></a>01167                       ctx-&gt;get(), psret, __agritems, num, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01168"></a>01168             <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01169"></a>01169               RETURN_ERROR(fd, ctx, cls, <span class="stringliteral">&quot;   &quot;</span>);
<a name="l01170"></a>01170 
<a name="l01171"></a>01171             <span class="comment">// change the 23/08/99</span>
<a name="l01172"></a>01172             fprintf(fd, <span class="stringliteral">&quot;   %s__o-&gt;release();\n&quot;</span>, ctx-&gt;get());
<a name="l01173"></a>01173             fprintf(fd, <span class="stringliteral">&quot;%s  }\n&quot;</span>, ctx-&gt;get());
<a name="l01174"></a>01174           }
<a name="l01175"></a>01175         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!cls-&gt;asCollectionClass()) <span class="comment">// added the 25/11/99</span>
<a name="l01176"></a>01176           {
<a name="l01177"></a>01177             fprintf(fd, <span class="stringliteral">&quot;\n%sif (__o)\n&quot;</span>, ctx-&gt;get());
<a name="l01178"></a>01178             fprintf(fd, <span class="stringliteral">&quot;%s  {\n&quot;</span>, ctx-&gt;get());
<a name="l01179"></a>01179             fprintf(fd, <span class="stringliteral">&quot;   %sif (eyedb::ObjectPeer::isGRTObject(__o)) {\n&quot;</span>, ctx-&gt;get());
<a name="l01180"></a>01180             <span class="keywordflow">if</span> (attr_cache)
<a name="l01181"></a>01181               {
<a name="l01182"></a>01182                 ctx-&gt;push();
<a name="l01183"></a>01183                 ctx-&gt;push();
<a name="l01184"></a>01184                 genAttrCacheGetEpilogue(ctx, optype);
<a name="l01185"></a>01185                 ctx-&gt;pop();
<a name="l01186"></a>01186                 ctx-&gt;pop();
<a name="l01187"></a>01187               }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189             fprintf(fd, <span class="stringliteral">&quot;     %sreturn (%s *)__o;\n&quot;</span>, ctx-&gt;get(),
<a name="l01190"></a>01190                     classname);
<a name="l01191"></a>01191             fprintf(fd, <span class="stringliteral">&quot;   %s}\n&quot;</span>, ctx-&gt;get());
<a name="l01192"></a>01192             fprintf(fd, <span class="stringliteral">&quot;   %s__go = (%s *)make_object(__o, eyedb::False);\n&quot;</span>, ctx-&gt;get(), classname);
<a name="l01193"></a>01193             fprintf(fd, <span class="stringliteral">&quot;   %sif (__go)\n&quot;</span>, ctx-&gt;get());
<a name="l01194"></a>01194             fprintf(fd, <span class="stringliteral">&quot;   %s {\n&quot;</span>, ctx-&gt;get());
<a name="l01195"></a>01195             ctx-&gt;push();
<a name="l01196"></a>01196             fprintf(fd, <span class="stringliteral">&quot;   %s__o = __go;;\n&quot;</span>, ctx-&gt;get());
<a name="l01197"></a>01197             <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01198"></a>01198               fprintf(fd, <span class="stringliteral">&quot;   %s%s%s-&gt;setValue((eyedb::Agregat *)this, (eyedb::Data)&amp;__o, 1, %s);\n&quot;</span>,
<a name="l01199"></a>01199                       ctx-&gt;get(), psret, __agrdyn, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01200"></a>01200             <span class="keywordflow">else</span>
<a name="l01201"></a>01201               fprintf(fd, <span class="stringliteral">&quot;   %s%s%s[%d]-&gt;setValue((Agregat *)this, (eyedb::Data)&amp;__o, 1, %s);\n&quot;</span>,
<a name="l01202"></a>01202                       ctx-&gt;get(), psret, __agritems, num, (ndims ? <span class="stringliteral">&quot;from&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>));
<a name="l01203"></a>01203             fprintf(fd, <span class="stringliteral">&quot;   %seyedb::ObjectPeer::decrRefCount(__o);\n&quot;</span>, ctx-&gt;get());
<a name="l01204"></a>01204           
<a name="l01205"></a>01205             <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01206"></a>01206               RETURN_ERROR(fd, ctx, cls, <span class="stringliteral">&quot;   &quot;</span>);
<a name="l01207"></a>01207 
<a name="l01208"></a>01208             ctx-&gt;pop();
<a name="l01209"></a>01209             fprintf(fd, <span class="stringliteral">&quot;   %s }\n&quot;</span>, ctx-&gt;get());
<a name="l01210"></a>01210             fprintf(fd, <span class="stringliteral">&quot;%s  }\n&quot;</span>, ctx-&gt;get());
<a name="l01211"></a>01211           }
<a name="l01212"></a>01212       }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214     <span class="keywordflow">if</span> (attr_cache)
<a name="l01215"></a>01215       genAttrCacheGetEpilogue(ctx, optype);
<a name="l01216"></a>01216 
<a name="l01217"></a>01217     <span class="keywordflow">if</span> (const_obj)
<a name="l01218"></a>01218       fprintf(fd, <span class="stringliteral">&quot;%sreturn (%s%s)__o;\n&quot;</span>, ctx-&gt;get(),
<a name="l01219"></a>01219               classname, pure_ref);
<a name="l01220"></a>01220     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cls-&gt;asEnumClass())
<a name="l01221"></a>01221       fprintf(fd, <span class="stringliteral">&quot;%sreturn (%s)__tmp;\n&quot;</span>, ctx-&gt;get(), className(cls, True));
<a name="l01222"></a>01222     <span class="keywordflow">else</span>
<a name="l01223"></a>01223       fprintf(fd, <span class="stringliteral">&quot;%sreturn __tmp;\n&quot;</span>, ctx-&gt;get());
<a name="l01224"></a>01224 
<a name="l01225"></a>01225     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l01226"></a>01226 
<a name="l01227"></a>01227     <span class="comment">// WARNING: changed &apos;*_const || IS_RAW()&apos; to</span>
<a name="l01228"></a>01228     <span class="comment">// &apos;!isoid &amp;&amp; !IS_STRING()&apos; the 11/1/99</span>
<a name="l01229"></a>01229     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !isoid &amp;&amp; !*_const &amp;&amp; !IS_STRING())
<a name="l01230"></a>01230       {
<a name="l01231"></a>01231         fprintf(fd, <span class="stringliteral">&quot;unsigned int %s::%s(%s) const\n{\n&quot;</span>, className(own),
<a name="l01232"></a>01232                 ATTRNAME(name, tGetCount, hints), starg);
<a name="l01233"></a>01233 
<a name="l01234"></a>01234         <span class="keywordflow">if</span> (attr_cache)
<a name="l01235"></a>01235           genAttrCacheGetPrologue(ctx, GenCodeHints::tGetCount);
<a name="l01236"></a>01236 
<a name="l01237"></a>01237         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01238"></a>01238           dynamic_attr_gen(fd, ctx, <span class="keyword">this</span>, op_OTHER, isoid);
<a name="l01239"></a>01239 
<a name="l01240"></a>01240         gbx_suspend(ctx);
<a name="l01241"></a>01241 
<a name="l01242"></a>01242         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size size;\n&quot;</span>, ctx-&gt;get());
<a name="l01243"></a>01243         <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01244"></a>01244           {
<a name="l01245"></a>01245             <span class="comment">/*</span>
<a name="l01246"></a>01246 <span class="comment">              fprintf(fd, &quot;%seyedb::Status s, *ps;\n&quot;, ctx-&gt;get());</span>
<a name="l01247"></a>01247 <span class="comment">              fprintf(fd, &quot;%sps = (rs ? rs : &amp;s);\n&quot;, ctx-&gt;get());</span>
<a name="l01248"></a>01248 <span class="comment">            */</span>
<a name="l01249"></a>01249             fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status s;\n&quot;</span>, ctx-&gt;get());
<a name="l01250"></a>01250           }
<a name="l01251"></a>01251         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01252"></a>01252           fprintf(fd, <span class="stringliteral">&quot;%s%s%s-&gt;getSize(this, size);\n&quot;</span>, ctx-&gt;get(), psret,
<a name="l01253"></a>01253                   __agrdyn);
<a name="l01254"></a>01254         <span class="keywordflow">else</span>
<a name="l01255"></a>01255           fprintf(fd, <span class="stringliteral">&quot;%s%s%s[%d]-&gt;getSize(this, size);\n&quot;</span>, ctx-&gt;get(), psret,
<a name="l01256"></a>01256                   __agritems, num);
<a name="l01257"></a>01257         <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01258"></a>01258           fprintf(fd, <span class="stringliteral">&quot;%sif (s) {if (rs) *rs = s; return 0;}\n&quot;</span>, ctx-&gt;get());
<a name="l01259"></a>01259 
<a name="l01260"></a>01260         <span class="keywordflow">if</span> (attr_cache)
<a name="l01261"></a>01261           genAttrCacheGetEpilogue(ctx, GenCodeHints::tGetCount);
<a name="l01262"></a>01262 
<a name="l01263"></a>01263         fprintf(fd, <span class="stringliteral">&quot;%sreturn (int)size;\n&quot;</span>, ctx-&gt;get());
<a name="l01264"></a>01264         fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l01265"></a>01265       }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267     <span class="keywordflow">if</span> (cls-&gt;asCollectionClass())
<a name="l01268"></a>01268       <span class="keywordflow">return</span> generateCollGetMethod_C(own, ctx, isoid,
<a name="l01269"></a>01269                                      hints, _const);
<a name="l01270"></a>01270     <span class="keywordflow">return</span> Success;
<a name="l01271"></a>01271   }
<a name="l01272"></a>01272   
<a name="l01273"></a>01273   Status Attribute::generateBody_C(Class *own,
<a name="l01274"></a>01274                                    GenContext *ctx,
<a name="l01275"></a>01275                                    <span class="keyword">const</span> GenCodeHints &amp;hints)
<a name="l01276"></a>01276   {
<a name="l01277"></a>01277     FILE *fd = ctx-&gt;getFile();
<a name="l01278"></a>01278     <span class="keywordtype">int</span> ndims = typmod.ndims, i;
<a name="l01279"></a>01279     <span class="keywordtype">int</span> maxdims = typmod.maxdims;
<a name="l01280"></a>01280     <span class="keywordtype">int</span> not_basic = NOT_BASIC();
<a name="l01281"></a>01281     <span class="keyword">const</span> <span class="keywordtype">char</span> *ref = (not_basic ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>);
<a name="l01282"></a>01282     <span class="keywordtype">int</span> is_string = IS_STRING();
<a name="l01283"></a>01283     <span class="keywordtype">int</span> is_raw = IS_RAW();
<a name="l01284"></a>01284     <span class="keyword">const</span> <span class="keywordtype">char</span> *starg    = STATUS_ARG(hints, False);
<a name="l01285"></a>01285     <span class="keyword">const</span> <span class="keywordtype">char</span> *stargcom = STATUS_ARG(hints, True);
<a name="l01286"></a>01286     <span class="keyword">const</span> <span class="keywordtype">char</span> *psret = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288     <span class="comment">// set methods</span>
<a name="l01289"></a>01289     <span class="keywordflow">if</span> (is_string || is_raw)
<a name="l01290"></a>01290       {
<a name="l01291"></a>01291         <span class="keyword">const</span> <span class="keywordtype">char</span> *sclass = SCLASS();
<a name="l01292"></a>01292         <span class="keyword">const</span> <span class="keywordtype">char</span> *sarg = SARGIN();
<a name="l01293"></a>01293 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01294"></a>01294 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (is_string)
<a name="l01295"></a>01295           fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(const std::string &amp;_%s%s)\n{\n&quot;</span>,
<a name="l01296"></a>01296                   className(own), ATTRNAME(name, tSet, hints), name,
<a name="l01297"></a>01297                   sarg);
<a name="l01298"></a>01298         <span class="keywordflow">else</span>
<a name="l01299"></a>01299           fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(const %s *_%s%s)\n{\n&quot;</span>,
<a name="l01300"></a>01300                   className(own), ATTRNAME(name, tSet, hints), sclass, name,
<a name="l01301"></a>01301                   sarg);
<a name="l01302"></a>01302 <span class="preprocessor">#else</span>
<a name="l01303"></a>01303 <span class="preprocessor"></span>        fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(const %s *_%s%s)\n{\n&quot;</span>,
<a name="l01304"></a>01304                 className(own), ATTRNAME(name, tSet, hints), sclass, name,
<a name="l01305"></a>01305                 sarg);
<a name="l01306"></a>01306 <span class="preprocessor">#endif</span>
<a name="l01307"></a>01307 <span class="preprocessor"></span>
<a name="l01308"></a>01308         <span class="keywordflow">if</span> (attr_cache)
<a name="l01309"></a>01309           genAttrCacheSetPrologue(ctx, GenCodeHints::tSet, True);
<a name="l01310"></a>01310 
<a name="l01311"></a>01311         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01312"></a>01312           dynamic_attr_gen(fd, ctx, <span class="keyword">this</span>, op_SET);
<a name="l01313"></a>01313 
<a name="l01314"></a>01314         gbx_suspend(ctx);
<a name="l01315"></a>01315         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status status;\n&quot;</span>, ctx-&gt;get());
<a name="l01316"></a>01316       
<a name="l01317"></a>01317         <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01318"></a>01318           {
<a name="l01319"></a>01319             fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size size;\n&quot;</span>, ctx-&gt;get());
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01322"></a>01322 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (is_string)
<a name="l01323"></a>01323               fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size len = _%s.size() + 1;\n\n&quot;</span>, ctx-&gt;get(), name);
<a name="l01324"></a>01324 <span class="preprocessor">#else</span>
<a name="l01325"></a>01325 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (is_string)
<a name="l01326"></a>01326               fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size len = ::strlen(_%s) + 1;\n\n&quot;</span>, ctx-&gt;get(), name);
<a name="l01327"></a>01327 <span class="preprocessor">#endif</span>
<a name="l01328"></a>01328 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01329"></a>01329               fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;getSize(this, size);\n&quot;</span>, ctx-&gt;get(),
<a name="l01330"></a>01330                       __agrdyn);
<a name="l01331"></a>01331             <span class="keywordflow">else</span>
<a name="l01332"></a>01332               fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;getSize(this, size);\n&quot;</span>, ctx-&gt;get(),
<a name="l01333"></a>01333                       __agritems, num);
<a name="l01334"></a>01334             fprintf(fd, <span class="stringliteral">&quot;%sif (status)\n%s  return status;\n\n&quot;</span>, ctx-&gt;get(),
<a name="l01335"></a>01335                     ctx-&gt;get());
<a name="l01336"></a>01336             fprintf(fd, <span class="stringliteral">&quot;%sif (size != len)\n&quot;</span>, ctx-&gt;get());
<a name="l01337"></a>01337             ctx-&gt;push();
<a name="l01338"></a>01338             <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01339"></a>01339               fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setSize(this, len);\n&quot;</span>, ctx-&gt;get(),
<a name="l01340"></a>01340                       __agrdyn);
<a name="l01341"></a>01341             <span class="keywordflow">else</span>
<a name="l01342"></a>01342               fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setSize(this, len);\n&quot;</span>, ctx-&gt;get(),
<a name="l01343"></a>01343                       __agritems, num);
<a name="l01344"></a>01344             ctx-&gt;pop();
<a name="l01345"></a>01345             fprintf(fd, <span class="stringliteral">&quot;%sif (status)\n%s  return status;\n\n&quot;</span>, ctx-&gt;get(),
<a name="l01346"></a>01346                     ctx-&gt;get());
<a name="l01347"></a>01347 
<a name="l01348"></a>01348 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01349"></a>01349 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (odl_dynamic_attr) {
<a name="l01350"></a>01350               <span class="keywordflow">if</span> (is_string)
<a name="l01351"></a>01351                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setValue(this, (eyedb::Data)_%s.c_str(), len, 0);\n&quot;</span>,
<a name="l01352"></a>01352                         ctx-&gt;get(), __agrdyn, name);
<a name="l01353"></a>01353               <span class="keywordflow">else</span>
<a name="l01354"></a>01354                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setValue(this, (eyedb::Data)_%s., len, 0);\n&quot;</span>,
<a name="l01355"></a>01355                         ctx-&gt;get(), __agrdyn, name);
<a name="l01356"></a>01356             }
<a name="l01357"></a>01357             <span class="keywordflow">else</span> {
<a name="l01358"></a>01358               <span class="keywordflow">if</span> (is_string)
<a name="l01359"></a>01359                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)_%s.c_str(), len, 0);\n&quot;</span>,
<a name="l01360"></a>01360                         ctx-&gt;get(), __agritems, num, name);
<a name="l01361"></a>01361               <span class="keywordflow">else</span>
<a name="l01362"></a>01362                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)_%s, len, 0);\n&quot;</span>,
<a name="l01363"></a>01363                         ctx-&gt;get(), __agritems, num, name);
<a name="l01364"></a>01364             }
<a name="l01365"></a>01365 <span class="preprocessor">#else</span>
<a name="l01366"></a>01366 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01367"></a>01367               fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setValue(this, (eyedb::Data)_%s, len, 0);\n&quot;</span>,
<a name="l01368"></a>01368                       ctx-&gt;get(), __agrdyn, name);
<a name="l01369"></a>01369             <span class="keywordflow">else</span>
<a name="l01370"></a>01370               fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)_%s, len, 0);\n&quot;</span>,
<a name="l01371"></a>01371                       ctx-&gt;get(), __agritems, num, name);
<a name="l01372"></a>01372 <span class="preprocessor">#endif</span>
<a name="l01373"></a>01373 <span class="preprocessor"></span>
<a name="l01374"></a>01374             <span class="keywordflow">if</span> (attr_cache)
<a name="l01375"></a>01375               genAttrCacheSetEpilogue(ctx, GenCodeHints::tSet, True);
<a name="l01376"></a>01376             fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n\n&quot;</span>, ctx-&gt;get());
<a name="l01377"></a>01377           }
<a name="l01378"></a>01378         <span class="keywordflow">else</span>
<a name="l01379"></a>01379           {
<a name="l01380"></a>01380             <span class="keywordflow">if</span> (is_string) {
<a name="l01381"></a>01381               fprintf(fd, <span class="stringliteral">&quot;%sunsigned char data[%d];\n&quot;</span>, ctx-&gt;get(), maxdims);
<a name="l01382"></a>01382 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01383"></a>01383 <span class="preprocessor"></span>              fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size len = _%s.size();\n&quot;</span>, ctx-&gt;get(), name);
<a name="l01384"></a>01384 <span class="preprocessor">#else</span>
<a name="l01385"></a>01385 <span class="preprocessor"></span>              fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size len = ::strlen(_%s);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l01386"></a>01386 <span class="preprocessor">#endif</span>
<a name="l01387"></a>01387 <span class="preprocessor"></span>            }
<a name="l01388"></a>01388             fprintf(fd, <span class="stringliteral">&quot;%sif (len &gt;= %d)\n&quot;</span>, ctx-&gt;get(), maxdims);
<a name="l01389"></a>01389 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01390"></a>01390 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (is_string)
<a name="l01391"></a>01391               fprintf(fd, <span class="stringliteral">&quot;%s  return eyedb::Exception::make(eyedb::IDB_ERROR, &quot;</span>
<a name="l01392"></a>01392                       <span class="stringliteral">&quot;\&quot;string `%%s&apos; [%%d] too long for attribute %s::%s, maximum &quot;</span>
<a name="l01393"></a>01393                       <span class="stringliteral">&quot;is %d\\n\&quot;, _%s.c_str(), len);\n&quot;</span>, ctx-&gt;get(),
<a name="l01394"></a>01394                       class_owner-&gt;getName(), name, maxdims, name);
<a name="l01395"></a>01395             <span class="keywordflow">else</span>
<a name="l01396"></a>01396               fprintf(fd, <span class="stringliteral">&quot;%s  return eyedb::Exception::make(eyedb::IDB_ERROR, &quot;</span>
<a name="l01397"></a>01397                       <span class="stringliteral">&quot;\&quot;string `%%s&apos; [%%d] too long for attribute %s::%s, maximum &quot;</span>
<a name="l01398"></a>01398                       <span class="stringliteral">&quot;is %d\\n\&quot;, _%s, len);\n&quot;</span>, ctx-&gt;get(),
<a name="l01399"></a>01399                       class_owner-&gt;getName(), name, maxdims, name);
<a name="l01400"></a>01400 <span class="preprocessor">#else</span>
<a name="l01401"></a>01401 <span class="preprocessor"></span>            fprintf(fd, <span class="stringliteral">&quot;%s  return eyedb::Exception::make(eyedb::IDB_ERROR, &quot;</span>
<a name="l01402"></a>01402                     <span class="stringliteral">&quot;\&quot;string `%%s&apos; [%%d] too long for attribute %s::%s, maximum &quot;</span>
<a name="l01403"></a>01403                     <span class="stringliteral">&quot;is %d\\n\&quot;, _%s, len);\n&quot;</span>, ctx-&gt;get(),
<a name="l01404"></a>01404                     class_owner-&gt;getName(), name, maxdims, name);
<a name="l01405"></a>01405 <span class="preprocessor">#endif</span>
<a name="l01406"></a>01406 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (is_string) {
<a name="l01407"></a>01407               fprintf(fd, <span class="stringliteral">&quot;%smemset(data, 0, %d);\n&quot;</span>, ctx-&gt;get(), maxdims);
<a name="l01408"></a>01408 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01409"></a>01409 <span class="preprocessor"></span>              fprintf(fd, <span class="stringliteral">&quot;%sstrncpy((char *)data, _%s.c_str(), min(%d, len));\n&quot;</span>,
<a name="l01410"></a>01410                       ctx-&gt;get(), name, maxdims-1);
<a name="l01411"></a>01411 <span class="preprocessor">#else</span>
<a name="l01412"></a>01412 <span class="preprocessor"></span>              fprintf(fd, <span class="stringliteral">&quot;%sstrncpy((char *)data, _%s, min(%d, len));\n&quot;</span>,
<a name="l01413"></a>01413                       ctx-&gt;get(), name, maxdims-1);
<a name="l01414"></a>01414 <span class="preprocessor">#endif</span>
<a name="l01415"></a>01415 <span class="preprocessor"></span>              <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01416"></a>01416                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setValue(this, data, %d, 0);\n&quot;</span>,
<a name="l01417"></a>01417                         ctx-&gt;get(), __agrdyn, maxdims);
<a name="l01418"></a>01418               <span class="keywordflow">else</span>
<a name="l01419"></a>01419                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setValue(this, data, %d, 0);\n&quot;</span>,
<a name="l01420"></a>01420                         ctx-&gt;get(), __agritems, num, maxdims);
<a name="l01421"></a>01421             }
<a name="l01422"></a>01422             <span class="keywordflow">else</span> {
<a name="l01423"></a>01423 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01424"></a>01424 <span class="preprocessor"></span>              <span class="keywordflow">if</span> (odl_dynamic_attr) {
<a name="l01425"></a>01425                 <span class="keywordflow">if</span> (is_string)
<a name="l01426"></a>01426                   fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setValue(this, (eyedb::Data)_%s.c_str(), len, 0);\n&quot;</span>,
<a name="l01427"></a>01427                           ctx-&gt;get(), __agrdyn, name);
<a name="l01428"></a>01428                 <span class="keywordflow">else</span>
<a name="l01429"></a>01429                   fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setValue(this, (eyedb::Data)_%s, len, 0);\n&quot;</span>,
<a name="l01430"></a>01430                           ctx-&gt;get(), __agrdyn, name);
<a name="l01431"></a>01431               }
<a name="l01432"></a>01432               <span class="keywordflow">else</span> {
<a name="l01433"></a>01433                 <span class="keywordflow">if</span> (is_string)
<a name="l01434"></a>01434                   fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)_%s.c_str(), len, 0);\n&quot;</span>,
<a name="l01435"></a>01435                           ctx-&gt;get(), __agritems, num, name);
<a name="l01436"></a>01436                 <span class="keywordflow">else</span>
<a name="l01437"></a>01437                   fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)_%s, len, 0);\n&quot;</span>,
<a name="l01438"></a>01438                           ctx-&gt;get(), __agritems, num, name);
<a name="l01439"></a>01439               }
<a name="l01440"></a>01440 <span class="preprocessor">#else</span>
<a name="l01441"></a>01441 <span class="preprocessor"></span>              <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01442"></a>01442                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setValue(this, (eyedb::Data)_%s, len, 0);\n&quot;</span>,
<a name="l01443"></a>01443                         ctx-&gt;get(), __agrdyn, name);
<a name="l01444"></a>01444               <span class="keywordflow">else</span>
<a name="l01445"></a>01445                 fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setValue(this, (eyedb::Data)_%s, len, 0);\n&quot;</span>,
<a name="l01446"></a>01446                         ctx-&gt;get(), __agritems, num, name);
<a name="l01447"></a>01447 <span class="preprocessor">#endif</span>
<a name="l01448"></a>01448 <span class="preprocessor"></span>            }
<a name="l01449"></a>01449 
<a name="l01450"></a>01450             <span class="keywordflow">if</span> (attr_cache)
<a name="l01451"></a>01451               genAttrCacheSetEpilogue(ctx, GenCodeHints::tSet, True);
<a name="l01452"></a>01452             fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n\n&quot;</span>, ctx-&gt;get());
<a name="l01453"></a>01453           }
<a name="l01454"></a>01454         fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l01455"></a>01455       }
<a name="l01456"></a>01456 
<a name="l01457"></a>01457     <span class="comment">/* warning:</span>
<a name="l01458"></a>01458 <span class="comment">     * the methods setXxx() should be avoided when xxx is a non basic</span>
<a name="l01459"></a>01459 <span class="comment">     * and direct, because the direct Object.has already been allocated</span>
<a name="l01460"></a>01460 <span class="comment">     * in the object construction.</span>
<a name="l01461"></a>01461 <span class="comment">     * The problem is for the vardim: the setXxx(int w, Xxx *x) method sets</span>
<a name="l01462"></a>01462 <span class="comment">     * the size and sets the `x&apos; object.</span>
<a name="l01463"></a>01463 <span class="comment">     * So if we suppress the setXxx() method, one should had a method for</span>
<a name="l01464"></a>01464 <span class="comment">     * vardim: setXxx_cnt() or setXxx_size to set the size.</span>
<a name="l01465"></a>01465 <span class="comment">     */</span>
<a name="l01466"></a>01466 
<a name="l01467"></a>01467 <span class="preprocessor">#ifdef NO_DIRECT_SET</span>
<a name="l01468"></a>01468 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() || !not_basic) <span class="comment">// added 22/09/98</span>
<a name="l01469"></a>01469 <span class="preprocessor">#endif</span>
<a name="l01470"></a>01470 <span class="preprocessor"></span>      generateSetMethod_C(own, ctx, False, hints);
<a name="l01471"></a>01471 <span class="preprocessor">#ifdef NO_DIRECT_SET</span>
<a name="l01472"></a>01472 <span class="preprocessor"></span>    <span class="keywordflow">else</span>
<a name="l01473"></a>01473 <span class="preprocessor">#endif</span>
<a name="l01474"></a>01474 <span class="preprocessor"></span><span class="preprocessor">#if defined(SET_COUNT_DIRECT) || defined(NO_DIRECT_SET)</span>
<a name="l01475"></a>01475 <span class="preprocessor"></span>      <span class="comment">// 23/05/06: suppressed !isIndirect()</span>
<a name="l01476"></a>01476       <span class="comment">//      if (isVarDim() &amp;&amp; !isIndirect() &amp;&amp; !is_string) /*&amp;&amp; not_basic*/</span>
<a name="l01477"></a>01477       <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !is_string) <span class="comment">/*&amp;&amp; not_basic*/</span>
<a name="l01478"></a>01478         {
<a name="l01479"></a>01479           fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(&quot;</span>, className(own),
<a name="l01480"></a>01480                   ATTRNAME(name, tSetCount, hints));
<a name="l01481"></a>01481       
<a name="l01482"></a>01482           dimArgsGen(fd, ndims, True);
<a name="l01483"></a>01483       
<a name="l01484"></a>01484           fprintf(fd, <span class="stringliteral">&quot;)\n{\n&quot;</span>);
<a name="l01485"></a>01485 
<a name="l01486"></a>01486           <span class="keywordflow">if</span> (attr_cache)
<a name="l01487"></a>01487             genAttrCacheSetPrologue(ctx, GenCodeHints::tSetCount);
<a name="l01488"></a>01488 
<a name="l01489"></a>01489           <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01490"></a>01490             dynamic_attr_gen(fd, ctx, <span class="keyword">this</span>, op_SET);
<a name="l01491"></a>01491 
<a name="l01492"></a>01492           gbx_suspend(ctx);
<a name="l01493"></a>01493 
<a name="l01494"></a>01494           fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status status;\n&quot;</span>, ctx-&gt;get());
<a name="l01495"></a>01495 
<a name="l01496"></a>01496           fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size from = a%d;\n&quot;</span>, ctx-&gt;get(), ndims-1);
<a name="l01497"></a>01497           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = ndims - 2 ; i &gt;= 0; i--)
<a name="l01498"></a>01498             fprintf(fd, <span class="stringliteral">&quot;%sfrom += a%d * %d;\n&quot;</span>, ctx-&gt;get(), i, typmod.dims[i]);
<a name="l01499"></a>01499 
<a name="l01500"></a>01500           <span class="comment">// disconnected the 3/09/01: it is not useful to forbid to</span>
<a name="l01501"></a>01501           <span class="comment">// decrement count!</span>
<a name="l01502"></a>01502 <span class="preprocessor">#if 0</span>
<a name="l01503"></a>01503 <span class="preprocessor"></span>          fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Size size;\n&quot;</span>, ctx-&gt;get());
<a name="l01504"></a>01504           <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01505"></a>01505             fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;getSize(this, size);\n&quot;</span>,
<a name="l01506"></a>01506                     ctx-&gt;get(), __agrdyn);
<a name="l01507"></a>01507           <span class="keywordflow">else</span>
<a name="l01508"></a>01508             fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;getSize(this, size);\n&quot;</span>,
<a name="l01509"></a>01509                     ctx-&gt;get(), __agritems, num);
<a name="l01510"></a>01510           fprintf(fd, <span class="stringliteral">&quot;%sif (status)\n%s  return status;\n\n&quot;</span>, ctx-&gt;get(),
<a name="l01511"></a>01511                   ctx-&gt;get());
<a name="l01512"></a>01512           <span class="comment">// changed the 24/08/99</span>
<a name="l01513"></a>01513           fprintf(fd, <span class="stringliteral">&quot;%sif (size &lt; from)\n&quot;</span>, ctx-&gt;get());
<a name="l01514"></a>01514           ctx-&gt;push();
<a name="l01515"></a>01515 <span class="preprocessor">#endif</span>
<a name="l01516"></a>01516 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01517"></a>01517             fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s-&gt;setSize(this, from);\n&quot;</span>,
<a name="l01518"></a>01518                     ctx-&gt;get(), __agrdyn);
<a name="l01519"></a>01519           <span class="keywordflow">else</span>
<a name="l01520"></a>01520             fprintf(fd, <span class="stringliteral">&quot;%sstatus = %s[%d]-&gt;setSize(this, from);\n&quot;</span>,
<a name="l01521"></a>01521                     ctx-&gt;get(), __agritems, num);
<a name="l01522"></a>01522 
<a name="l01523"></a>01523 <span class="preprocessor">#if 0</span>
<a name="l01524"></a>01524 <span class="preprocessor"></span>          ctx-&gt;pop();
<a name="l01525"></a>01525 <span class="preprocessor">#endif</span>
<a name="l01526"></a>01526 <span class="preprocessor"></span>
<a name="l01527"></a>01527           <span class="keywordflow">if</span> (attr_cache)
<a name="l01528"></a>01528             genAttrCacheSetEpilogue(ctx, GenCodeHints::tSetCount);
<a name="l01529"></a>01529 
<a name="l01530"></a>01530           fprintf(fd, <span class="stringliteral">&quot;%sreturn status;\n&quot;</span>, ctx-&gt;get(),
<a name="l01531"></a>01531                   ctx-&gt;get());
<a name="l01532"></a>01532 
<a name="l01533"></a>01533           fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l01534"></a>01534         }
<a name="l01535"></a>01535 <span class="preprocessor">#endif</span>
<a name="l01536"></a>01536 <span class="preprocessor"></span>
<a name="l01537"></a>01537     <span class="comment">// get methods</span>
<a name="l01538"></a>01538     <span class="keywordflow">if</span> (is_string || is_raw)
<a name="l01539"></a>01539       {
<a name="l01540"></a>01540         <span class="keyword">const</span> <span class="keywordtype">char</span> *sclass = SCLASS();
<a name="l01541"></a>01541         <span class="keyword">const</span> <span class="keywordtype">char</span> *sarg = SARGOUT();
<a name="l01542"></a>01542         
<a name="l01543"></a>01543 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01544"></a>01544 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (is_string)
<a name="l01545"></a>01545           fprintf(fd, <span class="stringliteral">&quot;std::string %s::%s(%seyedb::Bool *isnull%s) const\n{\n&quot;</span>, 
<a name="l01546"></a>01546                   className(own), ATTRNAME(name, tGet, hints), sarg,
<a name="l01547"></a>01547                   stargcom);
<a name="l01548"></a>01548         <span class="keywordflow">else</span>
<a name="l01549"></a>01549           fprintf(fd, <span class="stringliteral">&quot;const %s *%s::%s(%seyedb::Bool *isnull%s) const\n{\n&quot;</span>, 
<a name="l01550"></a>01550                   sclass, className(own), ATTRNAME(name, tGet, hints), sarg,
<a name="l01551"></a>01551                   stargcom);
<a name="l01552"></a>01552 <span class="preprocessor">#else</span>
<a name="l01553"></a>01553 <span class="preprocessor"></span>        fprintf(fd, <span class="stringliteral">&quot;const %s *%s::%s(%seyedb::Bool *isnull%s) const\n{\n&quot;</span>, 
<a name="l01554"></a>01554                 sclass, className(own), ATTRNAME(name, tGet, hints), sarg,
<a name="l01555"></a>01555                 stargcom);
<a name="l01556"></a>01556 <span class="preprocessor">#endif</span>
<a name="l01557"></a>01557 <span class="preprocessor"></span>
<a name="l01558"></a>01558         <span class="keywordflow">if</span> (attr_cache)
<a name="l01559"></a>01559           genAttrCacheGetPrologue(ctx, GenCodeHints::tGet, True);
<a name="l01560"></a>01560 
<a name="l01561"></a>01561         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01562"></a>01562           dynamic_attr_gen(fd, ctx, <span class="keyword">this</span>, op_GET, False, IDBBOOL(is_string));
<a name="l01563"></a>01563 
<a name="l01564"></a>01564         gbx_suspend(ctx);
<a name="l01565"></a>01565 
<a name="l01566"></a>01566         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Data data;\n&quot;</span>, ctx-&gt;get());
<a name="l01567"></a>01567         <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01568"></a>01568           {
<a name="l01569"></a>01569             <span class="comment">/*</span>
<a name="l01570"></a>01570 <span class="comment">              fprintf(fd, &quot;%seyedb::Status s, *ps;\n&quot;, ctx-&gt;get());</span>
<a name="l01571"></a>01571 <span class="comment">              fprintf(fd, &quot;%sps = (rs ? rs : &amp;s);\n&quot;, ctx-&gt;get());</span>
<a name="l01572"></a>01572 <span class="comment">              psret = &quot;*ps = &quot;;</span>
<a name="l01573"></a>01573 <span class="comment">            */</span>
<a name="l01574"></a>01574             fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status s;\n&quot;</span>, ctx-&gt;get());
<a name="l01575"></a>01575             psret = <span class="stringliteral">&quot;s = &quot;</span>;
<a name="l01576"></a>01576           }
<a name="l01577"></a>01577         <span class="keywordflow">if</span> (odl_dynamic_attr)
<a name="l01578"></a>01578           fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s-&gt;getValue(this, (eyedb::Data *)&amp;data, eyedb::Attribute::directAccess, 0, isnull);\n&quot;</span>,
<a name="l01579"></a>01579                   ctx-&gt;get(), psret, __agrdyn);
<a name="l01580"></a>01580         <span class="keywordflow">else</span>
<a name="l01581"></a>01581           fprintf(fd, <span class="stringliteral">&quot;\n%s%s%s[%d]-&gt;getValue(this, (eyedb::Data *)&amp;data, eyedb::Attribute::directAccess, 0, isnull);\n&quot;</span>,
<a name="l01582"></a>01582                   ctx-&gt;get(), psret, __agritems, num);
<a name="l01583"></a>01583 
<a name="l01584"></a>01584         <span class="keywordflow">if</span> (hints.error_policy == GenCodeHints::StatusErrorPolicy)
<a name="l01585"></a>01585           RETURN_ERROR(fd, ctx, cls, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01586"></a>01586 
<a name="l01587"></a>01587         <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01588"></a>01588           fprintf(fd, <span class="stringliteral">&quot;%sif (!data) data = nulldata;\n&quot;</span>, ctx-&gt;get());
<a name="l01589"></a>01589 
<a name="l01590"></a>01590         <span class="keywordflow">if</span> (attr_cache)
<a name="l01591"></a>01591           genAttrCacheGetEpilogue(ctx, GenCodeHints::tGet, True);
<a name="l01592"></a>01592 
<a name="l01593"></a>01593         <span class="keywordflow">if</span> (is_raw &amp;&amp; <a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01594"></a>01594           fprintf(fd, <span class="stringliteral">&quot;%sif (len) *len = %s();\n&quot;</span>, ctx-&gt;get(),
<a name="l01595"></a>01595                   ATTRNAME(name, tGetCount, hints));
<a name="l01596"></a>01596         <span class="comment">//fprintf(fd, &quot;%sif (s &amp;&amp; rs) *rs = s;\n&quot;, ctx-&gt;get());</span>
<a name="l01597"></a>01597         <span class="keywordflow">if</span> (attr_cache) {
<a name="l01598"></a>01598 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01599"></a>01599 <span class="preprocessor"></span>          fprintf(fd, <span class="stringliteral">&quot;%sreturn %s;\n&quot;</span>, ctx-&gt;get(),
<a name="l01600"></a>01600                   atc_name(name));
<a name="l01601"></a>01601 <span class="preprocessor">#else</span>
<a name="l01602"></a>01602 <span class="preprocessor"></span>          fprintf(fd, <span class="stringliteral">&quot;%sreturn (const %s *)%s;\n&quot;</span>, ctx-&gt;get(), sclass,
<a name="l01603"></a>01603                   atc_name(name));
<a name="l01604"></a>01604 <span class="preprocessor">#endif</span>
<a name="l01605"></a>01605 <span class="preprocessor"></span>        }
<a name="l01606"></a>01606         <span class="keywordflow">else</span>
<a name="l01607"></a>01607           fprintf(fd, <span class="stringliteral">&quot;%sreturn (const %s *)data;\n&quot;</span>, ctx-&gt;get(), sclass);
<a name="l01608"></a>01608         fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l01609"></a>01609       }
<a name="l01610"></a>01610     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (not_basic)
<a name="l01611"></a>01611       generateGetMethod_C(own, ctx, False, hints, <span class="stringliteral">&quot;const &quot;</span>);
<a name="l01612"></a>01612 
<a name="l01613"></a>01613     generateGetMethod_C(own, ctx, False, hints, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01614"></a>01614 
<a name="l01615"></a>01615     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>())
<a name="l01616"></a>01616       {
<a name="l01617"></a>01617         generateSetMethod_C(own, ctx, True, hints);
<a name="l01618"></a>01618         generateGetMethod_C(own, ctx, True, hints, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01619"></a>01619       }
<a name="l01620"></a>01620     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cls-&gt;asCollectionClass())
<a name="l01621"></a>01621       generateCollGetMethod_C(own, ctx, True, hints, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623     generateSetMethod_C(own, ctx, hints);
<a name="l01624"></a>01624 
<a name="l01625"></a>01625     <span class="keywordflow">return</span> Success;
<a name="l01626"></a>01626   }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628   <span class="comment">//</span>
<a name="l01629"></a>01629   <span class="comment">// Attribute Cache Methods</span>
<a name="l01630"></a>01630   <span class="comment">//</span>
<a name="l01631"></a>01631   <span class="comment">// on peut se limiter dans un premier temps :</span>
<a name="l01632"></a>01632   <span class="comment">//</span>
<a name="l01633"></a>01633   <span class="comment">// - type de dimensions fixes:</span>
<a name="l01634"></a>01634   <span class="comment">//   + get/set</span>
<a name="l01635"></a>01635   <span class="comment">//   + getoid/setoid</span>
<a name="l01636"></a>01636   <span class="comment">//</span>
<a name="l01637"></a>01637   <span class="comment">// - type string:</span>
<a name="l01638"></a>01638   <span class="comment">//   + get/set</span>
<a name="l01639"></a>01639   <span class="comment">//</span>
<a name="l01640"></a>01640   <span class="comment">// - type de dimension variable:</span>
<a name="l01641"></a>01641   <span class="comment">//   + getcount/setcount</span>
<a name="l01642"></a>01642 
<a name="l01643"></a>01643 <span class="preprocessor">#define ATC_NOVD // acronym for ATtribute Cache NO VarDim</span>
<a name="l01644"></a>01644 <span class="preprocessor"></span>
<a name="l01645"></a>01645   <span class="keywordtype">void</span>
<a name="l01646"></a>01646   Attribute::genAttrCacheDecl(GenContext *ctx)
<a name="l01647"></a>01647   {
<a name="l01648"></a>01648     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#a33d6b35e77bdb945edef1da261424c77" title="Not yet documented.">isNative</a>()) <span class="keywordflow">return</span>;
<a name="l01649"></a>01649 
<a name="l01650"></a>01650 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01651"></a>01651 <span class="preprocessor"></span>    <span class="comment">//  if (isVarDim() &amp;&amp; !IS_STRING()) return;</span>
<a name="l01652"></a>01652 <span class="preprocessor">#endif</span>
<a name="l01653"></a>01653 <span class="preprocessor"></span>    FILE *fd = ctx-&gt;getFile();
<a name="l01654"></a>01654 
<a name="l01655"></a>01655     <span class="keywordtype">int</span> is_string = IS_STRING();
<a name="l01656"></a>01656     <span class="keywordtype">int</span> is_raw = IS_RAW();
<a name="l01657"></a>01657     <span class="keywordtype">int</span> i;
<a name="l01658"></a>01658 
<a name="l01659"></a>01659     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01660"></a>01660       fprintf(fd, <span class="stringliteral">&quot;%sunsigned int %s;\n&quot;</span>, ctx-&gt;get(), atc_cnt(name));
<a name="l01661"></a>01661 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01662"></a>01662 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !(is_string || is_raw))
<a name="l01663"></a>01663       <span class="keywordflow">return</span>;
<a name="l01664"></a>01664 <span class="preprocessor">#endif</span>
<a name="l01665"></a>01665 <span class="preprocessor"></span>
<a name="l01666"></a>01666     fprintf(fd, <span class="stringliteral">&quot;%sunsigned char &quot;</span>, ctx-&gt;get());
<a name="l01667"></a>01667 
<a name="l01668"></a>01668 <span class="preprocessor">#ifndef ATC_NOVD</span>
<a name="l01669"></a>01669 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01670"></a>01670       fprintf(fd, getPtrRet());
<a name="l01671"></a>01671 <span class="preprocessor">#endif</span>
<a name="l01672"></a>01672 <span class="preprocessor"></span>
<a name="l01673"></a>01673     fprintf(fd, atc_set(name));
<a name="l01674"></a>01674     <span class="keywordflow">if</span> (!is_string &amp;&amp; !is_raw)
<a name="l01675"></a>01675       {
<a name="l01676"></a>01676         <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01677"></a>01677           <span class="keywordflow">if</span> (typmod.dims[i] &gt; 0)
<a name="l01678"></a>01678             fprintf(fd, <span class="stringliteral">&quot;[%d]&quot;</span>, typmod.dims[i]);
<a name="l01679"></a>01679       }
<a name="l01680"></a>01680     fprintf(fd, <span class="stringliteral">&quot;;\n&quot;</span>);
<a name="l01681"></a>01681 
<a name="l01682"></a>01682     <span class="keywordflow">if</span> (is_string || is_raw)
<a name="l01683"></a>01683       {
<a name="l01684"></a>01684 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01685"></a>01685 <span class="preprocessor"></span><span class="preprocessor">#ifdef ATTR_CACHE_DIRECT</span>
<a name="l01686"></a>01686 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (is_string)
<a name="l01687"></a>01687           fprintf(fd, <span class="stringliteral">&quot;%sstd::string %s;\n&quot;</span>, ctx-&gt;get(), atc_name(name));
<a name="l01688"></a>01688         <span class="keywordflow">else</span>
<a name="l01689"></a>01689           fprintf(fd, <span class="stringliteral">&quot;%sconst %s *%s;\n&quot;</span>, ctx-&gt;get(), SCLASS(), atc_name(name));
<a name="l01690"></a>01690 <span class="preprocessor">#else</span>
<a name="l01691"></a>01691 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (is_string)
<a name="l01692"></a>01692           fprintf(fd, <span class="stringliteral">&quot;%sstd::string %s;\n&quot;</span>, ctx-&gt;get(), atc_name(name));
<a name="l01693"></a>01693         <span class="keywordflow">else</span>
<a name="l01694"></a>01694           fprintf(fd, <span class="stringliteral">&quot;%s%s *%s;\n&quot;</span>, ctx-&gt;get(), SCLASS(), atc_name(name));
<a name="l01695"></a>01695 <span class="preprocessor">#endif</span>
<a name="l01696"></a>01696 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l01697"></a>01697 <span class="preprocessor"></span><span class="preprocessor">#ifdef ATTR_CACHE_DIRECT</span>
<a name="l01698"></a>01698 <span class="preprocessor"></span>        fprintf(fd, <span class="stringliteral">&quot;%sconst %s *%s;\n&quot;</span>, ctx-&gt;get(), SCLASS(), atc_name(name));
<a name="l01699"></a>01699 <span class="preprocessor">#else</span>
<a name="l01700"></a>01700 <span class="preprocessor"></span>        fprintf(fd, <span class="stringliteral">&quot;%s%s *%s;\n&quot;</span>, ctx-&gt;get(), SCLASS(), atc_name(name));
<a name="l01701"></a>01701 <span class="preprocessor">#endif</span>
<a name="l01702"></a>01702 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01703"></a>01703 <span class="preprocessor"></span>        <span class="keywordflow">return</span>;
<a name="l01704"></a>01704       }
<a name="l01705"></a>01705     <span class="keywordflow">else</span>
<a name="l01706"></a>01706       fprintf(fd, <span class="stringliteral">&quot;%s%s%s%s%s&quot;</span>,
<a name="l01707"></a>01707               ctx-&gt;get(), className(cls, (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() ? True : False)),
<a name="l01708"></a>01708               (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>), (NOT_BASIC() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>), atc_name(name));
<a name="l01709"></a>01709 
<a name="l01710"></a>01710     <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01711"></a>01711       <span class="keywordflow">if</span> (typmod.dims[i] &gt; 0)
<a name="l01712"></a>01712         fprintf(fd, <span class="stringliteral">&quot;[%d]&quot;</span>, typmod.dims[i]);
<a name="l01713"></a>01713 
<a name="l01714"></a>01714     fprintf(fd, <span class="stringliteral">&quot;;\n&quot;</span>);
<a name="l01715"></a>01715   }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717   <span class="keywordtype">void</span>
<a name="l01718"></a>01718   Attribute::genAttrCacheEmpty(GenContext *ctx)
<a name="l01719"></a>01719   {
<a name="l01720"></a>01720     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#a33d6b35e77bdb945edef1da261424c77" title="Not yet documented.">isNative</a>())
<a name="l01721"></a>01721       <span class="keywordflow">return</span>;
<a name="l01722"></a>01722 
<a name="l01723"></a>01723 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01724"></a>01724 <span class="preprocessor"></span>    <span class="comment">//  if (isVarDim() &amp;&amp; !IS_STRING()) return;</span>
<a name="l01725"></a>01725 <span class="preprocessor">#endif</span>
<a name="l01726"></a>01726 <span class="preprocessor"></span>
<a name="l01727"></a>01727     <span class="keywordtype">int</span> is_string = IS_STRING();
<a name="l01728"></a>01728     <span class="keywordtype">int</span> is_raw = IS_RAW();
<a name="l01729"></a>01729 
<a name="l01730"></a>01730     FILE *fd = ctx-&gt;getFile();
<a name="l01731"></a>01731     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01732"></a>01732       fprintf(fd, <span class="stringliteral">&quot;%s%s = ~0;\n&quot;</span>, ctx-&gt;get(), atc_cnt(name));
<a name="l01733"></a>01733 
<a name="l01734"></a>01734 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01735"></a>01735 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !(is_string || is_raw)) <span class="keywordflow">return</span>;
<a name="l01736"></a>01736 <span class="preprocessor">#endif</span>
<a name="l01737"></a>01737 <span class="preprocessor"></span>
<a name="l01738"></a>01738     <span class="keywordflow">if</span> (!typmod.ndims || is_string || is_raw) {
<a name="l01739"></a>01739 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l01740"></a>01740 <span class="preprocessor"></span>      <span class="comment">/*</span>
<a name="l01741"></a>01741 <span class="comment">      if (is_string)</span>
<a name="l01742"></a>01742 <span class="comment">        fprintf(fd, &quot;%s%s = &quot;&quot;;\n&quot;, ctx-&gt;get(), atc_set(name));</span>
<a name="l01743"></a>01743 <span class="comment">      else</span>
<a name="l01744"></a>01744 <span class="comment">      */</span>
<a name="l01745"></a>01745       fprintf(fd, <span class="stringliteral">&quot;%s%s = 0;\n&quot;</span>, ctx-&gt;get(), atc_set(name));
<a name="l01746"></a>01746 <span class="preprocessor">#else</span>
<a name="l01747"></a>01747 <span class="preprocessor"></span>      fprintf(fd, <span class="stringliteral">&quot;%s%s = 0;\n&quot;</span>, ctx-&gt;get(), atc_set(name));
<a name="l01748"></a>01748 <span class="preprocessor">#endif</span>
<a name="l01749"></a>01749 <span class="preprocessor"></span>    }
<a name="l01750"></a>01750     <span class="keywordflow">else</span>
<a name="l01751"></a>01751       fprintf(fd, <span class="stringliteral">&quot;%smemset(%s, 0, %d);\n&quot;</span>, ctx-&gt;get(), atc_set(name),
<a name="l01752"></a>01752               typmod.pdims);
<a name="l01753"></a>01753   }
<a name="l01754"></a>01754 
<a name="l01755"></a>01755   <span class="keywordtype">void</span>
<a name="l01756"></a>01756   Attribute::genAttrCacheGarbage(GenContext *ctx)
<a name="l01757"></a>01757   {
<a name="l01758"></a>01758     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#a33d6b35e77bdb945edef1da261424c77" title="Not yet documented.">isNative</a>()) <span class="keywordflow">return</span>;
<a name="l01759"></a>01759 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01760"></a>01760 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !(IS_STRING() || IS_RAW())) <span class="keywordflow">return</span>;
<a name="l01761"></a>01761 <span class="preprocessor">#endif</span>
<a name="l01762"></a>01762 <span class="preprocessor"></span>
<a name="l01763"></a>01763     <span class="comment">//  if (isNative() || !isVarDim()) return;</span>
<a name="l01764"></a>01764     FILE *fd = ctx-&gt;getFile();
<a name="l01765"></a>01765 
<a name="l01766"></a>01766     <span class="keywordflow">if</span> (IS_STRING() || IS_RAW())
<a name="l01767"></a>01767       {
<a name="l01768"></a>01768 <span class="preprocessor">#ifndef ATTR_CACHE_DIRECT</span>
<a name="l01769"></a>01769 <span class="preprocessor"></span>        fprintf(fd, <span class="stringliteral">&quot;%sif (%s) free(%s);\n&quot;</span>, ctx-&gt;get(), atc_set(name),
<a name="l01770"></a>01770                 atc_name(name));
<a name="l01771"></a>01771 <span class="preprocessor">#endif</span>
<a name="l01772"></a>01772 <span class="preprocessor"></span>        <span class="keywordflow">return</span>;
<a name="l01773"></a>01773       }
<a name="l01774"></a>01774 
<a name="l01775"></a>01775     <span class="keywordflow">if</span> (!<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>()) <span class="keywordflow">return</span>;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777     <span class="comment">// TODO: NOTE: si les precedents malloc() sont bons pour les vardim, alors</span>
<a name="l01778"></a>01778     <span class="comment">// les free qui suivent ne sont pas corrects; en effet, il faut</span>
<a name="l01779"></a>01779     <span class="comment">// liberer tous les pointeurs d&apos;un tableau. -&gt; il me semble qu&apos;il y a</span>
<a name="l01780"></a>01780     <span class="comment">// un peu de confusion!</span>
<a name="l01781"></a>01781 
<a name="l01782"></a>01782     fprintf(fd, <span class="stringliteral">&quot;%sif (%s) {free(%s); free(%s);}\n&quot;</span>, ctx-&gt;get(), atc_cnt(name),
<a name="l01783"></a>01783             atc_set(name), atc_name(name));
<a name="l01784"></a>01784   }
<a name="l01785"></a>01785 
<a name="l01786"></a>01786   <span class="keywordtype">void</span>
<a name="l01787"></a>01787   Attribute::genAttrCacheGetPrologue(GenContext *ctx, <span class="keywordtype">int</span> optype,
<a name="l01788"></a>01788                                      Bool is_raw_string)
<a name="l01789"></a>01789   {
<a name="l01790"></a>01790 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01791"></a>01791 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (optype != GenCodeHints::tGetCount)
<a name="l01792"></a>01792       {
<a name="l01793"></a>01793         <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !is_raw_string)
<a name="l01794"></a>01794           <span class="keywordflow">return</span>;
<a name="l01795"></a>01795         <span class="keywordflow">if</span> ((IS_STRING() || IS_RAW()) &amp;&amp; !is_raw_string)
<a name="l01796"></a>01796           <span class="keywordflow">return</span>;
<a name="l01797"></a>01797       }
<a name="l01798"></a>01798 <span class="preprocessor">#endif</span>
<a name="l01799"></a>01799 <span class="preprocessor"></span>
<a name="l01800"></a>01800     <span class="keywordflow">if</span> (optype == GenCodeHints::tGetOid &amp;&amp; !<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>()) <span class="keywordflow">return</span>;
<a name="l01801"></a>01801 
<a name="l01802"></a>01802     <span class="keywordflow">if</span> (optype == GenCodeHints::tGetOid) <span class="keywordflow">return</span>;
<a name="l01803"></a>01803 
<a name="l01804"></a>01804     FILE *fd = ctx-&gt;getFile();
<a name="l01805"></a>01805 
<a name="l01806"></a>01806     <span class="keywordflow">if</span> (optype == GenCodeHints::tGetCount)
<a name="l01807"></a>01807       {
<a name="l01808"></a>01808         fprintf(fd, <span class="stringliteral">&quot;%sif (%s != (unsigned int)~0) return %s;\n&quot;</span>, ctx-&gt;get(), atc_cnt(name),
<a name="l01809"></a>01809                 atc_cnt(name));
<a name="l01810"></a>01810         <span class="keywordflow">return</span>;
<a name="l01811"></a>01811       }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813     <span class="comment">// TODO: WARNING: must check dimensions before returning from cache!</span>
<a name="l01814"></a>01814 
<a name="l01815"></a>01815     <span class="keywordflow">if</span> (is_raw_string)
<a name="l01816"></a>01816       {
<a name="l01817"></a>01817         <span class="keywordflow">if</span> (IS_RAW() &amp;&amp; <a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01818"></a>01818           {
<a name="l01819"></a>01819             fprintf(fd, <span class="stringliteral">&quot;%sif (%s) {if (len) *len = %s; return %s;}\n&quot;</span>,
<a name="l01820"></a>01820                     ctx-&gt;get(), atc_set(name), atc_cnt(name), atc_name(name));
<a name="l01821"></a>01821           }
<a name="l01822"></a>01822         <span class="keywordflow">else</span>
<a name="l01823"></a>01823           fprintf(fd, <span class="stringliteral">&quot;%sif (%s) return %s;\n&quot;</span>, ctx-&gt;get(), atc_set(name),
<a name="l01824"></a>01824                   atc_name(name));
<a name="l01825"></a>01825         <span class="keywordflow">return</span>;
<a name="l01826"></a>01826       }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01829"></a>01829       fprintf(fd, <span class="stringliteral">&quot;%sif (%s &gt; a%d &amp;&amp; %s&quot;</span>,
<a name="l01830"></a>01830               ctx-&gt;get(), atc_cnt(name), typmod.ndims-1, atc_set(name));
<a name="l01831"></a>01831     <span class="keywordflow">else</span>
<a name="l01832"></a>01832       fprintf(fd, <span class="stringliteral">&quot;%sif (%s&quot;</span>, ctx-&gt;get(), atc_set(name));
<a name="l01833"></a>01833 
<a name="l01834"></a>01834     <span class="keywordtype">int</span> i;
<a name="l01835"></a>01835     <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01836"></a>01836       fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l01837"></a>01837     fprintf(fd, <span class="stringliteral">&quot;) return %s&quot;</span>, atc_name(name));
<a name="l01838"></a>01838 
<a name="l01839"></a>01839     <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01840"></a>01840       fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l01841"></a>01841     fprintf(fd, <span class="stringliteral">&quot;;\n\n&quot;</span>);
<a name="l01842"></a>01842   }
<a name="l01843"></a>01843 
<a name="l01844"></a>01844   <span class="keywordtype">void</span>
<a name="l01845"></a>01845   Attribute::genAttrCacheGetEpilogue(GenContext *ctx, <span class="keywordtype">int</span> optype,
<a name="l01846"></a>01846                                      Bool is_raw_string)
<a name="l01847"></a>01847   {
<a name="l01848"></a>01848 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01849"></a>01849 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (optype != GenCodeHints::tGetCount)
<a name="l01850"></a>01850       {
<a name="l01851"></a>01851         <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !is_raw_string)
<a name="l01852"></a>01852           <span class="keywordflow">return</span>;
<a name="l01853"></a>01853         <span class="keywordflow">if</span> ((IS_STRING() || IS_RAW()) &amp;&amp; !is_raw_string)
<a name="l01854"></a>01854           <span class="keywordflow">return</span>;
<a name="l01855"></a>01855       }
<a name="l01856"></a>01856 <span class="preprocessor">#endif</span>
<a name="l01857"></a>01857 <span class="preprocessor"></span>
<a name="l01858"></a>01858     <span class="keywordflow">if</span> (optype == GenCodeHints::tGetOid &amp;&amp; !<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>()) <span class="keywordflow">return</span>;
<a name="l01859"></a>01859 
<a name="l01860"></a>01860     <span class="keywordflow">if</span> (optype == GenCodeHints::tGetOid) <span class="keywordflow">return</span>;
<a name="l01861"></a>01861 
<a name="l01862"></a>01862     FILE *fd = ctx-&gt;getFile();
<a name="l01863"></a>01863 
<a name="l01864"></a>01864     <span class="keyword">const</span> <span class="keywordtype">char</span> *classname = className(class_owner);
<a name="l01865"></a>01865 
<a name="l01866"></a>01866     <span class="keywordflow">if</span> (optype == GenCodeHints::tGetCount)
<a name="l01867"></a>01867       {
<a name="l01868"></a>01868         fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = size;\n&quot;</span>, ctx-&gt;get(), atc_this(classname),
<a name="l01869"></a>01869                 atc_cnt(name));
<a name="l01870"></a>01870         <span class="keywordflow">return</span>;
<a name="l01871"></a>01871       }
<a name="l01872"></a>01872 
<a name="l01873"></a>01873     <span class="keywordflow">if</span> (is_raw_string)
<a name="l01874"></a>01874       {
<a name="l01875"></a>01875         fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = 1;\n&quot;</span>, ctx-&gt;get(), atc_this(classname),
<a name="l01876"></a>01876                 atc_set(name));
<a name="l01877"></a>01877         <span class="comment">// TODO: faux dans le cas d&apos;un raw data.</span>
<a name="l01878"></a>01878         <span class="keywordflow">if</span> (IS_RAW())
<a name="l01879"></a>01879           {
<a name="l01880"></a>01880 <span class="preprocessor">#ifdef ATTR_CACHE_DIRECT</span>
<a name="l01881"></a>01881 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01882"></a>01882               {
<a name="l01883"></a>01883                 <span class="keyword">const</span> <span class="keywordtype">char</span> *scnt = ATTRNAME(name, tGetCount, *phints);
<a name="l01884"></a>01884                 fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = %s();\n&quot;</span>, ctx-&gt;get(),
<a name="l01885"></a>01885                         atc_this(classname), atc_cnt(name), scnt);
<a name="l01886"></a>01886               }
<a name="l01887"></a>01887 
<a name="l01888"></a>01888             fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = data;\n&quot;</span>, ctx-&gt;get(),
<a name="l01889"></a>01889                     atc_this(classname), atc_name(name));
<a name="l01890"></a>01890 <span class="preprocessor">#else</span>
<a name="l01891"></a>01891 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01892"></a>01892               {
<a name="l01893"></a>01893                 <span class="keyword">const</span> <span class="keywordtype">char</span> *scnt = ATTRNAME(name, tGetCount, *phints);
<a name="l01894"></a>01894                 fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = rawdup(data, %s());\n&quot;</span>, ctx-&gt;get(),
<a name="l01895"></a>01895                         atc_this(classname), atc_name(name), scnt);
<a name="l01896"></a>01896                 fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = %s();\n&quot;</span>, ctx-&gt;get(),
<a name="l01897"></a>01897                         atc_this(classname), atc_cnt(name), scnt);
<a name="l01898"></a>01898 
<a name="l01899"></a>01899               }
<a name="l01900"></a>01900             <span class="keywordflow">else</span>
<a name="l01901"></a>01901               fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = rawdup(data, %d);\n&quot;</span>, ctx-&gt;get(),
<a name="l01902"></a>01902                       atc_this(classname), atc_name(name), typmod.pdims);
<a name="l01903"></a>01903 <span class="preprocessor">#endif</span>
<a name="l01904"></a>01904 <span class="preprocessor"></span>          }
<a name="l01905"></a>01905 <span class="preprocessor">#ifdef ATTR_CACHE_DIRECT</span>
<a name="l01906"></a>01906 <span class="preprocessor"></span>        <span class="keywordflow">else</span>
<a name="l01907"></a>01907           fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = (const char *)data;\n&quot;</span>, ctx-&gt;get(),
<a name="l01908"></a>01908                   atc_this(classname), atc_name(name));
<a name="l01909"></a>01909 <span class="preprocessor">#else</span>
<a name="l01910"></a>01910 <span class="preprocessor"></span>        <span class="keywordflow">else</span>
<a name="l01911"></a>01911           fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = strdup((const char *)data);\n&quot;</span>, ctx-&gt;get(),
<a name="l01912"></a>01912                   atc_this(classname), atc_name(name));
<a name="l01913"></a>01913 <span class="preprocessor">#endif</span>
<a name="l01914"></a>01914 <span class="preprocessor"></span>        <span class="keywordflow">return</span>;
<a name="l01915"></a>01915       }
<a name="l01916"></a>01916 
<a name="l01917"></a>01917     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l01918"></a>01918       {
<a name="l01919"></a>01919         <span class="comment">// TODO: FAUX: on doit plutot faire un realloc dans le cas ou</span>
<a name="l01920"></a>01920         <span class="comment">// le _cnt n&apos;etait pas null!</span>
<a name="l01921"></a>01921         fprintf(fd, <span class="stringliteral">&quot;%sif (%s) {free(%s-&gt;%s); free(%s-&gt;%s);}\n&quot;</span>,
<a name="l01922"></a>01922                 ctx-&gt;get(), atc_cnt(name), atc_this(classname), atc_set(name),
<a name="l01923"></a>01923                 atc_this(classname), atc_name(name));
<a name="l01924"></a>01924         fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = a%d+1;\n&quot;</span>, ctx-&gt;get(), atc_this(classname), atc_cnt(name),
<a name="l01925"></a>01925                 typmod.ndims-1);
<a name="l01926"></a>01926         fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s&quot;</span>,
<a name="l01927"></a>01927                 ctx-&gt;get(), atc_this(classname), atc_set(name));
<a name="l01928"></a>01928         <span class="keywordtype">int</span> i;
<a name="l01929"></a>01929         <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01930"></a>01930           <span class="keywordflow">if</span> (typmod.dims[i] &gt; 0) fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l01931"></a>01931 
<a name="l01932"></a>01932         fprintf(fd, <span class="stringliteral">&quot; = (unsigned char *)malloc(a%d+1);\n&quot;</span>, typmod.ndims-1);
<a name="l01933"></a>01933 
<a name="l01934"></a>01934         fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s&quot;</span>,
<a name="l01935"></a>01935                 ctx-&gt;get(), atc_this(classname), atc_name(name));
<a name="l01936"></a>01936         <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01937"></a>01937           <span class="keywordflow">if</span> (typmod.dims[i] &gt; 0) fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l01938"></a>01938         fprintf(fd, <span class="stringliteral">&quot; = (%s *%s)malloc((a%d+1)*sizeof(%s *));\n&quot;</span>,
<a name="l01939"></a>01939                 className(cls, (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() ? True : False)),
<a name="l01940"></a>01940                 (NOT_BASIC() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>),
<a name="l01941"></a>01941                 typmod.ndims-1, className(cls, True));
<a name="l01942"></a>01942       }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944     fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s&quot;</span>, ctx-&gt;get(), atc_this(classname), atc_set(name));
<a name="l01945"></a>01945     <span class="keywordtype">int</span> i;
<a name="l01946"></a>01946     <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01947"></a>01947       fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l01948"></a>01948 
<a name="l01949"></a>01949     fprintf(fd, <span class="stringliteral">&quot; = 1;\n&quot;</span>);
<a name="l01950"></a>01950     fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s&quot;</span>, ctx-&gt;get(), atc_this(classname), atc_name(name));
<a name="l01951"></a>01951     <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l01952"></a>01952       fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l01953"></a>01953 
<a name="l01954"></a>01954     fprintf(fd, <span class="stringliteral">&quot; = &quot;</span>);
<a name="l01955"></a>01955 
<a name="l01956"></a>01956     <span class="keywordflow">if</span> (NOT_BASIC())
<a name="l01957"></a>01957       fprintf(fd, <span class="stringliteral">&quot;(%s *)__o&quot;</span>, className(cls, True));
<a name="l01958"></a>01958     <span class="keywordflow">else</span>
<a name="l01959"></a>01959       fprintf(fd, <span class="stringliteral">&quot;(%s)__tmp&quot;</span>, className(cls, False));
<a name="l01960"></a>01960     fprintf(fd, <span class="stringliteral">&quot;;\n&quot;</span>);
<a name="l01961"></a>01961   }
<a name="l01962"></a>01962 
<a name="l01963"></a>01963   <span class="keywordtype">void</span>
<a name="l01964"></a>01964   Attribute::genAttrCacheSetPrologue(GenContext *ctx, <span class="keywordtype">int</span> optype,
<a name="l01965"></a>01965                                      Bool is_raw_string)
<a name="l01966"></a>01966   {
<a name="l01967"></a>01967     <span class="comment">// nothing to do!</span>
<a name="l01968"></a>01968   }
<a name="l01969"></a>01969 
<a name="l01970"></a>01970   <span class="keywordtype">void</span>
<a name="l01971"></a>01971   Attribute::genAttrCacheSetEpilogue(GenContext *ctx, <span class="keywordtype">int</span> optype,
<a name="l01972"></a>01972                                      Bool is_raw_string)
<a name="l01973"></a>01973   {
<a name="l01974"></a>01974 <span class="preprocessor">#ifdef ATC_NOVD</span>
<a name="l01975"></a>01975 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (optype != GenCodeHints::tSetCount)
<a name="l01976"></a>01976       {
<a name="l01977"></a>01977         <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !is_raw_string)
<a name="l01978"></a>01978           <span class="keywordflow">return</span>;
<a name="l01979"></a>01979         <span class="keywordflow">if</span> ((IS_STRING() || IS_RAW()) &amp;&amp; !is_raw_string)
<a name="l01980"></a>01980           <span class="keywordflow">return</span>;
<a name="l01981"></a>01981       }
<a name="l01982"></a>01982 <span class="preprocessor">#endif</span>
<a name="l01983"></a>01983 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (optype == GenCodeHints::tSetOid &amp;&amp; !<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>()) <span class="keywordflow">return</span>;
<a name="l01984"></a>01984 
<a name="l01985"></a>01985     <span class="keywordflow">if</span> (optype == GenCodeHints::tSetOid) <span class="keywordflow">return</span>;
<a name="l01986"></a>01986 
<a name="l01987"></a>01987     FILE *fd = ctx-&gt;getFile();
<a name="l01988"></a>01988 
<a name="l01989"></a>01989     <span class="keywordflow">if</span> (optype == GenCodeHints::tSetCount)
<a name="l01990"></a>01990       {
<a name="l01991"></a>01991         <span class="comment">//EV : 5/03/06: should be &apos;size&apos; but &apos;from&apos; or another variable !</span>
<a name="l01992"></a>01992         <span class="comment">//fprintf(fd, &quot;%sif (!status) %s = size;\n&quot;, ctx-&gt;get(), atc_cnt(name));</span>
<a name="l01993"></a>01993         <span class="keywordflow">return</span>;
<a name="l01994"></a>01994       }
<a name="l01995"></a>01995 
<a name="l01996"></a>01996     <span class="keyword">const</span> <span class="keywordtype">char</span> *classname = className(class_owner);
<a name="l01997"></a>01997 
<a name="l01998"></a>01998     fprintf(fd, <span class="stringliteral">&quot;%sif (!status) {\n&quot;</span>, ctx-&gt;get());
<a name="l01999"></a>01999     ctx-&gt;push();
<a name="l02000"></a>02000 
<a name="l02001"></a>02001     <span class="keywordflow">if</span> (is_raw_string)
<a name="l02002"></a>02002       {
<a name="l02003"></a>02003         <span class="keywordflow">if</span> (IS_RAW() &amp;&amp; !<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l02004"></a>02004           {
<a name="l02005"></a>02005             fprintf(fd, <span class="stringliteral">&quot;%sif (len == %d) {\n&quot;</span>, ctx-&gt;get(), typmod.pdims);
<a name="l02006"></a>02006             ctx-&gt;push();
<a name="l02007"></a>02007           }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009 <span class="preprocessor">#ifndef ATTR_CACHE_DIRECT</span>
<a name="l02010"></a>02010 <span class="preprocessor"></span>        fprintf(fd, <span class="stringliteral">&quot;%sif (%s) free(%s-&gt;%s);\n&quot;</span>, ctx-&gt;get(), atc_set(name),
<a name="l02011"></a>02011                 atc_this(classname), atc_name(name));
<a name="l02012"></a>02012 <span class="preprocessor">#endif</span>
<a name="l02013"></a>02013 <span class="preprocessor"></span>        fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = 1;\n&quot;</span>, ctx-&gt;get(), atc_this(classname),
<a name="l02014"></a>02014                 atc_set(name));
<a name="l02015"></a>02015 
<a name="l02016"></a>02016         <span class="keywordflow">if</span> (IS_RAW())
<a name="l02017"></a>02017           {
<a name="l02018"></a>02018 <span class="preprocessor">#ifdef ATTR_CACHE_DIRECT</span>
<a name="l02019"></a>02019 <span class="preprocessor"></span>            fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = %s(%s);\n&quot;</span>, ctx-&gt;get(),
<a name="l02020"></a>02020                     atc_this(classname), atc_name(name),
<a name="l02021"></a>02021                     ATTRNAME(name, tGet, *phints),
<a name="l02022"></a>02022                     (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() ? <span class="stringliteral">&quot;(unsigned int *)0&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02023"></a>02023 <span class="preprocessor">#else</span>
<a name="l02024"></a>02024 <span class="preprocessor"></span>            fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = rawdup(_%s, len);\n&quot;</span>, ctx-&gt;get(),
<a name="l02025"></a>02025                     atc_this(classname), atc_name(name), name);
<a name="l02026"></a>02026 <span class="preprocessor">#endif</span>
<a name="l02027"></a>02027 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l02028"></a>02028               fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = len;\n&quot;</span>, ctx-&gt;get(),
<a name="l02029"></a>02029                       atc_this(classname), atc_cnt(name));
<a name="l02030"></a>02030             <span class="keywordflow">else</span>
<a name="l02031"></a>02031               {
<a name="l02032"></a>02032                 ctx-&gt;pop();
<a name="l02033"></a>02033                 fprintf(fd, <span class="stringliteral">&quot;%s}\n&quot;</span>, ctx-&gt;get());
<a name="l02034"></a>02034               }
<a name="l02035"></a>02035           }
<a name="l02036"></a>02036         <span class="keywordflow">else</span>
<a name="l02037"></a>02037           {
<a name="l02038"></a>02038 <span class="preprocessor">#ifdef ATTR_CACHE_DIRECT</span>
<a name="l02039"></a>02039 <span class="preprocessor"></span>            fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = %s();\n&quot;</span>, ctx-&gt;get(),
<a name="l02040"></a>02040                     atc_this(classname), atc_name(name),
<a name="l02041"></a>02041                     ATTRNAME(name, tGet, *phints));
<a name="l02042"></a>02042 <span class="preprocessor">#else</span>
<a name="l02043"></a>02043 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>())
<a name="l02044"></a>02044               fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = strdup((const char *)_%s);\n&quot;</span>, ctx-&gt;get(),
<a name="l02045"></a>02045                       atc_this(classname), atc_name(name), name);
<a name="l02046"></a>02046             <span class="keywordflow">else</span>
<a name="l02047"></a>02047               fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s = strdup((const char *)data);\n&quot;</span>, ctx-&gt;get(),
<a name="l02048"></a>02048                       atc_this(classname), atc_name(name));
<a name="l02049"></a>02049 <span class="preprocessor">#endif</span>
<a name="l02050"></a>02050 <span class="preprocessor"></span>          }
<a name="l02051"></a>02051         ctx-&gt;pop();
<a name="l02052"></a>02052         fprintf(fd, <span class="stringliteral">&quot;%s}\n&quot;</span>, ctx-&gt;get());
<a name="l02053"></a>02053         <span class="keywordflow">return</span>;
<a name="l02054"></a>02054       }
<a name="l02055"></a>02055 
<a name="l02056"></a>02056     fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s&quot;</span>, ctx-&gt;get(), atc_this(classname), atc_set(name));
<a name="l02057"></a>02057     <span class="keywordtype">int</span> i;
<a name="l02058"></a>02058     <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l02059"></a>02059       fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061     fprintf(fd, <span class="stringliteral">&quot; = 1;\n&quot;</span>);
<a name="l02062"></a>02062     fprintf(fd, <span class="stringliteral">&quot;%s%s-&gt;%s&quot;</span>, ctx-&gt;get(), atc_this(classname), atc_name(name));
<a name="l02063"></a>02063     <span class="keywordflow">for</span> (i = 0; i &lt; typmod.ndims; i++)
<a name="l02064"></a>02064       fprintf(fd, <span class="stringliteral">&quot;[a%d]&quot;</span>, i);
<a name="l02065"></a>02065 
<a name="l02066"></a>02066     fprintf(fd, <span class="stringliteral">&quot; = &quot;</span>);
<a name="l02067"></a>02067 
<a name="l02068"></a>02068     <span class="comment">/*</span>
<a name="l02069"></a>02069 <span class="comment">      if (NOT_BASIC())</span>
<a name="l02070"></a>02070 <span class="comment">      fprintf(fd, &quot;(%s *)__o&quot;, className(cls, True));</span>
<a name="l02071"></a>02071 <span class="comment">      else</span>
<a name="l02072"></a>02072 <span class="comment">      fprintf(fd, &quot;(%s)__tmp&quot;, className(cls, False));</span>
<a name="l02073"></a>02073 <span class="comment">    */</span>
<a name="l02074"></a>02074 
<a name="l02075"></a>02075     <span class="keywordflow">if</span> (NOT_BASIC())
<a name="l02076"></a>02076       fprintf(fd, <span class="stringliteral">&quot;(%s *)_%s&quot;</span>, className(cls, True), name);
<a name="l02077"></a>02077     <span class="keywordflow">else</span>
<a name="l02078"></a>02078       fprintf(fd, <span class="stringliteral">&quot;(%s)_%s&quot;</span>, className(cls, False), name);
<a name="l02079"></a>02079 
<a name="l02080"></a>02080     fprintf(fd, <span class="stringliteral">&quot;;\n&quot;</span>);
<a name="l02081"></a>02081     ctx-&gt;pop();
<a name="l02082"></a>02082     fprintf(fd, <span class="stringliteral">&quot;%s}\n&quot;</span>, ctx-&gt;get());
<a name="l02083"></a>02083   }
<a name="l02084"></a>02084 
<a name="l02085"></a>02085   Status Attribute::generateCode_C(Class *own,
<a name="l02086"></a>02086                                    <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l02087"></a>02087                                    GenContext *ctxH,
<a name="l02088"></a>02088                                    GenContext *ctxC)
<a name="l02089"></a>02089   {
<a name="l02090"></a>02090     FILE *fdh = ctxH-&gt;getFile();
<a name="l02091"></a>02091     <span class="keywordtype">int</span> ndims = typmod.ndims, i;
<a name="l02092"></a>02092     <span class="keywordtype">int</span> not_basic = NOT_BASIC();
<a name="l02093"></a>02093     <span class="keyword">const</span> <span class="keywordtype">char</span> *ref1 = (not_basic ? getPtrSet() : <span class="stringliteral">&quot; &quot;</span>);
<a name="l02094"></a>02094     <span class="comment">//    const char *ref2 = (not_basic ? &quot; *&quot; : &quot; &quot;);</span>
<a name="l02095"></a>02095     <span class="keyword">const</span> <span class="keywordtype">char</span> *ref2 = (not_basic ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>);
<a name="l02096"></a>02096     <span class="keyword">const</span> <span class="keywordtype">char</span> *comma = (ndims ? <span class="stringliteral">&quot;, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l02097"></a>02097     <span class="keywordtype">int</span> is_string = IS_STRING();
<a name="l02098"></a>02098     <span class="keywordtype">int</span> is_raw = IS_RAW();
<a name="l02099"></a>02099     <span class="keyword">const</span> <span class="keywordtype">char</span> *starg    = STATUS_PROTO(hints, False);
<a name="l02100"></a>02100     <span class="keyword">const</span> <span class="keywordtype">char</span> *stargcom = STATUS_PROTO(hints, True);
<a name="l02101"></a>02101     <span class="keyword">const</span> <span class="keywordtype">char</span> *classname = <a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() ?
<a name="l02102"></a>02102       className(cls, True) : className(cls, False);
<a name="l02103"></a>02103 
<a name="l02104"></a>02104     <span class="comment">// set method</span>
<a name="l02105"></a>02105     fprintf(fdh, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02106"></a>02106     <span class="keywordflow">if</span> (is_string || is_raw) {
<a name="l02107"></a>02107 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l02108"></a>02108 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (is_string)
<a name="l02109"></a>02109         fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(const std::string &amp;%s);\n&quot;</span>, ctxH-&gt;get(),
<a name="l02110"></a>02110                 ATTRNAME(name, tSet, hints), SARGIN());
<a name="l02111"></a>02111       <span class="keywordflow">else</span>
<a name="l02112"></a>02112         fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(const %s *%s);\n&quot;</span>, ctxH-&gt;get(),
<a name="l02113"></a>02113                 ATTRNAME(name, tSet, hints), SCLASS(), SARGIN());
<a name="l02114"></a>02114 <span class="preprocessor">#else</span>
<a name="l02115"></a>02115 <span class="preprocessor"></span>      fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(const %s *%s);\n&quot;</span>, ctxH-&gt;get(),
<a name="l02116"></a>02116               ATTRNAME(name, tSet, hints), SCLASS(), SARGIN());
<a name="l02117"></a>02117 <span class="preprocessor">#endif</span>
<a name="l02118"></a>02118 <span class="preprocessor"></span>    }
<a name="l02119"></a>02119 
<a name="l02120"></a>02120 <span class="preprocessor">#ifdef NO_DIRECT_SET</span>
<a name="l02121"></a>02121 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>() || !not_basic) <span class="comment">// added 22/09/98</span>
<a name="l02122"></a>02122 #endif
<a name="l02123"></a>02123       {
<a name="l02124"></a>02124         fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(&quot;</span>, ctxH-&gt;get(),
<a name="l02125"></a>02125                 ATTRNAME_1(name, ATTRSET(cls), hints));
<a name="l02126"></a>02126         dimArgsGen(fdh, ndims);
<a name="l02127"></a>02127         <span class="keywordflow">if</span> (cls-&gt;asEnumClass())
<a name="l02128"></a>02128           fprintf(fdh, <span class="stringliteral">&quot;%s%s%s, eyedb::Bool _check_value = eyedb::True);\n&quot;</span>,
<a name="l02129"></a>02129                   comma, classname, ref1);
<a name="l02130"></a>02130         <span class="keywordflow">else</span>
<a name="l02131"></a>02131           fprintf(fdh, <span class="stringliteral">&quot;%s%s%s);\n&quot;</span>, comma, classname, ref1);
<a name="l02132"></a>02132       }
<a name="l02133"></a>02133 <span class="preprocessor">#ifdef NO_DIRECT_SET</span>
<a name="l02134"></a>02134 <span class="preprocessor"></span>    <span class="keywordflow">else</span>
<a name="l02135"></a>02135 <span class="preprocessor">#endif</span>
<a name="l02136"></a>02136 <span class="preprocessor"></span><span class="preprocessor">#if defined(SET_COUNT_DIRECT) || defined(NO_DIRECT_SET)</span>
<a name="l02137"></a>02137 <span class="preprocessor"></span>      <span class="comment">// 23/05/06: suppressed !isIndirect()</span>
<a name="l02138"></a>02138       <span class="comment">//      if (isVarDim() &amp;&amp; !isIndirect() &amp;&amp; !is_string) /*&amp;&amp; not_basic*/</span>
<a name="l02139"></a>02139       <span class="comment">//if (isVarDim() &amp;&amp; !isIndirect() &amp;&amp; !is_string) /*&amp;&amp; not_basic*/</span>
<a name="l02140"></a>02140       <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !is_string) <span class="comment">/*&amp;&amp; not_basic*/</span>
<a name="l02141"></a>02141         {
<a name="l02142"></a>02142           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(&quot;</span>,
<a name="l02143"></a>02143                   ctxH-&gt;get(), ATTRNAME(name, tSetCount, hints));
<a name="l02144"></a>02144 
<a name="l02145"></a>02145           dimArgsGen(fdh, ndims);
<a name="l02146"></a>02146           fprintf(fdh, <span class="stringliteral">&quot;);\n&quot;</span>);
<a name="l02147"></a>02147         }
<a name="l02148"></a>02148 <span class="preprocessor">#endif</span>
<a name="l02149"></a>02149 <span class="preprocessor"></span>
<a name="l02150"></a>02150     <span class="comment">// get methods</span>
<a name="l02151"></a>02151     <span class="keywordflow">if</span> (is_string || is_raw) {
<a name="l02152"></a>02152 <span class="preprocessor">#ifdef ODL_STD_STRING</span>
<a name="l02153"></a>02153 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (is_string)
<a name="l02154"></a>02154         fprintf(fdh, <span class="stringliteral">&quot;%sstd::string %s(%seyedb::Bool *isnull = 0%s) const;\n&quot;</span>,
<a name="l02155"></a>02155                 ctxH-&gt;get(), ATTRNAME(name, tGet, hints), SARGOUT(),
<a name="l02156"></a>02156                 stargcom);
<a name="l02157"></a>02157       <span class="keywordflow">else</span>
<a name="l02158"></a>02158         fprintf(fdh, <span class="stringliteral">&quot;%sconst %s *%s(%seyedb::Bool *isnull = 0%s) const;\n&quot;</span>,
<a name="l02159"></a>02159                 ctxH-&gt;get(), SCLASS(), ATTRNAME(name, tGet, hints), SARGOUT(),
<a name="l02160"></a>02160                 stargcom);
<a name="l02161"></a>02161 <span class="preprocessor">#else</span>
<a name="l02162"></a>02162 <span class="preprocessor"></span>      fprintf(fdh, <span class="stringliteral">&quot;%sconst %s *%s(%seyedb::Bool *isnull = 0%s) const;\n&quot;</span>,
<a name="l02163"></a>02163               ctxH-&gt;get(), SCLASS(), ATTRNAME(name, tGet, hints), SARGOUT(),
<a name="l02164"></a>02164               stargcom);
<a name="l02165"></a>02165 <span class="preprocessor">#endif</span>
<a name="l02166"></a>02166 <span class="preprocessor"></span>    }
<a name="l02167"></a>02167 
<a name="l02168"></a>02168     fprintf(fdh, <span class="stringliteral">&quot;%s%s%s%s(&quot;</span>, ctxH-&gt;get(), classname, ref2,
<a name="l02169"></a>02169             ATTRNAME_1(name, ATTRGET(cls), hints));
<a name="l02170"></a>02170     dimArgsGen(fdh, ndims);
<a name="l02171"></a>02171     fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Bool *isnull = 0%s) %s;\n&quot;</span>, comma,
<a name="l02172"></a>02172             stargcom, (!not_basic ? <span class="stringliteral">&quot; const&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02173"></a>02173 
<a name="l02174"></a>02174     <span class="keywordflow">if</span> (cls-&gt;asCollectionClass()) {
<a name="l02175"></a>02175       fprintf(fdh, <span class="stringliteral">&quot;%sunsigned int %s(&quot;</span>, ctxH-&gt;get(),
<a name="l02176"></a>02176               ATTRNAME(name, tGetCount, hints));
<a name="l02177"></a>02177       dimArgsGen(fdh, ndims);
<a name="l02178"></a>02178       fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Bool *isnull = 0, eyedb::Status *rs = 0) const &quot;</span>
<a name="l02179"></a>02179               <span class="stringliteral">&quot;{const eyedb::Collection%s _coll = %s(&quot;</span>, comma, getPtrRet(),ATTRNAME(name, tGetColl, hints));
<a name="l02180"></a>02180       <span class="keywordflow">for</span> (i = 0; i &lt; ndims; i++)
<a name="l02181"></a>02181         fprintf(fdh, <span class="stringliteral">&quot;a%d, &quot;</span>, i);
<a name="l02182"></a>02182       fprintf(fdh, <span class="stringliteral">&quot;isnull, rs); &quot;</span>);
<a name="l02183"></a>02183       fprintf(fdh, <span class="stringliteral">&quot;return (!!_coll ? _coll-&gt;getCount() : 0);}\n&quot;</span>);
<a name="l02184"></a>02184     }
<a name="l02185"></a>02185 
<a name="l02186"></a>02186     <span class="keywordflow">if</span> (not_basic) {
<a name="l02187"></a>02187       fprintf(fdh, <span class="stringliteral">&quot;%sconst %s%s%s(&quot;</span>, ctxH-&gt;get(), classname, ref2,
<a name="l02188"></a>02188               ATTRNAME_1(name, ATTRGET(cls), hints));
<a name="l02189"></a>02189   
<a name="l02190"></a>02190       dimArgsGen(fdh, ndims);
<a name="l02191"></a>02191       fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Bool *isnull = 0%s) const;\n&quot;</span>, comma,
<a name="l02192"></a>02192               stargcom);
<a name="l02193"></a>02193     }
<a name="l02194"></a>02194 
<a name="l02195"></a>02195     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#adbf0a7f602510bbc2704de2c0e18af5e" title="Not yet documented.">isIndirect</a>()) {
<a name="l02196"></a>02196       fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Oid %s(&quot;</span>,
<a name="l02197"></a>02197               ctxH-&gt;get(), ATTRNAME(name, tGetOid, hints));
<a name="l02198"></a>02198       dimArgsGen(fdh, ndims);
<a name="l02199"></a>02199       fprintf(fdh, <span class="stringliteral">&quot;%s) const;\n&quot;</span>, (ndims ? stargcom : starg));
<a name="l02200"></a>02200       fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(&quot;</span>,
<a name="l02201"></a>02201               ctxH-&gt;get(), ATTRNAME(name, tSetOid, hints));
<a name="l02202"></a>02202       dimArgsGen(fdh, ndims);
<a name="l02203"></a>02203       fprintf(fdh, <span class="stringliteral">&quot;%sconst eyedb::Oid &amp;);\n&quot;</span>, comma);
<a name="l02204"></a>02204     }
<a name="l02205"></a>02205 
<a name="l02206"></a>02206     <span class="keywordflow">if</span> (cls-&gt;asCollectionClass()) {
<a name="l02207"></a>02207       Bool _isref;
<a name="l02208"></a>02208       eyedblib::int16 _dim;
<a name="l02209"></a>02209       Class *cl = <span class="keyword">const_cast&lt;</span>Class *<span class="keyword">&gt;</span>
<a name="l02210"></a>02210         (cls-&gt;asCollectionClass()-&gt;getCollClass(&amp;_isref, &amp;_dim));
<a name="l02211"></a>02211       <span class="keyword">const</span> <span class="keywordtype">char</span> *oclassname = _isref ?
<a name="l02212"></a>02212         className(cl, True) : className(cl, False);
<a name="l02213"></a>02213       Bool ordered;
<a name="l02214"></a>02214 
<a name="l02215"></a>02215       <span class="keywordflow">if</span> (cls-&gt;asCollSetClass() || cls-&gt;asCollBagClass())
<a name="l02216"></a>02216         ordered = False;
<a name="l02217"></a>02217       <span class="keywordflow">else</span>
<a name="l02218"></a>02218         ordered = True;
<a name="l02219"></a>02219 
<a name="l02220"></a>02220       <span class="keyword">const</span> <span class="keywordtype">char</span> *where = (ordered ? <span class="stringliteral">&quot;int where, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l02221"></a>02221 
<a name="l02222"></a>02222       <span class="keywordflow">if</span> (_dim == 1) {
<a name="l02223"></a>02223         fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(%s&quot;</span>, ctxH-&gt;get(),
<a name="l02224"></a>02224                 ATTRNAME_1(name, (ordered ? GenCodeHints::tSetItemInColl : GenCodeHints::tAddItemToColl), hints), where);
<a name="l02225"></a>02225         dimArgsGen(fdh, ndims);
<a name="l02226"></a>02226         fprintf(fdh, <span class="stringliteral">&quot;%s%s%s%s, const eyedb::CollImpl * = 0);\n&quot;</span>, comma,
<a name="l02227"></a>02227                 oclassname, (_isref || !cl-&gt;asBasicClass() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>),
<a name="l02228"></a>02228                 (!*where ? <span class="stringliteral">&quot;, eyedb::Bool noDup = eyedb::False&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02229"></a>02229 
<a name="l02230"></a>02230         <span class="keywordflow">if</span> (ordered) {
<a name="l02231"></a>02231           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(int where%s&quot;</span>, ctxH-&gt;get(),
<a name="l02232"></a>02232                   ATTRNAME(name, tUnsetItemInColl, hints),
<a name="l02233"></a>02233                   (ndims &gt;= 1 ? <span class="stringliteral">&quot;, &quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02234"></a>02234           dimArgsGen(fdh, ndims);
<a name="l02235"></a>02235           fprintf(fdh, <span class="stringliteral">&quot;);\n&quot;</span>);
<a name="l02236"></a>02236         }
<a name="l02237"></a>02237         <span class="keywordflow">else</span>
<a name="l02238"></a>02238           {
<a name="l02239"></a>02239             fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(%s&quot;</span>, ctxH-&gt;get(),
<a name="l02240"></a>02240                     ATTRNAME(name, tRmvItemFromColl, hints), where);
<a name="l02241"></a>02241             dimArgsGen(fdh, ndims);
<a name="l02242"></a>02242             fprintf(fdh, <span class="stringliteral">&quot;%s%s%s%s);\n&quot;</span>, comma, oclassname,
<a name="l02243"></a>02243                     (_isref || !cl-&gt;asBasicClass() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>),
<a name="l02244"></a>02244                     (!*where ? <span class="stringliteral">&quot;, eyedb::Bool checkFirst = eyedb::False&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02245"></a>02245           }
<a name="l02246"></a>02246       }
<a name="l02247"></a>02247       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cl-&gt;getName(), char_class_name) &amp;&amp; _dim &gt; 1) {
<a name="l02248"></a>02248         fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(%s&quot;</span>, ctxH-&gt;get(),
<a name="l02249"></a>02249                 ATTRNAME_1(name, (ordered ? GenCodeHints::tSetItemInColl : GenCodeHints::tAddItemToColl), hints), where);
<a name="l02250"></a>02250 
<a name="l02251"></a>02251         dimArgsGen(fdh, ndims);
<a name="l02252"></a>02252         fprintf(fdh, <span class="stringliteral">&quot;%sconst char *%s, const eyedb::CollImpl * = 0);\n&quot;</span>,
<a name="l02253"></a>02253                 comma,
<a name="l02254"></a>02254                 (!*where ? <span class="stringliteral">&quot;, eyedb::Bool noDup = eyedb::False&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02255"></a>02255         <span class="comment">/*</span>
<a name="l02256"></a>02256 <span class="comment">        fprintf(fdh, &quot;%sconst char *%s, const eyedb::IndexImpl * = 0);\n&quot;,</span>
<a name="l02257"></a>02257 <span class="comment">                comma,</span>
<a name="l02258"></a>02258 <span class="comment">                (!*where ? &quot;, eyedb::Bool noDup = eyedb::False&quot; : &quot;&quot;));</span>
<a name="l02259"></a>02259 <span class="comment">        */</span>
<a name="l02260"></a>02260         <span class="keywordflow">if</span> (ordered)
<a name="l02261"></a>02261           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(&quot;</span>, ctxH-&gt;get(),
<a name="l02262"></a>02262                   ATTRNAME(name, tUnsetItemInColl, hints));
<a name="l02263"></a>02263         <span class="keywordflow">else</span>
<a name="l02264"></a>02264           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(&quot;</span>, ctxH-&gt;get(),
<a name="l02265"></a>02265                   ATTRNAME(name, tRmvItemFromColl, hints));
<a name="l02266"></a>02266 
<a name="l02267"></a>02267         dimArgsGen(fdh, ndims);
<a name="l02268"></a>02268         fprintf(fdh, <span class="stringliteral">&quot;%sconst char *%s);\n&quot;</span>, comma,
<a name="l02269"></a>02269                 (!*where ? <span class="stringliteral">&quot;, eyedb::Bool checkFirst = eyedb::False&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02270"></a>02270       }
<a name="l02271"></a>02271 
<a name="l02272"></a>02272       <span class="keywordflow">if</span> (!cl-&gt;asBasicClass()) {
<a name="l02273"></a>02273         fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(%s&quot;</span>, ctxH-&gt;get(),
<a name="l02274"></a>02274                 ATTRNAME_1(name, (ordered ? GenCodeHints::tSetItemInColl : GenCodeHints::tAddItemToColl), hints), where);
<a name="l02275"></a>02275         dimArgsGen(fdh, ndims);
<a name="l02276"></a>02276         fprintf(fdh, <span class="stringliteral">&quot;%sconst eyedb::Oid &amp;, const eyedb::CollImpl * = 0);\n&quot;</span>,
<a name="l02277"></a>02277                 comma);
<a name="l02278"></a>02278         fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status %s(&quot;</span>, ctxH-&gt;get(),
<a name="l02279"></a>02279                 ATTRNAME_1(name, (ordered ? GenCodeHints::tUnsetItemInColl : GenCodeHints::tRmvItemFromColl), hints));
<a name="l02280"></a>02280         dimArgsGen(fdh, ndims);
<a name="l02281"></a>02281         fprintf(fdh, <span class="stringliteral">&quot;%sconst eyedb::Oid &amp;);\n&quot;</span>, comma);
<a name="l02282"></a>02282       }
<a name="l02283"></a>02283 
<a name="l02284"></a>02284       <span class="keywordflow">if</span> (ordered) { <span class="comment">// 24/09/05</span>
<a name="l02285"></a>02285         <span class="keywordflow">if</span> (!strcmp(cl-&gt;getName(), char_class_name) &amp;&amp; _dim &gt; 1) {
<a name="l02286"></a>02286           fprintf(fdh, <span class="stringliteral">&quot;%sconst char *%s(unsigned int ind, &quot;</span>,
<a name="l02287"></a>02287                   ctxH-&gt;get(),
<a name="l02288"></a>02288                   ATTRNAME_1(name, (ordered ? GenCodeHints::tRetrieveItemAt : GenCodeHints::tGetItemAt), hints));
<a name="l02289"></a>02289           dimArgsGen(fdh, ndims);
<a name="l02290"></a>02290           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Bool *isnull = 0, eyedb::Status *rs = 0) const;\n&quot;</span>, comma);
<a name="l02291"></a>02291         }
<a name="l02292"></a>02292         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_dim == 1) {
<a name="l02293"></a>02293           fprintf(fdh, <span class="stringliteral">&quot;%sconst %s%s%s(unsigned int ind, &quot;</span>,
<a name="l02294"></a>02294                   ctxH-&gt;get(),
<a name="l02295"></a>02295                   oclassname, (_isref || !cl-&gt;asBasicClass() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>), 
<a name="l02296"></a>02296                   ATTRNAME_1(name, (ordered ? GenCodeHints::tRetrieveItemAt : GenCodeHints::tGetItemAt), hints));
<a name="l02297"></a>02297           dimArgsGen(fdh, ndims);
<a name="l02298"></a>02298           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Bool *isnull = 0, eyedb::Status *rs = 0) const;\n&quot;</span>, comma);
<a name="l02299"></a>02299           
<a name="l02300"></a>02300           <span class="keywordflow">if</span> (!cl-&gt;asBasicClass()) {
<a name="l02301"></a>02301             fprintf(fdh, <span class="stringliteral">&quot;%s%s%s%s(unsigned int ind, &quot;</span>,
<a name="l02302"></a>02302                     ctxH-&gt;get(),
<a name="l02303"></a>02303                     oclassname, (_isref || !cl-&gt;asBasicClass() ? getPtrRet() : <span class="stringliteral">&quot; &quot;</span>),
<a name="l02304"></a>02304                     ATTRNAME_1(name, (ordered ? GenCodeHints::tRetrieveItemAt : GenCodeHints::tGetItemAt), hints));
<a name="l02305"></a>02305             dimArgsGen(fdh, ndims);
<a name="l02306"></a>02306             fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Bool *isnull = 0, eyedb::Status *rs = 0);\n&quot;</span>, comma);
<a name="l02307"></a>02307           }
<a name="l02308"></a>02308         }
<a name="l02309"></a>02309       
<a name="l02310"></a>02310         <span class="keywordflow">if</span> (_isref) {
<a name="l02311"></a>02311           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Oid %s(unsigned int ind, &quot;</span>,
<a name="l02312"></a>02312                   ctxH-&gt;get(),
<a name="l02313"></a>02313                   ATTRNAME_1(name, (ordered ? GenCodeHints::tRetrieveOidItemAt : GenCodeHints::tGetOidItemAt) , hints));
<a name="l02314"></a>02314           dimArgsGen(fdh, ndims);
<a name="l02315"></a>02315           fprintf(fdh, <span class="stringliteral">&quot;%seyedb::Status *rs = 0) const;\n&quot;</span>, comma);
<a name="l02316"></a>02316         }
<a name="l02317"></a>02317       }
<a name="l02318"></a>02318     }
<a name="l02319"></a>02319 
<a name="l02320"></a>02320     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Attribute.html#ae670bea8f802cfe523bb9d5bce26363f" title="Not yet documented.">isVarDim</a>() &amp;&amp; !is_string)
<a name="l02321"></a>02321       fprintf(fdh, <span class="stringliteral">&quot;%sunsigned int %s(%s) const;\n&quot;</span>, ctxH-&gt;get(),
<a name="l02322"></a>02322               ATTRNAME(name, tGetCount, hints), starg);
<a name="l02323"></a>02323 
<a name="l02324"></a>02324     generateBody_C(own, ctxC, hints);
<a name="l02325"></a>02325 
<a name="l02326"></a>02326     <span class="keywordflow">return</span> Success;
<a name="l02327"></a>02327   }
<a name="l02328"></a>02328 
<a name="l02329"></a>02329   <span class="keyword">static</span> <span class="keywordtype">void</span> const_f0(FILE *fd, Class *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *var,
<a name="l02330"></a>02330                        Bool fill = False)
<a name="l02331"></a>02331   {
<a name="l02332"></a>02332     <span class="keywordflow">if</span> (!strcmp(parent-&gt;getName(), <span class="stringliteral">&quot;struct&quot;</span>))
<a name="l02333"></a>02333       fprintf(fd, <span class="stringliteral">&quot;eyedb::Struct(%s)&quot;</span>, var);
<a name="l02334"></a>02334     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(parent-&gt;getName(), <span class="stringliteral">&quot;union&quot;</span>))
<a name="l02335"></a>02335       fprintf(fd, <span class="stringliteral">&quot;eyedb::Union(%s)&quot;</span>, var);
<a name="l02336"></a>02336     <span class="keywordflow">else</span>
<a name="l02337"></a>02337       fprintf(fd, <span class="stringliteral">&quot;%s(%s, 1)&quot;</span>, className(parent), var);
<a name="l02338"></a>02338 
<a name="l02339"></a>02339     <span class="keywordflow">if</span> (fill)
<a name="l02340"></a>02340       fprintf(fd, <span class="stringliteral">&quot;\n{\n&quot;</span>);
<a name="l02341"></a>02341   }
<a name="l02342"></a>02342 
<a name="l02343"></a>02343   <span class="keyword">static</span> <span class="keywordtype">void</span> const_f01(FILE *fd, Class *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *var,
<a name="l02344"></a>02344                         Bool fill = False)
<a name="l02345"></a>02345   {
<a name="l02346"></a>02346     <span class="keywordflow">if</span> (!strcmp(parent-&gt;getName(), <span class="stringliteral">&quot;struct&quot;</span>))
<a name="l02347"></a>02347       fprintf(fd, <span class="stringliteral">&quot;eyedb::Struct(%s, share)&quot;</span>, var);
<a name="l02348"></a>02348     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(parent-&gt;getName(), <span class="stringliteral">&quot;union&quot;</span>))
<a name="l02349"></a>02349       fprintf(fd, <span class="stringliteral">&quot;eyedb::Union(%s, share)&quot;</span>, var);
<a name="l02350"></a>02350     <span class="keywordflow">else</span>
<a name="l02351"></a>02351       fprintf(fd, <span class="stringliteral">&quot;%s(%s, share, 1)&quot;</span>, className(parent), var);
<a name="l02352"></a>02352 
<a name="l02353"></a>02353     <span class="keywordflow">if</span> (fill)
<a name="l02354"></a>02354       fprintf(fd, <span class="stringliteral">&quot;\n{\n&quot;</span>);
<a name="l02355"></a>02355   }
<a name="l02356"></a>02356 
<a name="l02357"></a>02357   <span class="keyword">static</span> <span class="keywordtype">void</span> const_f1(FILE *fd, GenContext *ctx, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, Bool share)
<a name="l02358"></a>02358   {
<a name="l02359"></a>02359     <span class="keywordflow">if</span> (share)
<a name="l02360"></a>02360       fprintf(fd, <span class="stringliteral">&quot;%sif (!share)\n%s  {\n&quot;</span>, ctx-&gt;get(), ctx-&gt;get());
<a name="l02361"></a>02361 
<a name="l02362"></a>02362     fprintf(fd, <span class="stringliteral">&quot;%s%sheaderCode(eyedb::_Struct_Type, idr_psize, IDB_XINFO_LOCAL_OBJ);\n&quot;</span>,
<a name="l02363"></a>02363             ctx-&gt;get(), (share ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;&quot;</span>), name);
<a name="l02364"></a>02364 
<a name="l02365"></a>02365     fprintf(fd, <span class="stringliteral">&quot;%s%seyedb::ClassPeer::newObjRealize(getClass(), this);\n&quot;</span>, ctx-&gt;get(), (share ? <span class="stringliteral">&quot;    &quot;</span> : <span class="stringliteral">&quot;&quot;</span>));
<a name="l02366"></a>02366     <span class="keywordflow">if</span> (share)
<a name="l02367"></a>02367       fprintf(fd, <span class="stringliteral">&quot;%s  }\n\n&quot;</span>, ctx-&gt;get());
<a name="l02368"></a>02368 
<a name="l02369"></a>02369     fprintf(fd, <span class="stringliteral">&quot;%seyedb::ObjectPeer::setGRTObject(this, eyedb::True);\n&quot;</span>, ctx-&gt;get());
<a name="l02370"></a>02370   }
<a name="l02371"></a>02371 
<a name="l02372"></a>02372   Status AgregatClass::generateConstructors_C(GenContext *ctx)
<a name="l02373"></a>02373   {
<a name="l02374"></a>02374     FILE *fd = ctx-&gt;getFile();
<a name="l02375"></a>02375 
<a name="l02376"></a>02376     fprintf(fd, <span class="stringliteral">&quot;%s::%s(eyedb::Database *_db, const eyedb::Dataspace *_dataspace) : &quot;</span>, name, name);
<a name="l02377"></a>02377 
<a name="l02378"></a>02378     const_f0(fd, parent, <span class="stringliteral">&quot;_db, _dataspace&quot;</span>, eyedb::True);
<a name="l02379"></a>02379 
<a name="l02380"></a>02380     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l02381"></a>02381       fprintf(fd, <span class="stringliteral">&quot;%sattrCacheEmpty();\n&quot;</span>, ctx-&gt;get());
<a name="l02382"></a>02382     fprintf(fd, <span class="stringliteral">&quot;%sinitialize(_db);\n&quot;</span>, ctx-&gt;get());
<a name="l02383"></a>02383     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02384"></a>02384 
<a name="l02385"></a>02385     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l02386"></a>02386       {
<a name="l02387"></a>02387         fprintf(fd, <span class="stringliteral">&quot;void %s::attrCacheEmpty()\n{\n&quot;</span>, name);
<a name="l02388"></a>02388         <span class="keywordflow">if</span> (strcmp(<a class="code" href="classeyedb_1_1Class.html#a4a2f136880c7e40ca629468634e7ca3f" title="Not yet documented.">getParent</a>()-&gt;<a class="code" href="classeyedb_1_1Class.html#af38e817e4edaf5921e9ca05bd5e6367e" title="Not yet documented.">getName</a>(), <span class="stringliteral">&quot;struct&quot;</span>) &amp;&amp;
<a name="l02389"></a>02389             !<a class="code" href="classeyedb_1_1Class.html#a4a2f136880c7e40ca629468634e7ca3f" title="Not yet documented.">getParent</a>()-&gt;isRootClass())
<a name="l02390"></a>02390           fprintf(fd, <span class="stringliteral">&quot;%s%s::attrCacheEmpty();\n&quot;</span>, ctx-&gt;get(),
<a name="l02391"></a>02391                   <a class="code" href="classeyedb_1_1Class.html#a4a2f136880c7e40ca629468634e7ca3f" title="Not yet documented.">getParent</a>()-&gt;getCName());
<a name="l02392"></a>02392 
<a name="l02393"></a>02393         <span class="keywordtype">int</span> i;
<a name="l02394"></a>02394         <span class="keywordflow">for</span> (i = 0; i &lt; items_cnt; i++)
<a name="l02395"></a>02395           <span class="keywordflow">if</span> (items[i]-&gt;getClassOwner()-&gt;compare(<span class="keyword">this</span>))
<a name="l02396"></a>02396             items[i]-&gt;genAttrCacheEmpty(ctx);
<a name="l02397"></a>02397         fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02398"></a>02398 
<a name="l02399"></a>02399         fprintf(fd, <span class="stringliteral">&quot;void %s::garbage()\n{\n&quot;</span>, name);
<a name="l02400"></a>02400         <span class="keywordflow">for</span> (i = 0; i &lt; items_cnt; i++)
<a name="l02401"></a>02401           <span class="keywordflow">if</span> (items[i]-&gt;getClassOwner()-&gt;<a class="code" href="classeyedb_1_1Class.html#a6e050f5722e61299c03dbc09f612c110" title="Not yet documented.">compare</a>(<span class="keyword">this</span>))
<a name="l02402"></a>02402             items[i]-&gt;genAttrCacheGarbage(ctx);
<a name="l02403"></a>02403         fprintf(fd, <span class="stringliteral">&quot;%s%s::garbage();\n&quot;</span>, ctx-&gt;get(), <a class="code" href="classeyedb_1_1Class.html#a4a2f136880c7e40ca629468634e7ca3f" title="Not yet documented.">getParent</a>()-&gt;getCName());
<a name="l02404"></a>02404         fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02405"></a>02405       }
<a name="l02406"></a>02406 
<a name="l02407"></a>02407     <span class="comment">// changed the 12/10/00 because of a memory leaks</span>
<a name="l02408"></a>02408     <span class="comment">/*</span>
<a name="l02409"></a>02409 <span class="comment">      fprintf(fd, &quot;%s::%s(const Class *_cls, Data _idr)\n{\n&quot;,</span>
<a name="l02410"></a>02410 <span class="comment">      name, name);</span>
<a name="l02411"></a>02411 <span class="comment">    */</span>
<a name="l02412"></a>02412     fprintf(fd, <span class="stringliteral">&quot;%s::%s(const eyedb::Class *_cls, eyedb::Data _idr)&quot;</span>, name, name);
<a name="l02413"></a>02413     <span class="keywordflow">if</span> (strcmp(parent-&gt;getName(), <span class="stringliteral">&quot;struct&quot;</span>))
<a name="l02414"></a>02414       fprintf(fd, <span class="stringliteral">&quot;: %s((eyedb::Database *)0, (const eyedb::Dataspace *)0, 1)&quot;</span>, className(parent));
<a name="l02415"></a>02415     fprintf(fd, <span class="stringliteral">&quot;\n{\n&quot;</span>);
<a name="l02416"></a>02416     fprintf(fd, <span class="stringliteral">&quot;%ssetClass((eyedb::Class *)_cls);\n\n&quot;</span>, ctx-&gt;get());
<a name="l02417"></a>02417 
<a name="l02418"></a>02418     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size idr_psize;\n&quot;</span>, ctx-&gt;get());
<a name="l02419"></a>02419     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size idr_tsize = getClass()-&gt;getIDRObjectSize(&amp;idr_psize);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02420"></a>02420     fprintf(fd, <span class="stringliteral">&quot;%sif (_idr)\n&quot;</span>, ctx-&gt;get());
<a name="l02421"></a>02421     fprintf(fd, <span class="stringliteral">&quot;%s  idr-&gt;setIDR(idr_tsize, _idr);\n&quot;</span>, ctx-&gt;get());
<a name="l02422"></a>02422     fprintf(fd, <span class="stringliteral">&quot;%selse\n&quot;</span>, ctx-&gt;get());
<a name="l02423"></a>02423     fprintf(fd, <span class="stringliteral">&quot;%s  {\n&quot;</span>, ctx-&gt;get());
<a name="l02424"></a>02424     <span class="comment">// changed the 5/02/01</span>
<a name="l02425"></a>02425     <span class="comment">//  fprintf(fd, &quot;%s    idr-&gt;setIDR(idr-&gt;getSize());\n&quot;, ctx-&gt;get());</span>
<a name="l02426"></a>02426     fprintf(fd, <span class="stringliteral">&quot;%s    idr-&gt;setIDR(idr_tsize);\n&quot;</span>, ctx-&gt;get());
<a name="l02427"></a>02427     fprintf(fd, <span class="stringliteral">&quot;%s    memset(idr-&gt;getIDR() + IDB_OBJ_HEAD_SIZE, 0, idr-&gt;getSize() - IDB_OBJ_HEAD_SIZE);\n&quot;</span>, ctx-&gt;get());
<a name="l02428"></a>02428     fprintf(fd, <span class="stringliteral">&quot;%s  }\n&quot;</span>, ctx-&gt;get());
<a name="l02429"></a>02429 
<a name="l02430"></a>02430     fprintf(fd, <span class="stringliteral">&quot;%sheaderCode(eyedb::_Struct_Type, idr_psize, IDB_XINFO_LOCAL_OBJ);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02431"></a>02431     fprintf(fd, <span class="stringliteral">&quot;%seyedb::ClassPeer::newObjRealize(getClass(), this);\n&quot;</span>, ctx-&gt;get());
<a name="l02432"></a>02432     fprintf(fd, <span class="stringliteral">&quot;%seyedb::ObjectPeer::setGRTObject(this, eyedb::True);\n&quot;</span>, ctx-&gt;get());
<a name="l02433"></a>02433     fprintf(fd, <span class="stringliteral">&quot;%suserInitialize();\n&quot;</span>, ctx-&gt;get());
<a name="l02434"></a>02434     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02435"></a>02435 
<a name="l02436"></a>02436     fprintf(fd, <span class="stringliteral">&quot;void %s::initialize(eyedb::Database *_db)\n{\n&quot;</span>,
<a name="l02437"></a>02437             name);
<a name="l02438"></a>02438     fprintf(fd, <span class="stringliteral">&quot;%ssetClass((_db ? _db-&gt;getSchema()-&gt;getClass(\&quot;%s\&quot;) : %s%s));\n\n&quot;</span>, ctx-&gt;get(), getAliasName(), name, classSuffix);
<a name="l02439"></a>02439     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size idr_psize;\n&quot;</span>, ctx-&gt;get());
<a name="l02440"></a>02440     <span class="comment">//fprintf(fd, &quot;%sidr-&gt;idr_sz = getClass()-&gt;getIDRObjectSize(&amp;idr_psize);\n&quot;, ctx-&gt;get(), name);</span>
<a name="l02441"></a>02441     fprintf(fd, <span class="stringliteral">&quot;%sidr-&gt;setIDR(getClass()-&gt;getIDRObjectSize(&amp;idr_psize));\n&quot;</span>,
<a name="l02442"></a>02442             ctx-&gt;get(), name);
<a name="l02443"></a>02443   
<a name="l02444"></a>02444     <span class="comment">//fprintf(fd, &quot;%sidr-&gt;idr = (unsigned char *)malloc(idr-&gt;idr_sz * sizeof(unsigned char));\n\n&quot;, ctx-&gt;get());</span>
<a name="l02445"></a>02445     fprintf(fd, <span class="stringliteral">&quot;%smemset(idr-&gt;getIDR() + IDB_OBJ_HEAD_SIZE, 0, idr-&gt;getSize() - IDB_OBJ_HEAD_SIZE);\n&quot;</span>,
<a name="l02446"></a>02446             ctx-&gt;get());
<a name="l02447"></a>02447 
<a name="l02448"></a>02448     const_f1(fd, ctx, name, False);
<a name="l02449"></a>02449     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l02450"></a>02450       fprintf(fd, <span class="stringliteral">&quot;%sattrCacheEmpty();\n&quot;</span>, ctx-&gt;get());
<a name="l02451"></a>02451     fprintf(fd, <span class="stringliteral">&quot;%suserInitialize();\n&quot;</span>, ctx-&gt;get());
<a name="l02452"></a>02452     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02453"></a>02453 
<a name="l02454"></a>02454     fprintf(fd, <span class="stringliteral">&quot;%s::%s(const %s&amp; x) : %s(x)\n{\n&quot;</span>,
<a name="l02455"></a>02455             name, name, name, parent-&gt;getCName(), ctx-&gt;get());
<a name="l02456"></a>02456     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l02457"></a>02457       fprintf(fd, <span class="stringliteral">&quot;%sattrCacheEmpty();\n&quot;</span>, ctx-&gt;get());
<a name="l02458"></a>02458     fprintf(fd, <span class="stringliteral">&quot;%suserCopy(x);\n&quot;</span>, ctx-&gt;get());
<a name="l02459"></a>02459     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02460"></a>02460     fprintf(fd, <span class="stringliteral">&quot;%s&amp; %s::operator=(const %s&amp; x)\n{\n&quot;</span>, name, name, name);
<a name="l02461"></a>02461     fprintf(fd, <span class="stringliteral">&quot;%s*(%s *)this = %s::operator=((const %s &amp;)x);\n&quot;</span>,
<a name="l02462"></a>02462             ctx-&gt;get(), parent-&gt;getCName(), parent-&gt;getCName(),  parent-&gt;getCName());
<a name="l02463"></a>02463     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l02464"></a>02464       fprintf(fd, <span class="stringliteral">&quot;%sattrCacheEmpty();\n&quot;</span>, ctx-&gt;get());
<a name="l02465"></a>02465     fprintf(fd, <span class="stringliteral">&quot;%suserCopy(x);\n&quot;</span>, ctx-&gt;get());
<a name="l02466"></a>02466     fprintf(fd, <span class="stringliteral">&quot;%sreturn *this;\n&quot;</span>, ctx-&gt;get());
<a name="l02467"></a>02467     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>, ctx-&gt;get());
<a name="l02468"></a>02468 
<a name="l02469"></a>02469     fprintf(fd, <span class="stringliteral">&quot;%s::%s(const eyedb::Struct *x, eyedb::Bool share) : &quot;</span>,
<a name="l02470"></a>02470             name, name, className(parent));
<a name="l02471"></a>02471 
<a name="l02472"></a>02472     const_f01(fd, parent, <span class="stringliteral">&quot;x&quot;</span>, True);
<a name="l02473"></a>02473 
<a name="l02474"></a>02474     fprintf(fd, <span class="stringliteral">&quot;%ssetClass((db ? db-&gt;getSchema()-&gt;getClass(\&quot;%s\&quot;) : %s%s));\n\n&quot;</span>, ctx-&gt;get(), getAliasName(), name, classSuffix);
<a name="l02475"></a>02475     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size idr_psize;\n&quot;</span>, ctx-&gt;get());
<a name="l02476"></a>02476     fprintf(fd, <span class="stringliteral">&quot;%sgetClass()-&gt;getIDRObjectSize(&amp;idr_psize);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02477"></a>02477 
<a name="l02478"></a>02478     const_f1(fd, ctx, name, True);
<a name="l02479"></a>02479     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l02480"></a>02480       fprintf(fd, <span class="stringliteral">&quot;%sattrCacheEmpty();\n&quot;</span>, ctx-&gt;get());
<a name="l02481"></a>02481     fprintf(fd, <span class="stringliteral">&quot;%suserCopy(*x);\n&quot;</span>, ctx-&gt;get());
<a name="l02482"></a>02482     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02483"></a>02483 
<a name="l02484"></a>02484     fprintf(fd, <span class="stringliteral">&quot;%s::%s(const %s *x, eyedb::Bool share) : &quot;</span>, name, name,
<a name="l02485"></a>02485             name, className(parent));
<a name="l02486"></a>02486 
<a name="l02487"></a>02487     const_f01(fd, parent, <span class="stringliteral">&quot;x&quot;</span>, True);
<a name="l02488"></a>02488 
<a name="l02489"></a>02489     fprintf(fd, <span class="stringliteral">&quot;%ssetClass((db ? db-&gt;getSchema()-&gt;getClass(\&quot;%s\&quot;) : %s%s));\n\n&quot;</span>, ctx-&gt;get(), getAliasName(), name, classSuffix);
<a name="l02490"></a>02490 
<a name="l02491"></a>02491     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Size idr_psize;\n&quot;</span>, ctx-&gt;get());
<a name="l02492"></a>02492     fprintf(fd, <span class="stringliteral">&quot;%sgetClass()-&gt;getIDRObjectSize(&amp;idr_psize);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02493"></a>02493     const_f1(fd, ctx, name, True);
<a name="l02494"></a>02494     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l02495"></a>02495       fprintf(fd, <span class="stringliteral">&quot;%sattrCacheEmpty();\n&quot;</span>, ctx-&gt;get());
<a name="l02496"></a>02496     fprintf(fd, <span class="stringliteral">&quot;%suserCopy(*x);\n&quot;</span>, ctx-&gt;get());
<a name="l02497"></a>02497 
<a name="l02498"></a>02498     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02499"></a>02499     <span class="keywordflow">return</span> Success;
<a name="l02500"></a>02500   }
<a name="l02501"></a>02501 
<a name="l02502"></a>02502   Status AgregatClass::generateDownCasting_C(GenContext *ctx,
<a name="l02503"></a>02503                                              Schema *m)
<a name="l02504"></a>02504   {
<a name="l02505"></a>02505     <span class="keyword">const</span> LinkedList *list = m-&gt;getClassList();
<a name="l02506"></a>02506     LinkedListCursor *curs = list-&gt;startScan();
<a name="l02507"></a>02507     FILE *fd = ctx-&gt;getFile();
<a name="l02508"></a>02508 
<a name="l02509"></a>02509     <a class="code" href="classeyedb_1_1Class.html#ada2741c543d86641fba1093bf887b385" title="Not yet documented.">Class</a> *cl;
<a name="l02510"></a>02510 
<a name="l02511"></a>02511     <span class="keywordflow">while</span> (list-&gt;getNextObject(curs, (<span class="keywordtype">void</span> *&amp;)cl))
<a name="l02512"></a>02512       {
<a name="l02513"></a>02513         Bool is;
<a name="l02514"></a>02514         <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Class.html#a89fa257e1ccd735c6ee8a7145aff5b89" title="Not yet documented.">isSuperClassOf</a>(cl, &amp;is) == Success &amp;&amp; is)
<a name="l02515"></a>02515           {
<a name="l02516"></a>02516             <span class="keyword">const</span> <span class="keywordtype">char</span> *s = className(cl);
<a name="l02517"></a>02517             <span class="keywordtype">char</span> body[128], body_const[128];
<a name="l02518"></a>02518 
<a name="l02519"></a>02519             <span class="keywordflow">if</span> (cl == <span class="keyword">this</span>)
<a name="l02520"></a>02520               {
<a name="l02521"></a>02521                 sprintf(body, <span class="stringliteral">&quot; {return this;}\n&quot;</span>);
<a name="l02522"></a>02522                 strcpy(body_const, body);
<a name="l02523"></a>02523               }
<a name="l02524"></a>02524             <span class="keywordflow">else</span>
<a name="l02525"></a>02525               {
<a name="l02526"></a>02526                 sprintf(body, <span class="stringliteral">&quot; {return (%s *)0;}\n&quot;</span>, s);
<a name="l02527"></a>02527                 sprintf(body_const, <span class="stringliteral">&quot; {return (const %s *)0;}\n&quot;</span>, s);
<a name="l02528"></a>02528               }
<a name="l02529"></a>02529 
<a name="l02530"></a>02530             fprintf(fd, <span class="stringliteral">&quot;%svirtual %s *%s%s()%s&quot;</span>, ctx-&gt;get(),
<a name="l02531"></a>02531                     s, downCastPrefix, cl-&gt;getCanonicalName(), body);
<a name="l02532"></a>02532           
<a name="l02533"></a>02533             fprintf(fd, <span class="stringliteral">&quot;%svirtual const %s *%s%s() const%s&quot;</span>, ctx-&gt;get(),
<a name="l02534"></a>02534                     s, downCastPrefix, cl-&gt;getCanonicalName(), body_const);
<a name="l02535"></a>02535           }
<a name="l02536"></a>02536       }
<a name="l02537"></a>02537 
<a name="l02538"></a>02538     <span class="keywordflow">return</span> Success;
<a name="l02539"></a>02539   }
<a name="l02540"></a>02540 
<a name="l02541"></a>02541   <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02542"></a>02542   true_items_count(<span class="keyword">const</span> Class *cls, Attribute **items, <span class="keywordtype">int</span> items_cnt)
<a name="l02543"></a>02543   {
<a name="l02544"></a>02544     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; items_cnt; i++)
<a name="l02545"></a>02545       <span class="keywordflow">if</span> (items[i]-&gt;getClassOwner() == cls &amp;&amp; !items[i]-&gt;isNative())
<a name="l02546"></a>02546         <span class="keywordflow">return</span> items_cnt - i;
<a name="l02547"></a>02547 
<a name="l02548"></a>02548     <span class="keywordflow">return</span> 0;
<a name="l02549"></a>02549   }
<a name="l02550"></a>02550 
<a name="l02551"></a>02551   Status
<a name="l02552"></a>02552   AgregatClass::generateClassDesc_C(GenContext *ctx,
<a name="l02553"></a>02553                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *)
<a name="l02554"></a>02554   {
<a name="l02555"></a>02555     FILE *fd = ctx-&gt;getFile();
<a name="l02556"></a>02556     Status status;
<a name="l02557"></a>02557     <span class="keyword">const</span> <span class="keywordtype">char</span> *_type = (<a class="code" href="classeyedb_1_1Object.html#a27b0f62f2c7eb019cadcf3f0019454e8" title="Not yet documented.">asStructClass</a>() ? <span class="stringliteral">&quot;Struct&quot;</span> : <span class="stringliteral">&quot;Union&quot;</span>);
<a name="l02558"></a>02558 
<a name="l02559"></a>02559     fprintf(fd, <span class="stringliteral">&quot;static const eyedb::Attribute **%s_agritems;\n&quot;</span>, name);
<a name="l02560"></a>02560     fprintf(fd, <span class="stringliteral">&quot;static eyedb::Size %s_idr_objsz, %s_idr_psize;\n\n&quot;</span>, name, name);
<a name="l02561"></a>02561 
<a name="l02562"></a>02562     fprintf(fd, <span class="stringliteral">&quot;static eyedb::%sClass *%s_make(eyedb::%sClass *%s_class = 0, eyedb::Schema *m = 0)\n{\n&quot;</span>, _type, name, _type, name);
<a name="l02563"></a>02563     ctx-&gt;push();
<a name="l02564"></a>02564 
<a name="l02565"></a>02565     fprintf(fd, <span class="stringliteral">&quot;%sif (!%s_class)\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02566"></a>02566     <a class="code" href="classeyedb_1_1Class.html#ada2741c543d86641fba1093bf887b385" title="Not yet documented.">Class</a> *parent_cl = parent-&gt;isRootClass() ? parent-&gt;getParent() : parent;
<a name="l02567"></a>02567     fprintf(fd,<span class="stringliteral">&quot;%s  return new eyedb::%sClass(\&quot;%s\&quot;, (m ? m-&gt;getClass(\&quot;%s\&quot;) : %s%s));\n&quot;</span>, ctx-&gt;get(), _type, getAliasName(),
<a name="l02568"></a>02568             (parent_cl-&gt;getAliasName() ?  parent_cl-&gt;getAliasName() : parent_cl-&gt;getName()),
<a name="l02569"></a>02569             className(parent_cl), classSuffix);
<a name="l02570"></a>02570     <span class="comment">// changed the 30/05/01: was:</span>
<a name="l02571"></a>02571     <span class="comment">// className(parent_cl, True, True), className(parent_cl), classSuffix);</span>
<a name="l02572"></a>02572 
<a name="l02573"></a>02573     <span class="keywordflow">if</span> (items_cnt)
<a name="l02574"></a>02574       {
<a name="l02575"></a>02575         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Attribute *attr[%d];\n&quot;</span>, ctx-&gt;get(), items_cnt);
<a name="l02576"></a>02576         <span class="keywordtype">int</span> dims_declare = 0;
<a name="l02577"></a>02577       
<a name="l02578"></a>02578         <span class="keywordtype">int</span> i;
<a name="l02579"></a>02579         <span class="keywordflow">for</span> (i = 0; i &lt; items_cnt; i++)
<a name="l02580"></a>02580           <span class="keywordflow">if</span> (items[i]-&gt;class_owner == (<span class="keywordtype">void</span> *)<span class="keyword">this</span> &amp;&amp; !items[i]-&gt;isNative())
<a name="l02581"></a>02581             {
<a name="l02582"></a>02582               <span class="keywordflow">if</span> (!dims_declare)
<a name="l02583"></a>02583                 {
<a name="l02584"></a>02584                   dims_declare = 1;
<a name="l02585"></a>02585                   fprintf(fd, <span class="stringliteral">&quot;%sint *dims;\n&quot;</span>, ctx-&gt;get());
<a name="l02586"></a>02586                 }
<a name="l02587"></a>02587               status = items[i]-&gt;generateClassDesc_C(ctx);
<a name="l02588"></a>02588               <span class="keywordflow">if</span> (status)
<a name="l02589"></a>02589                 <span class="keywordflow">return</span> status;
<a name="l02590"></a>02590             }
<a name="l02591"></a>02591       
<a name="l02592"></a>02592         <span class="keywordtype">int</span> count = true_items_count(<span class="keyword">this</span>, items, items_cnt);
<a name="l02593"></a>02593         fprintf(fd, <span class="stringliteral">&quot;\n%s%s_class-&gt;setAttributes(&amp;attr[%d], %d);\n&quot;</span>, ctx-&gt;get(),
<a name="l02594"></a>02594                 name, items_cnt - count, count);
<a name="l02595"></a>02595 
<a name="l02596"></a>02596         fprintf(fd, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02597"></a>02597 
<a name="l02598"></a>02598         <span class="keywordflow">for</span> (i = items_cnt - count; i &lt; items_cnt; i++)
<a name="l02599"></a>02599           fprintf(fd, <span class="stringliteral">&quot;%sdelete attr[%d];\n&quot;</span>, ctx-&gt;get(), i);
<a name="l02600"></a>02600 
<a name="l02601"></a>02601         fprintf(fd, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02602"></a>02602       }
<a name="l02603"></a>02603     <span class="keywordflow">else</span>
<a name="l02604"></a>02604       fprintf(fd, <span class="stringliteral">&quot;\n%s%s_class-&gt;setAttributes(0, 0);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02605"></a>02605 
<a name="l02606"></a>02606     <span class="comment">// should set implementation. Really necessary ?? Bof.</span>
<a name="l02607"></a>02607     <span class="comment">/*</span>
<a name="l02608"></a>02608 <span class="comment">      if (idximpl-&gt;getType() == IndexImpl::Hash)</span>
<a name="l02609"></a>02609 <span class="comment">      fprintf(fd, &quot;%sidximpl = new IndexImpl(IndexImpl::Hash, 0, &quot;</span>
<a name="l02610"></a>02610 <span class="comment">      &quot;%d, idximp</span>
<a name="l02611"></a>02611 <span class="comment">    */</span>
<a name="l02612"></a>02612 
<a name="l02613"></a>02613     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Class.html#a3b290294c146f4016a7cda7c7e3436d9" title="Not yet documented.">isSystem</a>() || odl_system_class)
<a name="l02614"></a>02614       fprintf(fd, <span class="stringliteral">&quot;%seyedb::ClassPeer::setMType(%s_class, eyedb::Class::System);\n&quot;</span>,
<a name="l02615"></a>02615               ctx-&gt;get(), name);
<a name="l02616"></a>02616 
<a name="l02617"></a>02617     fprintf(fd, <span class="stringliteral">&quot;\n%sreturn %s_class;\n}\n\n&quot;</span>, ctx-&gt;get(),
<a name="l02618"></a>02618             name);
<a name="l02619"></a>02619 
<a name="l02620"></a>02620     fprintf(fd, <span class="stringliteral">&quot;eyedb::Object *%s_construct_x(const eyedb::Class *cls, eyedb::Data idr)\n{\n&quot;</span>, name);
<a name="l02621"></a>02621     fprintf(fd, <span class="stringliteral">&quot;%sreturn new %s(cls, idr);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02622"></a>02622     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02623"></a>02623 
<a name="l02624"></a>02624     fprintf(fd, <span class="stringliteral">&quot;eyedb::Object *%s_construct(const eyedb::Object *o, eyedb::Bool share)\n{\n&quot;</span>, name);
<a name="l02625"></a>02625     fprintf(fd, <span class="stringliteral">&quot;%sreturn new %s((const eyedb::Struct *)o, share);\n&quot;</span>, ctx-&gt;get(), name);
<a name="l02626"></a>02626     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02627"></a>02627 
<a name="l02628"></a>02628     fprintf(fd, <span class="stringliteral">&quot;static void %s_init_p()\n{\n&quot;</span>, name);
<a name="l02629"></a>02629     fprintf(fd, <span class="stringliteral">&quot;%s%s%s = %s_make();\n&quot;</span>, ctx-&gt;get(), name, classSuffix, name);
<a name="l02630"></a>02630     fprintf(fd, <span class="stringliteral">&quot;%sconstructors_x[class_ind] = %s_construct_x;\n&quot;</span>, ctx-&gt;get(),
<a name="l02631"></a>02631             name);
<a name="l02632"></a>02632     fprintf(fd, <span class="stringliteral">&quot;%sconstructors[class_ind] = %s_construct;\n&quot;</span>, ctx-&gt;get(),
<a name="l02633"></a>02633             name);
<a name="l02634"></a>02634     fprintf(fd, <span class="stringliteral">&quot;%shash-&gt;insert(\&quot;%s\&quot;, class_ind++);\n&quot;</span>, ctx-&gt;get(),
<a name="l02635"></a>02635             getAliasName());
<a name="l02636"></a>02636     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02637"></a>02637 
<a name="l02638"></a>02638     fprintf(fd, <span class="stringliteral">&quot;static void %s_init()\n{\n&quot;</span>, name);
<a name="l02639"></a>02639     fprintf(fd, <span class="stringliteral">&quot;%s%s_make(%s%s);\n\n&quot;</span>, ctx-&gt;get(), name, name, classSuffix);
<a name="l02640"></a>02640     fprintf(fd, <span class="stringliteral">&quot;%s%s_agritems = %s%s-&gt;getAttributes();\n&quot;</span>, ctx-&gt;get(),
<a name="l02641"></a>02641             name, name, classSuffix);
<a name="l02642"></a>02642     fprintf(fd, <span class="stringliteral">&quot;%s%s_idr_objsz = %s%s-&gt;getIDRObjectSize(&amp;%s_idr_psize, 0);\n\n&quot;</span>,
<a name="l02643"></a>02643             ctx-&gt;get(), name, name, classSuffix, name);
<a name="l02644"></a>02644 
<a name="l02645"></a>02645     fprintf(fd, <span class="stringliteral">&quot;%seyedb::ObjectPeer::setUnrealizable(%s%s, eyedb::True);\n&quot;</span>,
<a name="l02646"></a>02646             ctx-&gt;get(), name, classSuffix);
<a name="l02647"></a>02647     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02648"></a>02648     ctx-&gt;pop();
<a name="l02649"></a>02649     <span class="keywordflow">return</span> Success;
<a name="l02650"></a>02650   }
<a name="l02651"></a>02651 
<a name="l02652"></a>02652 <span class="preprocessor">#define NEW_ARGTYPE</span>
<a name="l02653"></a>02653 <span class="preprocessor"></span>
<a name="l02654"></a>02654   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l02655"></a>02655   argTypeDump(GenContext *ctx, ArgType *argtype, <span class="keyword">const</span> <span class="keywordtype">char</span> *str)
<a name="l02656"></a>02656   {
<a name="l02657"></a>02657     FILE *fd = ctx-&gt;getFile();
<a name="l02658"></a>02658 
<a name="l02659"></a>02659 <span class="preprocessor">#ifdef NEW_ARGTYPE</span>
<a name="l02660"></a>02660 <span class="preprocessor"></span>    fprintf(fd, <span class="stringliteral">&quot;%sargtype = %s;\n&quot;</span>, ctx-&gt;get(), str);
<a name="l02661"></a>02661 <span class="preprocessor">#else</span>
<a name="l02662"></a>02662 <span class="preprocessor"></span>    fprintf(fd, <span class="stringliteral">&quot;%sargtype = new eyedb::ArgType();\n&quot;</span>, ctx-&gt;get());
<a name="l02663"></a>02663 <span class="preprocessor">#endif</span>
<a name="l02664"></a>02664 <span class="preprocessor"></span>
<a name="l02665"></a>02665     fprintf(fd, <span class="stringliteral">&quot;%sargtype-&gt;setType((eyedb::ArgType_Type)%d, eyedb::False);\n&quot;</span>,
<a name="l02666"></a>02666             ctx-&gt;get(), argtype-&gt;getType());
<a name="l02667"></a>02667 
<a name="l02668"></a>02668     <span class="comment">/*</span>
<a name="l02669"></a>02669 <span class="comment">      if ((argtype-&gt;getType() &amp; ~(INOUT_ARG_TYPE|ARRAY_TYPE)) == OBJ_TYPE)</span>
<a name="l02670"></a>02670 <span class="comment">    */</span>
<a name="l02671"></a>02671     fprintf(fd, <span class="stringliteral">&quot;%sargtype-&gt;setClname(\&quot;%s\&quot;);\n&quot;</span>, ctx-&gt;get(),
<a name="l02672"></a>02672             argtype-&gt;getClname().c_str());
<a name="l02673"></a>02673   }
<a name="l02674"></a>02674 
<a name="l02675"></a>02675   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02676"></a>02676   sign_declare_realize(FILE *fd, GenContext *ctx)
<a name="l02677"></a>02677   {
<a name="l02678"></a>02678     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Signature *sign;\n&quot;</span>, ctx-&gt;get());
<a name="l02679"></a>02679     fprintf(fd, <span class="stringliteral">&quot;%seyedb::ArgType *argtype;\n\n&quot;</span>, ctx-&gt;get());
<a name="l02680"></a>02680   }
<a name="l02681"></a>02681 
<a name="l02682"></a>02682 <span class="preprocessor">#define dataspace_prologue(ctx, fd, x) \</span>
<a name="l02683"></a>02683 <span class="preprocessor">do { \</span>
<a name="l02684"></a>02684 <span class="preprocessor">  Bool isnull; \</span>
<a name="l02685"></a>02685 <span class="preprocessor">  short dspid = x-&gt;getDspid(&amp;isnull); \</span>
<a name="l02686"></a>02686 <span class="preprocessor">  if (!isnull) { \</span>
<a name="l02687"></a>02687 <span class="preprocessor">    fprintf(fd, &quot;%sstatus = db-&gt;getDataspace(%d, dataspace);\n&quot;, \</span>
<a name="l02688"></a>02688 <span class="preprocessor">            ctx-&gt;get(), dspid); \</span>
<a name="l02689"></a>02689 <span class="preprocessor">    fprintf(fd, &quot;%sif (status) return status;\n&quot;, ctx-&gt;get()); \</span>
<a name="l02690"></a>02690 <span class="preprocessor">  } \</span>
<a name="l02691"></a>02691 <span class="preprocessor">  else \</span>
<a name="l02692"></a>02692 <span class="preprocessor">    fprintf(fd, &quot;%sdataspace = 0;;\n&quot;, ctx-&gt;get()); \</span>
<a name="l02693"></a>02693 <span class="preprocessor">} while(0)</span>
<a name="l02694"></a>02694 <span class="preprocessor"></span>
<a name="l02695"></a>02695 <span class="preprocessor">#define hints_prologue(ctx, fd, x) \</span>
<a name="l02696"></a>02696 <span class="preprocessor">do { \</span>
<a name="l02697"></a>02697 <span class="preprocessor">  int cnt = x-&gt;getImplHintsCount(); \</span>
<a name="l02698"></a>02698 <span class="preprocessor">  if (cnt) { \</span>
<a name="l02699"></a>02699 <span class="preprocessor">    fprintf(fd, &quot;%simpl_hints = new int[%d];\n&quot;, \</span>
<a name="l02700"></a>02700 <span class="preprocessor">            ctx-&gt;get(), cnt); \</span>
<a name="l02701"></a>02701 <span class="preprocessor">    for (int i = 0; i &lt; cnt; i++) \</span>
<a name="l02702"></a>02702 <span class="preprocessor">      fprintf(fd, &quot;%simpl_hints[%d] = %d;\n&quot;, ctx-&gt;get(), i, \</span>
<a name="l02703"></a>02703 <span class="preprocessor">              x-&gt;getImplHints(i)); \</span>
<a name="l02704"></a>02704 <span class="preprocessor">  } \</span>
<a name="l02705"></a>02705 <span class="preprocessor">} while(0)</span>
<a name="l02706"></a>02706 <span class="preprocessor"></span>
<a name="l02707"></a>02707 
<a name="l02708"></a>02708 <span class="preprocessor">#define hints_epilogue(ctx, fd, x) \</span>
<a name="l02709"></a>02709 <span class="preprocessor">do { \</span>
<a name="l02710"></a>02710 <span class="preprocessor">  int cnt = x-&gt;getImplHintsCount(); \</span>
<a name="l02711"></a>02711 <span class="preprocessor">  if (cnt) { \</span>
<a name="l02712"></a>02712 <span class="preprocessor">    fprintf(fd, &quot;, impl_hints, %d);\n&quot;, cnt); \</span>
<a name="l02713"></a>02713 <span class="preprocessor">    fprintf(fd, &quot;%sdelete [] impl_hints;\n&quot;, ctx-&gt;get());\</span>
<a name="l02714"></a>02714 <span class="preprocessor">  } \</span>
<a name="l02715"></a>02715 <span class="preprocessor">  else \</span>
<a name="l02716"></a>02716 <span class="preprocessor">    fprintf(fd, &quot;0, 0);\n&quot;); \</span>
<a name="l02717"></a>02717 <span class="preprocessor">} while(0)</span>
<a name="l02718"></a>02718 <span class="preprocessor"></span>
<a name="l02719"></a>02719   <span class="keywordtype">void</span>
<a name="l02720"></a>02720   Class::compAddGenerate(GenContext *ctx, FILE *fd)
<a name="l02721"></a>02721   {
<a name="l02722"></a>02722     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Object.html#a9c6ea45e7255e0918ab86b6b97b4e459" title="Not yet documented.">asAgregatClass</a>()) {
<a name="l02723"></a>02723       <span class="comment">/*</span>
<a name="l02724"></a>02724 <span class="comment">        fprintf(fd, &quot;%sif (cls-&gt;getOid().isValid()) {\n&quot;, ctx-&gt;get());</span>
<a name="l02725"></a>02725 <span class="comment">        fprintf(fd, &quot;%s  if (status = comp-&gt;realize()) return status;\n&quot;, ctx-&gt;get());</span>
<a name="l02726"></a>02726 <span class="comment">        fprintf(fd, &quot;%s} else\n&quot;, ctx-&gt;get());</span>
<a name="l02727"></a>02727 <span class="comment">      */</span>
<a name="l02728"></a>02728       fprintf(fd, <span class="stringliteral">&quot;%scls-&gt;add(comp-&gt;getInd(), comp);\n\n&quot;</span>, ctx-&gt;get());
<a name="l02729"></a>02729     }
<a name="l02730"></a>02730     <span class="keywordflow">else</span>
<a name="l02731"></a>02731       fprintf(fd, <span class="stringliteral">&quot;%sif (status = comp-&gt;realize()) return status;\n\n&quot;</span>, ctx-&gt;get());
<a name="l02732"></a>02732   }
<a name="l02733"></a>02733 
<a name="l02734"></a>02734   Status Class::generateAttrComponent_C(GenContext *ctx)
<a name="l02735"></a>02735   {
<a name="l02736"></a>02736     <span class="keywordflow">if</span> (!<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCODE) &amp;&amp; !<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCOMP)) {
<a name="l02737"></a>02737       printf(<span class="stringliteral">&quot;generateAttrComponent_C -&gt; is system %s %p\n&quot;</span>, name, <span class="keyword">this</span>);
<a name="l02738"></a>02738       <span class="keywordflow">return</span> Success;
<a name="l02739"></a>02739     }
<a name="l02740"></a>02740 
<a name="l02741"></a>02741     <span class="keyword">const</span> LinkedList *list;
<a name="l02742"></a>02742     Status s = <a class="code" href="classeyedb_1_1Class.html#acb90a33463f7a8d1dad5bc907cbbb79f" title="Not yet documented.">getAttrCompList</a>(list);
<a name="l02743"></a>02743     <span class="keywordflow">if</span> (s) <span class="keywordflow">return</span> s;
<a name="l02744"></a>02744 
<a name="l02745"></a>02745     FILE *fd = ctx-&gt;getFile();
<a name="l02746"></a>02746 
<a name="l02747"></a>02747     fprintf(fd, <span class="stringliteral">&quot;static eyedb::Status %s_attrcomp_realize(eyedb::Database *db, eyedb::Class *cls)\n{\n&quot;</span>, name);
<a name="l02748"></a>02748 
<a name="l02749"></a>02749     ctx-&gt;push();
<a name="l02750"></a>02750     <span class="keywordflow">if</span> (list-&gt;getCount()) {
<a name="l02751"></a>02751       fprintf(fd, <span class="stringliteral">&quot;%seyedb::AttributeComponent *comp;\n&quot;</span>, ctx-&gt;get());
<a name="l02752"></a>02752       fprintf(fd, <span class="stringliteral">&quot;%sconst eyedb::Dataspace *dataspace;\n&quot;</span>, ctx-&gt;get());
<a name="l02753"></a>02753       fprintf(fd, <span class="stringliteral">&quot;%seyedb::ClassComponent *clcomp;\n&quot;</span>, ctx-&gt;get());
<a name="l02754"></a>02754       fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status status;\n&quot;</span>, ctx-&gt;get());
<a name="l02755"></a>02755       fprintf(fd, <span class="stringliteral">&quot;%sint *impl_hints;\n&quot;</span>, ctx-&gt;get());
<a name="l02756"></a>02756     }
<a name="l02757"></a>02757 
<a name="l02758"></a>02758     LinkedListCursor c(list);
<a name="l02759"></a>02759 
<a name="l02760"></a>02760     AttributeComponent *comp;
<a name="l02761"></a>02761     Bool setup_done = False;
<a name="l02762"></a>02762     <span class="keywordflow">while</span> (c.getNext((<span class="keywordtype">void</span> *&amp;)comp)){
<a name="l02763"></a>02763       <span class="keywordflow">if</span> (comp-&gt;asNotNullConstraint()) {
<a name="l02764"></a>02764         NotNullConstraint *notnull = comp-&gt;asNotNullConstraint();
<a name="l02765"></a>02765         fprintf(fd, <span class="stringliteral">&quot;%scomp = new eyedb::NotNullConstraint(db, cls, \&quot;%s\&quot;, %s);\n&quot;</span>,
<a name="l02766"></a>02766                 ctx-&gt;get(), notnull-&gt;getAttrpath().c_str(),
<a name="l02767"></a>02767                 IDBBOOL_STR(notnull-&gt;getPropagate()));
<a name="l02768"></a>02768       }
<a name="l02769"></a>02769       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp-&gt;asUniqueConstraint()) {
<a name="l02770"></a>02770         UniqueConstraint *unique = comp-&gt;asUniqueConstraint();
<a name="l02771"></a>02771         fprintf(fd, <span class="stringliteral">&quot;%scomp = new eyedb::UniqueConstraint(db, cls, \&quot;%s\&quot;, %s);\n&quot;</span>,
<a name="l02772"></a>02772                 ctx-&gt;get(), unique-&gt;getAttrpath().c_str(),
<a name="l02773"></a>02773                 IDBBOOL_STR(unique-&gt;getPropagate()));
<a name="l02774"></a>02774       }
<a name="l02775"></a>02775       <span class="comment">/*</span>
<a name="l02776"></a>02776 <span class="comment">        else if (comp-&gt;asCardinalityConstraint()) {</span>
<a name="l02777"></a>02777 <span class="comment">        CardinalityConstraint *card = comp-&gt;asCardinalityConstraint();</span>
<a name="l02778"></a>02778 <span class="comment">        CardinalityDescription *card_desc = card-&gt;getCardDesc();</span>
<a name="l02779"></a>02779 <span class="comment">        fprintf(fd, &quot;%scomp = new CardinalityConstraint(db, cls, \&quot;%s\&quot;, %d, %d, %d, %d);\n&quot;,</span>
<a name="l02780"></a>02780 <span class="comment">        ctx-&gt;get(), card-&gt;getAttrname(), card_desc-&gt;getBottom(),</span>
<a name="l02781"></a>02781 <span class="comment">        card_desc-&gt;getBottomExcl(),</span>
<a name="l02782"></a>02782 <span class="comment">        card_desc-&gt;getTop(), card_desc-&gt;getTopExcl());</span>
<a name="l02783"></a>02783 <span class="comment">        }</span>
<a name="l02784"></a>02784 <span class="comment">      */</span>
<a name="l02785"></a>02785       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp-&gt;asBTreeIndex()) {
<a name="l02786"></a>02786         BTreeIndex *idx = comp-&gt;asBTreeIndex();
<a name="l02787"></a>02787         hints_prologue(ctx, fd, idx);
<a name="l02788"></a>02788         dataspace_prologue(ctx, fd, idx);
<a name="l02789"></a>02789         fprintf(fd, <span class="stringliteral">&quot;%scomp = new eyedb::BTreeIndex(db, cls, \&quot;%s\&quot;, %s, %s, dataspace, %d&quot;</span>,
<a name="l02790"></a>02790                 ctx-&gt;get(), idx-&gt;getAttrpath().c_str(),
<a name="l02791"></a>02791                 IDBBOOL_STR(idx-&gt;getPropagate()),
<a name="l02792"></a>02792                 IDBBOOL_STR(idx-&gt;getIsString()),
<a name="l02793"></a>02793                 idx-&gt;getDegree());
<a name="l02794"></a>02794         hints_epilogue(ctx, fd, idx);
<a name="l02795"></a>02795       }
<a name="l02796"></a>02796       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp-&gt;asHashIndex()) {
<a name="l02797"></a>02797         HashIndex *idx = comp-&gt;asHashIndex();
<a name="l02798"></a>02798         <span class="keywordflow">if</span> (idx-&gt;getHashMethod()) {
<a name="l02799"></a>02799           <span class="comment">// hack</span>
<a name="l02800"></a>02800           <span class="keywordflow">if</span> (!setup_done) {
<a name="l02801"></a>02801             fprintf(fd, <span class="stringliteral">&quot;%sgetClass()-&gt;setSetupComplete(eyedb::True);\n&quot;</span>, ctx-&gt;get());
<a name="l02802"></a>02802             setup_done = True;
<a name="l02803"></a>02803           }
<a name="l02804"></a>02804           fprintf(fd, <span class="stringliteral">&quot;%sstatus = getClass()-&gt;getComp(\&quot;%s\&quot;, clcomp);\n&quot;</span>,
<a name="l02805"></a>02805                   ctx-&gt;get(), idx-&gt;getHashMethod()-&gt;getName().c_str());
<a name="l02806"></a>02806           fprintf(fd, <span class="stringliteral">&quot;%sif (status) return status;\n&quot;</span>, ctx-&gt;get());
<a name="l02807"></a>02807         }
<a name="l02808"></a>02808         hints_prologue(ctx, fd, idx);
<a name="l02809"></a>02809         dataspace_prologue(ctx, fd, idx);
<a name="l02810"></a>02810         fprintf(fd, <span class="stringliteral">&quot;%scomp = new eyedb::HashIndex(db, cls, \&quot;%s\&quot;, %s, %s, dataspace, %d&quot;</span>,
<a name="l02811"></a>02811                 ctx-&gt;get(), idx-&gt;getAttrpath().c_str(),
<a name="l02812"></a>02812                 IDBBOOL_STR(idx-&gt;getPropagate()),
<a name="l02813"></a>02813                 IDBBOOL_STR(idx-&gt;getIsString()),
<a name="l02814"></a>02814                 idx-&gt;getKeyCount());
<a name="l02815"></a>02815       
<a name="l02816"></a>02816         <span class="keywordflow">if</span> (idx-&gt;getHashMethod())
<a name="l02817"></a>02817           fprintf(fd, <span class="stringliteral">&quot;, clcomp-&gt;asBEMethod_C()&quot;</span>);
<a name="l02818"></a>02818         <span class="keywordflow">else</span>
<a name="l02819"></a>02819           fprintf(fd, <span class="stringliteral">&quot;, 0&quot;</span>);
<a name="l02820"></a>02820         hints_epilogue(ctx, fd, idx);
<a name="l02821"></a>02821       }
<a name="l02822"></a>02822       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp-&gt;asCollAttrImpl()) {
<a name="l02823"></a>02823         CollAttrImpl *collimpl = comp-&gt;asCollAttrImpl();
<a name="l02824"></a>02824         <span class="keywordflow">if</span> (collimpl-&gt;getHashMethod()) {
<a name="l02825"></a>02825           <span class="comment">// hack</span>
<a name="l02826"></a>02826           <span class="keywordflow">if</span> (!setup_done) {
<a name="l02827"></a>02827             fprintf(fd, <span class="stringliteral">&quot;%sgetClass()-&gt;setSetupComplete(eyedb::True);\n&quot;</span>, ctx-&gt;get());
<a name="l02828"></a>02828             setup_done = True;
<a name="l02829"></a>02829           }
<a name="l02830"></a>02830           fprintf(fd, <span class="stringliteral">&quot;%sstatus = getClass()-&gt;getComp(\&quot;%s\&quot;, clcomp);\n&quot;</span>,
<a name="l02831"></a>02831                   ctx-&gt;get(), collimpl-&gt;getHashMethod()-&gt;getName().c_str());
<a name="l02832"></a>02832           fprintf(fd, <span class="stringliteral">&quot;%sif (status) return status;\n&quot;</span>, ctx-&gt;get());
<a name="l02833"></a>02833         }
<a name="l02834"></a>02834         hints_prologue(ctx, fd, collimpl);
<a name="l02835"></a>02835         dataspace_prologue(ctx, fd, collimpl);
<a name="l02836"></a>02836         fprintf(fd, <span class="stringliteral">&quot;%scomp = new eyedb::CollAttrImpl(db, cls, \&quot;%s\&quot;, %s, dataspace, %s, %d&quot;</span>,
<a name="l02837"></a>02837                 ctx-&gt;get(), collimpl-&gt;getAttrpath().c_str(),
<a name="l02838"></a>02838                 IDBBOOL_STR(collimpl-&gt;getPropagate()),
<a name="l02839"></a>02839                 (collimpl-&gt;getImplType() == IndexImpl::Hash ?
<a name="l02840"></a>02840                  <span class="stringliteral">&quot;eyedb::CollImpl::HashIndex&quot;</span> :
<a name="l02841"></a>02841                  (collimpl-&gt;getImplType() == CollImpl::NoIndex ?
<a name="l02842"></a>02842                   <span class="stringliteral">&quot;eyedb::CollImpl::NoIndex&quot;</span> :
<a name="l02843"></a>02843                   <span class="stringliteral">&quot;eyedb::CollImpl::BTreeIndex&quot;</span>)),
<a name="l02844"></a>02844                 collimpl-&gt;getKeyCountOrDegree());
<a name="l02845"></a>02845       
<a name="l02846"></a>02846         <span class="keywordflow">if</span> (collimpl-&gt;getHashMethod())
<a name="l02847"></a>02847           fprintf(fd, <span class="stringliteral">&quot;, clcomp-&gt;asBEMethod_C()&quot;</span>);
<a name="l02848"></a>02848         <span class="keywordflow">else</span>
<a name="l02849"></a>02849           fprintf(fd, <span class="stringliteral">&quot;, 0&quot;</span>);
<a name="l02850"></a>02850         hints_epilogue(ctx, fd, collimpl);
<a name="l02851"></a>02851       }
<a name="l02852"></a>02852       <span class="keywordflow">else</span>
<a name="l02853"></a>02853         abort();
<a name="l02854"></a>02854     
<a name="l02855"></a>02855       compAddGenerate(ctx, fd);
<a name="l02856"></a>02856     }
<a name="l02857"></a>02857 
<a name="l02858"></a>02858     fprintf(fd, <span class="stringliteral">&quot;%sreturn eyedb::Success;\n&quot;</span>, ctx-&gt;get());
<a name="l02859"></a>02859 
<a name="l02860"></a>02860     ctx-&gt;pop();
<a name="l02861"></a>02861     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02862"></a>02862     <span class="keywordflow">return</span> Success;
<a name="l02863"></a>02863   }
<a name="l02864"></a>02864 
<a name="l02865"></a>02865   Status Class::generateClassComponent_C(GenContext *ctx)
<a name="l02866"></a>02866   {
<a name="l02867"></a>02867     <span class="keywordflow">if</span> (!<a class="code" href="classeyedb_1_1Class.html#ac8255802630be6cf653eb9b66cecf0b7" title="Not yet documented.">getCompList</a>() || !<a class="code" href="classeyedb_1_1Class.html#ac8255802630be6cf653eb9b66cecf0b7" title="Not yet documented.">getCompList</a>()-&gt;getCount())
<a name="l02868"></a>02868       <span class="keywordflow">return</span> Success;
<a name="l02869"></a>02869 
<a name="l02870"></a>02870     <span class="keywordflow">if</span> (!<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCODE) &amp;&amp; !<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCOMP)) {
<a name="l02871"></a>02871       printf(<span class="stringliteral">&quot;generateClassComponent_C -&gt; is system %s %p\n&quot;</span>, name, <span class="keyword">this</span>);
<a name="l02872"></a>02872       <span class="keywordflow">return</span> Success;
<a name="l02873"></a>02873     }
<a name="l02874"></a>02874 
<a name="l02875"></a>02875     FILE *fd = ctx-&gt;getFile();
<a name="l02876"></a>02876 
<a name="l02877"></a>02877     Status status;
<a name="l02878"></a>02878     <span class="comment">//const char *_type = (asStructClass() ? &quot;Struct&quot; : &quot;Union&quot;);</span>
<a name="l02879"></a>02879 
<a name="l02880"></a>02880     fprintf(fd, <span class="stringliteral">&quot;static eyedb::Status %s_comp_realize(eyedb::Database *db, eyedb::Class *cls)\n{\n&quot;</span>, name);
<a name="l02881"></a>02881 
<a name="l02882"></a>02882     ctx-&gt;push();
<a name="l02883"></a>02883     <span class="keywordflow">if</span> (complist-&gt;getCount())
<a name="l02884"></a>02884       {
<a name="l02885"></a>02885         fprintf(fd, <span class="stringliteral">&quot;%seyedb::ClassComponent *comp;\n&quot;</span>, ctx-&gt;get());
<a name="l02886"></a>02886         fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status status;\n&quot;</span>, ctx-&gt;get());
<a name="l02887"></a>02887       }
<a name="l02888"></a>02888 
<a name="l02889"></a>02889     <span class="keywordtype">int</span> sign_declare = 0;
<a name="l02890"></a>02890 
<a name="l02891"></a>02891     LinkedListCursor c(complist);
<a name="l02892"></a>02892 
<a name="l02893"></a>02893     ClassComponent *comp;
<a name="l02894"></a>02894     <span class="keywordflow">while</span> (complist-&gt;getNextObject(&amp;c, (<span class="keywordtype">void</span> *&amp;)comp))
<a name="l02895"></a>02895       {
<a name="l02896"></a>02896         <span class="keywordflow">if</span> (comp-&gt;asCardinalityConstraint())
<a name="l02897"></a>02897           {
<a name="l02898"></a>02898             CardinalityConstraint *card = comp-&gt;asCardinalityConstraint();
<a name="l02899"></a>02899             CardinalityDescription *card_desc = card-&gt;getCardDesc();
<a name="l02900"></a>02900             fprintf(fd, <span class="stringliteral">&quot;%scomp = new eyedb::CardinalityConstraint(db, cls, \&quot;%s\&quot;, %d, %d, %d, %d);\n&quot;</span>,
<a name="l02901"></a>02901                     ctx-&gt;get(), card-&gt;getAttrname().c_str(), card_desc-&gt;getBottom(),
<a name="l02902"></a>02902                     card_desc-&gt;getBottomExcl(),
<a name="l02903"></a>02903                     card_desc-&gt;getTop(), card_desc-&gt;getTopExcl());
<a name="l02904"></a>02904           }
<a name="l02905"></a>02905         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp-&gt;asTrigger())
<a name="l02906"></a>02906           {
<a name="l02907"></a>02907             Trigger *trig = comp-&gt;asTrigger();
<a name="l02908"></a>02908             <span class="keywordtype">char</span> *x = purge(trig-&gt;getEx()-&gt;getExtrefBody().c_str());
<a name="l02909"></a>02909             fprintf(fd, <span class="stringliteral">&quot;%scomp = new eyedb::Trigger(db, cls, (eyedb::TriggerType)%d, (eyedb::ExecutableLang)%d, %s, \&quot;%s\&quot;, %s, \&quot;%s\&quot;);\n&quot;</span>,
<a name="l02910"></a>02910                     ctx-&gt;get(), trig-&gt;getType(),
<a name="l02911"></a>02911                     (trig-&gt;getEx()-&gt;getLang() &amp; ~SYSTEM_EXEC),
<a name="l02912"></a>02912                     STRBOOL(trig-&gt;getEx()-&gt;getLang() &amp; SYSTEM_EXEC),
<a name="l02913"></a>02913                     trig-&gt;getSuffix().c_str(),
<a name="l02914"></a>02914                     trig-&gt;getLight() ? <span class="stringliteral">&quot;eyedb::True&quot;</span> : <span class="stringliteral">&quot;eyedb::False&quot;</span>,
<a name="l02915"></a>02915                     x);
<a name="l02916"></a>02916             free(x);
<a name="l02917"></a>02917           }
<a name="l02918"></a>02918         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp-&gt;asMethod())
<a name="l02919"></a>02919           {
<a name="l02920"></a>02920             Method *mth = comp-&gt;asMethod();
<a name="l02921"></a>02921             Executable *ex = mth-&gt;getEx();
<a name="l02922"></a>02922 
<a name="l02923"></a>02923             <span class="keywordflow">if</span> ((ex-&gt;getLang() &amp; (C_LANG|SYSTEM_EXEC)) ==
<a name="l02924"></a>02924                 (C_LANG|SYSTEM_EXEC) &amp;&amp; !odl_system_class)
<a name="l02925"></a>02925               <span class="keywordflow">continue</span>;
<a name="l02926"></a>02926 
<a name="l02927"></a>02927             <span class="keywordflow">if</span> (!sign_declare)
<a name="l02928"></a>02928               {
<a name="l02929"></a>02929                 sign_declare = 1;
<a name="l02930"></a>02930                 sign_declare_realize(fd, ctx);
<a name="l02931"></a>02931               }
<a name="l02932"></a>02932 
<a name="l02933"></a>02933             fprintf(fd, <span class="stringliteral">&quot;%ssign = new eyedb::Signature();\n&quot;</span>,
<a name="l02934"></a>02934                     ctx-&gt;get());
<a name="l02935"></a>02935             Signature *sign = ex-&gt;getSign();
<a name="l02936"></a>02936             <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix = ((ex-&gt;getLoc()&amp;~STATIC_EXEC) == FRONTEND ? <span class="stringliteral">&quot;FE&quot;</span> : <span class="stringliteral">&quot;BE&quot;</span>);
<a name="l02937"></a>02937             <span class="keyword">const</span> <span class="keywordtype">char</span> *lang = ((ex-&gt;getLang() &amp; C_LANG) ? <span class="stringliteral">&quot;C&quot;</span>  : <span class="stringliteral">&quot;OQL&quot;</span>);
<a name="l02938"></a>02938             <span class="keywordtype">char</span> *extref = purge(ex-&gt;getExtrefBody().c_str());
<a name="l02939"></a>02939 
<a name="l02940"></a>02940 <span class="preprocessor">#ifdef NEW_ARGTYPE</span>
<a name="l02941"></a>02941 <span class="preprocessor"></span>            argTypeDump(ctx, sign-&gt;getRettype(), <span class="stringliteral">&quot;sign-&gt;getRettype()&quot;</span>);
<a name="l02942"></a>02942 <span class="preprocessor">#else</span>
<a name="l02943"></a>02943 <span class="preprocessor"></span>            argTypeDump(ctx, sign-&gt;getRettype());
<a name="l02944"></a>02944             fprintf(fd, <span class="stringliteral">&quot;%ssign-&gt;setRettype(argtype);\n&quot;</span>, ctx-&gt;get());
<a name="l02945"></a>02945             fprintf(fd, <span class="stringliteral">&quot;%sargtype-&gt;release();\n\n&quot;</span>, ctx-&gt;get());
<a name="l02946"></a>02946 <span class="preprocessor">#endif</span>
<a name="l02947"></a>02947 <span class="preprocessor"></span>
<a name="l02948"></a>02948             <span class="keywordtype">int</span> nargs = sign-&gt;getNargs();
<a name="l02949"></a>02949             fprintf(fd, <span class="stringliteral">&quot;%ssign-&gt;setNargs(%d);\n&quot;</span>, ctx-&gt;get(), nargs);
<a name="l02950"></a>02950             fprintf(fd, <span class="stringliteral">&quot;%ssign-&gt;setTypesCount(%d);\n&quot;</span>, ctx-&gt;get(), nargs);
<a name="l02951"></a>02951             <span class="keywordtype">int</span> i;
<a name="l02952"></a>02952             <span class="keywordflow">for</span> (i = 0; i &lt; nargs; i++)
<a name="l02953"></a>02953               {
<a name="l02954"></a>02954 <span class="preprocessor">#ifdef NEW_ARGTYPE</span>
<a name="l02955"></a>02955 <span class="preprocessor"></span>                <span class="keywordtype">char</span> tok[128];
<a name="l02956"></a>02956                 sprintf(tok, <span class="stringliteral">&quot;sign-&gt;getTypes(%d)&quot;</span>, i);
<a name="l02957"></a>02957                 argTypeDump(ctx, sign-&gt;getTypes(i), tok);
<a name="l02958"></a>02958 <span class="preprocessor">#else</span>
<a name="l02959"></a>02959 <span class="preprocessor"></span>                argTypeDump(ctx, sign-&gt;getTypes(i));
<a name="l02960"></a>02960                 fprintf(fd, <span class="stringliteral">&quot;%ssign-&gt;setTypes(%d, argtype);\n&quot;</span>, ctx-&gt;get(),
<a name="l02961"></a>02961                         i);
<a name="l02962"></a>02962                 fprintf(fd, <span class="stringliteral">&quot;%sargtype-&gt;release();\n\n&quot;</span>, ctx-&gt;get());
<a name="l02963"></a>02963 <span class="preprocessor">#endif</span>
<a name="l02964"></a>02964 <span class="preprocessor"></span>              }
<a name="l02965"></a>02965 
<a name="l02966"></a>02966             fprintf(fd,
<a name="l02967"></a>02967                     <span class="stringliteral">&quot;%scomp = new eyedb::%sMethod_%s(db, cls, \&quot;%s\&quot;, sign, %s, %s, \&quot;%s\&quot;);\n&quot;</span>,
<a name="l02968"></a>02968                     ctx-&gt;get(), prefix, lang, ex-&gt;getExname().c_str(),
<a name="l02969"></a>02969                     STRBOOL(ex-&gt;isStaticExec()),
<a name="l02970"></a>02970                     STRBOOL(ex-&gt;getLang() &amp; SYSTEM_EXEC),
<a name="l02971"></a>02971                     extref);
<a name="l02972"></a>02972             free(extref);
<a name="l02973"></a>02973           }
<a name="l02974"></a>02974         <span class="keywordflow">else</span>
<a name="l02975"></a>02975           abort();
<a name="l02976"></a>02976 
<a name="l02977"></a>02977         compAddGenerate(ctx, fd);
<a name="l02978"></a>02978 
<a name="l02979"></a>02979         <span class="keywordflow">if</span> (comp-&gt;asMethod())
<a name="l02980"></a>02980           fprintf(fd, <span class="stringliteral">&quot;%ssign-&gt;release();\n\n&quot;</span>, ctx-&gt;get());
<a name="l02981"></a>02981       }
<a name="l02982"></a>02982 
<a name="l02983"></a>02983     fprintf(fd, <span class="stringliteral">&quot;%sreturn eyedb::Success;\n&quot;</span>, ctx-&gt;get());
<a name="l02984"></a>02984 
<a name="l02985"></a>02985     ctx-&gt;pop();
<a name="l02986"></a>02986     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l02987"></a>02987     <span class="keywordflow">return</span> Success;
<a name="l02988"></a>02988   }
<a name="l02989"></a>02989 
<a name="l02990"></a>02990   Status AgregatClass::generateConstructors_C(GenContext *ctxH,
<a name="l02991"></a>02991                                               GenContext *ctxC)
<a name="l02992"></a>02992   {
<a name="l02993"></a>02993     FILE *fdh = ctxH-&gt;getFile();
<a name="l02994"></a>02994 
<a name="l02995"></a>02995     fprintf(fdh, <span class="stringliteral">&quot;%s%s(eyedb::Database * = 0, const eyedb::Dataspace * = 0);\n&quot;</span>, ctxH-&gt;get(), name);
<a name="l02996"></a>02996 
<a name="l02997"></a>02997     fprintf(fdh, <span class="stringliteral">&quot;%s%s(const %s&amp; x);\n\n&quot;</span>, ctxH-&gt;get(), name, name);
<a name="l02998"></a>02998 
<a name="l02999"></a>02999     <span class="keywordflow">if</span> (isRootClass()) {
<a name="l03000"></a>03000       fprintf(fdh, <span class="stringliteral">&quot;%svirtual eyedb::Object *clone() const &quot;</span>
<a name="l03001"></a>03001               <span class="stringliteral">&quot;{return _clone();};\n&quot;</span>, ctxH-&gt;get(), name);
<a name="l03002"></a>03002       fprintf(fdh, <span class="stringliteral">&quot;%svirtual eyedb::Object *_clone() const &quot;</span>
<a name="l03003"></a>03003               <span class="stringliteral">&quot;{return new %s(*this);};\n\n&quot;</span>, ctxH-&gt;get(), name);
<a name="l03004"></a>03004     }
<a name="l03005"></a>03005     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (odl_rootclass) { <span class="comment">// ctxC-&gt;getRootclass()) {</span>
<a name="l03006"></a>03006       fprintf(fdh, <span class="stringliteral">&quot;%svirtual eyedb::Object *_clone() const &quot;</span>
<a name="l03007"></a>03007               <span class="stringliteral">&quot;{return new %s(*this);};\n\n&quot;</span>, ctxH-&gt;get(), name);
<a name="l03008"></a>03008     }
<a name="l03009"></a>03009     <span class="keywordflow">else</span> {
<a name="l03010"></a>03010       fprintf(fdh, <span class="stringliteral">&quot;%svirtual eyedb::Object *clone() const &quot;</span>
<a name="l03011"></a>03011               <span class="stringliteral">&quot;{return new %s(*this);};\n\n&quot;</span>, ctxH-&gt;get(), name);
<a name="l03012"></a>03012     }
<a name="l03013"></a>03013 
<a name="l03014"></a>03014     fprintf(fdh, <span class="stringliteral">&quot;%s%s&amp; operator=(const %s&amp; x);\n\n&quot;</span>, ctxH-&gt;get(), name, name);
<a name="l03015"></a>03015 
<a name="l03016"></a>03016     generateConstructors_C(ctxC);
<a name="l03017"></a>03017 
<a name="l03018"></a>03018     <span class="keywordflow">return</span> Success;
<a name="l03019"></a>03019   }
<a name="l03020"></a>03020 
<a name="l03021"></a>03021   Status
<a name="l03022"></a>03022   AgregatClass::generateMethodDecl_C(Schema *m, GenContext *ctx)
<a name="l03023"></a>03023   {
<a name="l03024"></a>03024     FILE *fd = ctx-&gt;getFile();
<a name="l03025"></a>03025     LinkedListCursor c(complist);
<a name="l03026"></a>03026 
<a name="l03027"></a>03027     ClassComponent *comp;
<a name="l03028"></a>03028 
<a name="l03029"></a>03029     <span class="keywordflow">while</span> (c.getNext((<span class="keywordtype">void</span> *&amp;)comp))
<a name="l03030"></a>03030       <span class="keywordflow">if</span> (comp-&gt;asMethod())
<a name="l03031"></a>03031         {
<a name="l03032"></a>03032           Method *mth = comp-&gt;asMethod();
<a name="l03033"></a>03033           Executable *ex = mth-&gt;getEx();
<a name="l03034"></a>03034 
<a name="l03035"></a>03035           <span class="keywordflow">if</span> (!(ex-&gt;getLang() &amp; C_LANG))
<a name="l03036"></a>03036             <span class="keywordflow">continue</span>;
<a name="l03037"></a>03037 
<a name="l03038"></a>03038           <span class="keywordflow">if</span> (!mth-&gt;getUserData())
<a name="l03039"></a>03039             <span class="keywordflow">continue</span>;
<a name="l03040"></a>03040 
<a name="l03041"></a>03041           Signature *sign = ex-&gt;getSign();
<a name="l03042"></a>03042         
<a name="l03043"></a>03043           <span class="keywordflow">if</span> (sign-&gt;getUserData()) {
<a name="l03044"></a>03044             odlMethodHints *mth_hints = ((odlSignUserData *)sign-&gt;getUserData())-&gt;mth_hints;
<a name="l03045"></a>03045             <span class="keywordflow">if</span> (mth_hints-&gt;calledFrom != odlMethodHints::ANY_HINTS &amp;&amp;
<a name="l03046"></a>03046                 mth_hints-&gt;calledFrom != odlMethodHints::C_HINTS)
<a name="l03047"></a>03047               <span class="keywordflow">continue</span>;
<a name="l03048"></a>03048           }
<a name="l03049"></a>03049 
<a name="l03050"></a>03050           <span class="keywordflow">if</span> (ex-&gt;isStaticExec()) {
<a name="l03051"></a>03051             fprintf(fd, <span class="stringliteral">&quot;%sstatic eyedb::Status %s(eyedb::Database *db&quot;</span>, ctx-&gt;get(),
<a name="l03052"></a>03052                     ex-&gt;getExname().c_str());
<a name="l03053"></a>03053             <span class="keywordflow">if</span> (sign-&gt;getNargs() || !Signature::isVoid(sign-&gt;getRettype()))
<a name="l03054"></a>03054               fprintf(fd, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l03055"></a>03055           }
<a name="l03056"></a>03056           <span class="keywordflow">else</span>
<a name="l03057"></a>03057             fprintf(fd, <span class="stringliteral">&quot;%svirtual eyedb::Status %s(&quot;</span>, ctx-&gt;get(), ex-&gt;getExname().c_str());
<a name="l03058"></a>03058 
<a name="l03059"></a>03059           sign-&gt;declArgs(fd, m);
<a name="l03060"></a>03060           fprintf(fd, <span class="stringliteral">&quot;);\n\n&quot;</span>);
<a name="l03061"></a>03061         }
<a name="l03062"></a>03062 
<a name="l03063"></a>03063     <span class="keywordflow">return</span> Success;
<a name="l03064"></a>03064   }
<a name="l03065"></a>03065 
<a name="l03066"></a>03066   Status
<a name="l03067"></a>03067   AgregatClass::generateMethodFetch_C(GenContext *ctx, Method *mth)
<a name="l03068"></a>03068   {
<a name="l03069"></a>03069     FILE *fd = ctx-&gt;getFile();
<a name="l03070"></a>03070     fprintf(fd, <span class="stringliteral">&quot;%sif (!mth)\n&quot;</span>, ctx-&gt;get());
<a name="l03071"></a>03071     fprintf(fd, <span class="stringliteral">&quot;%s{\n&quot;</span>, ctx-&gt;get());
<a name="l03072"></a>03072     ctx-&gt;push();
<a name="l03073"></a>03073     fprintf(fd, <span class="stringliteral">&quot;%sstatus = eyedb::Method::get(db, &quot;</span>
<a name="l03074"></a>03074             <span class="stringliteral">&quot;db-&gt;getSchema()-&gt;getClass(\&quot;%s\&quot;), \&quot;%s\&quot;, %s, mth);\n&quot;</span>,
<a name="l03075"></a>03075             ctx-&gt;get(), (getAliasName() ? getAliasName() : <a class="code" href="classeyedb_1_1Class.html#af38e817e4edaf5921e9ca05bd5e6367e" title="Not yet documented.">getName</a>()),
<a name="l03076"></a>03076             mth-&gt;getPrototype(False),
<a name="l03077"></a>03077             STRBOOL(mth-&gt;getEx()-&gt;isStaticExec()));
<a name="l03078"></a>03078 
<a name="l03079"></a>03079     fprintf(fd, <span class="stringliteral">&quot;%sif (status) return status;\n&quot;</span>, ctx-&gt;get());
<a name="l03080"></a>03080 
<a name="l03081"></a>03081     fprintf(fd, <span class="stringliteral">&quot;%sif (!mth)\n&quot;</span>, ctx-&gt;get());
<a name="l03082"></a>03082     fprintf(fd, <span class="stringliteral">&quot;%s  return eyedb::Exception::make(eyedb::IDB_ERROR, &quot;</span>
<a name="l03083"></a>03083             <span class="stringliteral">&quot;\&quot;method &apos;%s&apos; not found\&quot;);\n&quot;</span>, ctx-&gt;get(), mth-&gt;getPrototype());
<a name="l03084"></a>03084     ctx-&gt;pop();
<a name="l03085"></a>03085     fprintf(fd, <span class="stringliteral">&quot;%s}\n\n&quot;</span>, ctx-&gt;get());
<a name="l03086"></a>03086 
<a name="l03087"></a>03087     <span class="keywordflow">return</span> Success;
<a name="l03088"></a>03088   }
<a name="l03089"></a>03089 
<a name="l03090"></a>03090   Status
<a name="l03091"></a>03091   AgregatClass::generateMethodBodyFE_C(Schema *m,
<a name="l03092"></a>03092                                        GenContext *ctx, Method *mth)
<a name="l03093"></a>03093   {
<a name="l03094"></a>03094     FILE *fd = ctx-&gt;getFile();
<a name="l03095"></a>03095     Executable *ex = mth-&gt;getEx();
<a name="l03096"></a>03096     Signature *sign = ex-&gt;getSign();
<a name="l03097"></a>03097 
<a name="l03098"></a>03098     fprintf(fd, <span class="stringliteral">&quot;eyedb::Status %s::%s(&quot;</span>, name, ex-&gt;getExname().c_str());
<a name="l03099"></a>03099     <span class="keywordflow">if</span> (ex-&gt;isStaticExec()) {
<a name="l03100"></a>03100       fprintf(fd, <span class="stringliteral">&quot;eyedb::Database *db&quot;</span>);
<a name="l03101"></a>03101       <span class="keywordflow">if</span> (sign-&gt;getNargs() || !Signature::isVoid(sign-&gt;getRettype()))
<a name="l03102"></a>03102         fprintf(fd, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l03103"></a>03103     }
<a name="l03104"></a>03104     sign-&gt;declArgs(fd, m);
<a name="l03105"></a>03105     fprintf(fd, <span class="stringliteral">&quot;)\n{\n&quot;</span>);
<a name="l03106"></a>03106     ctx-&gt;push();
<a name="l03107"></a>03107 
<a name="l03108"></a>03108     fprintf(fd, <span class="stringliteral">&quot;%sstatic eyedb::Method *mth;\n&quot;</span>, ctx-&gt;get());
<a name="l03109"></a>03109     fprintf(fd, <span class="stringliteral">&quot;%seyedb::Status status;\n&quot;</span>, ctx-&gt;get());
<a name="l03110"></a>03110 
<a name="l03111"></a>03111     generateMethodFetch_C(ctx, mth);
<a name="l03112"></a>03112 
<a name="l03113"></a>03113 <span class="preprocessor">#ifdef NEW_ARGARR</span>
<a name="l03114"></a>03114 <span class="preprocessor"></span>    fprintf(fd, <span class="stringliteral">&quot;%sstatic eyedb::ArgArray *argarr = new eyedb::ArgArray(%d, eyedb::Argument::AutoFullGarbage);\n\n&quot;</span>,
<a name="l03115"></a>03115             ctx-&gt;get(), sign-&gt;getNargs());
<a name="l03116"></a>03116     sign-&gt;setArgs(fd, m, IN_ARG_TYPE, <span class="stringliteral">&quot;(*argarr)[%d]-&gt;&quot;</span>, <span class="stringliteral">&quot;retarg.&quot;</span>, ctx-&gt;get());
<a name="l03117"></a>03117     fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Argument __retarg;\n&quot;</span>, ctx-&gt;get());
<a name="l03118"></a>03118     fprintf(fd, <span class="stringliteral">&quot;%sstatus = mth-&gt;applyTo(db, %s, *argarr, __retarg, eyedb::False);\n\n&quot;</span>,
<a name="l03119"></a>03119             ctx-&gt;get(), (mth-&gt;getEx()-&gt;isStaticExec() ? <span class="stringliteral">&quot;0&quot;</span> : <span class="stringliteral">&quot;this&quot;</span>));
<a name="l03120"></a>03120     fprintf(fd, <span class="stringliteral">&quot;%sif (status) return status;\n\n&quot;</span>, ctx-&gt;get());
<a name="l03121"></a>03121     sign-&gt;retArgs(fd, m, <span class="stringliteral">&quot;(*argarr)[%d]-&gt;&quot;</span>, <span class="stringliteral">&quot;__retarg.&quot;</span>, ctx-&gt;get());
<a name="l03122"></a>03122 <span class="preprocessor">#else</span>
<a name="l03123"></a>03123 <span class="preprocessor"></span>    fprintf(fd, <span class="stringliteral">&quot;%seyedb::ArgArray argarr(%d, eyedb::Argument::AutoFullGarbage);\n\n&quot;</span>,
<a name="l03124"></a>03124             ctx-&gt;get(), sign-&gt;getNargs());
<a name="l03125"></a>03125     sign-&gt;setArgs(fd, m, IN_ARG_TYPE, <span class="stringliteral">&quot;argarr[%d]-&gt;&quot;</span>, <span class="stringliteral">&quot;retarg.&quot;</span>, ctx-&gt;get());
<a name="l03126"></a>03126     fprintf(fd, <span class="stringliteral">&quot;\n%seyedb::Argument __retarg;\n&quot;</span>, ctx-&gt;get());
<a name="l03127"></a>03127     fprintf(fd, <span class="stringliteral">&quot;%sstatus = mth-&gt;applyTo(db, %s, argarr, __retarg, eyedb::False);\n\n&quot;</span>,
<a name="l03128"></a>03128             ctx-&gt;get(), (mth-&gt;getEx()-&gt;isStaticExec() ? <span class="stringliteral">&quot;0&quot;</span> : <span class="stringliteral">&quot;this&quot;</span>));
<a name="l03129"></a>03129     fprintf(fd, <span class="stringliteral">&quot;%sif (status) return status;\n\n&quot;</span>, ctx-&gt;get());
<a name="l03130"></a>03130     sign-&gt;retArgs(fd, m, <span class="stringliteral">&quot;argarr[%d]-&gt;&quot;</span>, <span class="stringliteral">&quot;__retarg.&quot;</span>, ctx-&gt;get());
<a name="l03131"></a>03131 <span class="preprocessor">#endif</span>
<a name="l03132"></a>03132 <span class="preprocessor"></span>
<a name="l03133"></a>03133     fprintf(fd, <span class="stringliteral">&quot;%sreturn eyedb::Success;\n}\n\n&quot;</span>, ctx-&gt;get());
<a name="l03134"></a>03134     ctx-&gt;pop();
<a name="l03135"></a>03135 
<a name="l03136"></a>03136     <span class="keywordflow">return</span> Success;
<a name="l03137"></a>03137   }
<a name="l03138"></a>03138 
<a name="l03139"></a>03139   <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03140"></a>03140   userImpl(FILE *fd)
<a name="l03141"></a>03141   {
<a name="l03142"></a>03142     fprintf(fd, <span class="stringliteral">&quot;  _packageInit(_db);\n&quot;</span>);
<a name="l03143"></a>03143     fprintf(fd, <span class="stringliteral">&quot;\n  //\n  // User Implementation\n  //\n\n&quot;</span>);
<a name="l03144"></a>03144     fprintf(fd, <span class="stringliteral">&quot;  return eyedb::Success;\n&quot;</span>);
<a name="l03145"></a>03145   }
<a name="l03146"></a>03146 
<a name="l03147"></a>03147   Status
<a name="l03148"></a>03148   Class::generateMethodBodyFE_C(Schema *m,
<a name="l03149"></a>03149                                 GenContext *ctx, Method *mth)
<a name="l03150"></a>03150   {
<a name="l03151"></a>03151     <span class="keywordflow">return</span> Success;
<a name="l03152"></a>03152   }
<a name="l03153"></a>03153 
<a name="l03154"></a>03154   Status
<a name="l03155"></a>03155   Class::generateMethodBodyBE_C(Schema *m,
<a name="l03156"></a>03156                                 GenContext *ctxStubs,
<a name="l03157"></a>03157                                 GenContext *ctxMth,
<a name="l03158"></a>03158                                 Method *mth)
<a name="l03159"></a>03159   {
<a name="l03160"></a>03160     FILE *fdstubs = ctxStubs-&gt;getFile();
<a name="l03161"></a>03161     FILE *fdmth = ctxMth-&gt;getFile();
<a name="l03162"></a>03162     Executable *ex = mth-&gt;getEx();
<a name="l03163"></a>03163 
<a name="l03164"></a>03164     Signature *sign = ex-&gt;getSign();
<a name="l03165"></a>03165     <span class="keyword">const</span> <span class="keywordtype">char</span> *intname =
<a name="l03166"></a>03166       Executable::makeInternalName(ex-&gt;getExname().c_str(),
<a name="l03167"></a>03167                                    sign,
<a name="l03168"></a>03168                                    (mth-&gt;getEx()-&gt;isStaticExec() ? True:
<a name="l03169"></a>03169                                     False),
<a name="l03170"></a>03170                                    (getAliasName() ?
<a name="l03171"></a>03171                                     getAliasName() : <a class="code" href="classeyedb_1_1Class.html#af38e817e4edaf5921e9ca05bd5e6367e" title="Not yet documented.">getName</a>()));
<a name="l03172"></a>03172   
<a name="l03173"></a>03173     <span class="comment">//const char *prefix = (mth-&gt;asFEMethod_C() ? &quot;FE&quot; : &quot;BE&quot;);</span>
<a name="l03174"></a>03174     <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix = ((ex-&gt;getLoc()&amp;~STATIC_EXEC) == FRONTEND ? <span class="stringliteral">&quot;FE&quot;</span> : <span class="stringliteral">&quot;BE&quot;</span>);
<a name="l03175"></a>03175     <span class="keyword">const</span> <span class="keywordtype">char</span> *lang = ((ex-&gt;getLang() &amp; C_LANG) ? <span class="stringliteral">&quot;C&quot;</span>  : <span class="stringliteral">&quot;OQL&quot;</span>);
<a name="l03176"></a>03176 
<a name="l03177"></a>03177     fprintf(fdmth, <span class="stringliteral">&quot;//\n// %s [%s.cc]\n//\n\n&quot;</span>, mth-&gt;getPrototype(),
<a name="l03178"></a>03178             mth-&gt;getEx()-&gt;getExtrefBody().c_str());
<a name="l03179"></a>03179     fprintf(fdmth, <span class="stringliteral">&quot;Status\n&quot;</span>);
<a name="l03180"></a>03180     fprintf(fdmth, <span class="stringliteral">&quot;__%s(eyedb::Database *_db, eyedb::%sMethod_%s *_m%s&quot;</span>,
<a name="l03181"></a>03181             intname,
<a name="l03182"></a>03182             prefix, lang,
<a name="l03183"></a>03183             (ex-&gt;isStaticExec() ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;, eyedb::Object *_o&quot;</span>));
<a name="l03184"></a>03184     
<a name="l03185"></a>03185     <span class="keywordflow">if</span> (sign-&gt;getNargs() || !Signature::isVoid(sign-&gt;getRettype()))
<a name="l03186"></a>03186       fprintf(fdmth, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l03187"></a>03187 
<a name="l03188"></a>03188     sign-&gt;declArgs(fdmth, m);
<a name="l03189"></a>03189 
<a name="l03190"></a>03190     fprintf(fdmth, <span class="stringliteral">&quot;)\n{\n&quot;</span>);
<a name="l03191"></a>03191     userImpl(fdmth);
<a name="l03192"></a>03192     fprintf(fdmth, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l03193"></a>03193 
<a name="l03194"></a>03194     fprintf(fdstubs, <span class="stringliteral">&quot;extern eyedb::Status __%s(eyedb::Database *_db, &quot;</span>
<a name="l03195"></a>03195             <span class="stringliteral">&quot;eyedb::%sMethod_%s *_m%s&quot;</span>,
<a name="l03196"></a>03196             intname,
<a name="l03197"></a>03197             prefix, lang,
<a name="l03198"></a>03198             (ex-&gt;isStaticExec() ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;, eyedb::Object *_o&quot;</span>));
<a name="l03199"></a>03199 
<a name="l03200"></a>03200     <span class="keywordflow">if</span> (sign-&gt;getNargs() || !Signature::isVoid(sign-&gt;getRettype()))
<a name="l03201"></a>03201       fprintf(fdstubs, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l03202"></a>03202 
<a name="l03203"></a>03203     sign-&gt;declArgs(fdstubs, m);
<a name="l03204"></a>03204     fprintf(fdstubs, <span class="stringliteral">&quot;);\n\n&quot;</span>);
<a name="l03205"></a>03205   
<a name="l03206"></a>03206     fprintf(fdstubs, <span class="stringliteral">&quot;extern \&quot;C\&quot; eyedb::Status\n&quot;</span>);
<a name="l03207"></a>03207     fprintf(fdstubs, <span class="stringliteral">&quot;%s(eyedb::Database *_db, eyedb::%sMethod_%s *_m, &quot;</span>
<a name="l03208"></a>03208             <span class="stringliteral">&quot;eyedb::Object *_o, eyedb::ArgArray &amp;_array, eyedb::Argument &amp;__retarg)\n{\n&quot;</span>,
<a name="l03209"></a>03209             intname,
<a name="l03210"></a>03210             prefix, lang);
<a name="l03211"></a>03211 
<a name="l03212"></a>03212     ctxStubs-&gt;push();
<a name="l03213"></a>03213     fprintf(fdstubs, <span class="stringliteral">&quot;%seyedb::Status status;\n\n&quot;</span>, ctxStubs-&gt;get());
<a name="l03214"></a>03214 
<a name="l03215"></a>03215     sign-&gt;initArgs(fdstubs, m, <span class="stringliteral">&quot;_array[%d]-&gt;&quot;</span>, <span class="stringliteral">&quot;_retarg&quot;</span>, ctxStubs-&gt;get());
<a name="l03216"></a>03216 
<a name="l03217"></a>03217     fprintf(fdstubs, <span class="stringliteral">&quot;\n%sstatus = __%s(_db, _m%s&quot;</span>, ctxStubs-&gt;get(), intname,
<a name="l03218"></a>03218             (ex-&gt;isStaticExec() ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;, _o&quot;</span>));
<a name="l03219"></a>03219 
<a name="l03220"></a>03220     <span class="keywordflow">if</span> (sign-&gt;getNargs() || !Signature::isVoid(sign-&gt;getRettype()))
<a name="l03221"></a>03221       fprintf(fdstubs, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l03222"></a>03222 
<a name="l03223"></a>03223     sign-&gt;listArgs(fdstubs, m);
<a name="l03224"></a>03224 
<a name="l03225"></a>03225     fprintf(fdstubs, <span class="stringliteral">&quot;);\n&quot;</span>);
<a name="l03226"></a>03226 
<a name="l03227"></a>03227     fprintf(fdstubs, <span class="stringliteral">&quot;%sif (status) return status;\n\n&quot;</span>, ctxStubs-&gt;get());
<a name="l03228"></a>03228 
<a name="l03229"></a>03229     sign-&gt;setArgs(fdstubs, m, OUT_ARG_TYPE, <span class="stringliteral">&quot;_array[%d]-&gt;&quot;</span>, <span class="stringliteral">&quot;__retarg.&quot;</span>,
<a name="l03230"></a>03230                   ctxStubs-&gt;get());
<a name="l03231"></a>03231 
<a name="l03232"></a>03232     fprintf(fdstubs, <span class="stringliteral">&quot;%sreturn eyedb::Success;\n}\n\n&quot;</span>, ctxStubs-&gt;get());
<a name="l03233"></a>03233     ctxStubs-&gt;pop();
<a name="l03234"></a>03234 
<a name="l03235"></a>03235     <span class="keywordflow">return</span> Success;
<a name="l03236"></a>03236   }
<a name="l03237"></a>03237 
<a name="l03238"></a>03238   Status
<a name="l03239"></a>03239   Class::generateTriggerBody_C(Schema *m,
<a name="l03240"></a>03240                                GenContext *ctxMth,
<a name="l03241"></a>03241                                Trigger *trig)
<a name="l03242"></a>03242   {
<a name="l03243"></a>03243     FILE *fdmth = ctxMth-&gt;getFile();
<a name="l03244"></a>03244 
<a name="l03245"></a>03245     fprintf(fdmth, <span class="stringliteral">&quot;//\n// %s\n//\n\n&quot;</span>, trig-&gt;getPrototype());
<a name="l03246"></a>03246     fprintf(fdmth, <span class="stringliteral">&quot;extern \&quot;C\&quot;\n&quot;</span>);
<a name="l03247"></a>03247     fprintf(fdmth, <span class="stringliteral">&quot;eyedb::Status %s(eyedb::TriggerType type, eyedb::Database *_db, &quot;</span>
<a name="l03248"></a>03248             <span class="stringliteral">&quot;const eyedb::Oid &amp;oid, eyedb::Object *o)\n{\n&quot;</span>,
<a name="l03249"></a>03249             trig-&gt;getCSym());
<a name="l03250"></a>03250     userImpl(fdmth);
<a name="l03251"></a>03251     fprintf(fdmth, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l03252"></a>03252     <span class="keywordflow">return</span> Success;
<a name="l03253"></a>03253   }
<a name="l03254"></a>03254 
<a name="l03255"></a>03255   Status
<a name="l03256"></a>03256   Class::generateMethodBody_C(Schema *m,
<a name="l03257"></a>03257                               GenContext *ctx,
<a name="l03258"></a>03258                               GenContext *ctxStubsFe,
<a name="l03259"></a>03259                               GenContext *ctxStubsBe,
<a name="l03260"></a>03260                               GenContext *ctxMthFe,
<a name="l03261"></a>03261                               GenContext *ctxMthBe)
<a name="l03262"></a>03262   {
<a name="l03263"></a>03263     <span class="keywordflow">if</span> (!<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCODE) &amp;&amp; !<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCOMP))
<a name="l03264"></a>03264       <span class="keywordflow">return</span> Success;
<a name="l03265"></a>03265 
<a name="l03266"></a>03266     LinkedListCursor c(complist);
<a name="l03267"></a>03267 
<a name="l03268"></a>03268     ClassComponent *comp;
<a name="l03269"></a>03269 
<a name="l03270"></a>03270     <span class="keywordflow">while</span> (c.getNext((<span class="keywordtype">void</span> *&amp;)comp))
<a name="l03271"></a>03271       <span class="keywordflow">if</span> (comp-&gt;asMethod()) {
<a name="l03272"></a>03272         Method *mth = comp-&gt;asMethod();
<a name="l03273"></a>03273         <span class="keywordflow">if</span> (!(mth-&gt;getEx()-&gt;getLang() &amp; C_LANG))
<a name="l03274"></a>03274           <span class="keywordflow">continue</span>;
<a name="l03275"></a>03275 
<a name="l03276"></a>03276         Signature *sign = mth-&gt;getEx()-&gt;getSign();
<a name="l03277"></a>03277 
<a name="l03278"></a>03278         <span class="keywordflow">if</span> (mth-&gt;asBEMethod())
<a name="l03279"></a>03279           generateMethodBodyBE_C(m, ctxStubsBe, ctxMthBe, mth);
<a name="l03280"></a>03280         <span class="keywordflow">else</span>
<a name="l03281"></a>03281           generateMethodBodyBE_C(m, ctxStubsFe, ctxMthFe, mth);
<a name="l03282"></a>03282 
<a name="l03283"></a>03283         <span class="keywordflow">if</span> (!mth-&gt;getUserData())
<a name="l03284"></a>03284           <span class="keywordflow">continue</span>;
<a name="l03285"></a>03285 
<a name="l03286"></a>03286         <span class="keywordflow">if</span> (sign-&gt;getUserData()) {
<a name="l03287"></a>03287           odlMethodHints *mth_hints = ((odlSignUserData *)sign-&gt;getUserData())-&gt;mth_hints;
<a name="l03288"></a>03288           <span class="keywordflow">if</span> (mth_hints-&gt;calledFrom != odlMethodHints::ANY_HINTS &amp;&amp;
<a name="l03289"></a>03289               mth_hints-&gt;calledFrom != odlMethodHints::C_HINTS)
<a name="l03290"></a>03290             <span class="keywordflow">continue</span>;
<a name="l03291"></a>03291         }
<a name="l03292"></a>03292         generateMethodBodyFE_C(m, ctx, mth);
<a name="l03293"></a>03293       }
<a name="l03294"></a>03294       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comp-&gt;asTrigger())
<a name="l03295"></a>03295         generateTriggerBody_C(m, ctxMthBe, comp-&gt;asTrigger());
<a name="l03296"></a>03296 
<a name="l03297"></a>03297     <span class="keywordflow">return</span> Success;
<a name="l03298"></a>03298   }
<a name="l03299"></a>03299 
<a name="l03300"></a>03300   Status
<a name="l03301"></a>03301   Class::generateCode_C(Schema *m,
<a name="l03302"></a>03302                         <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix,
<a name="l03303"></a>03303                         <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l03304"></a>03304                         <span class="keyword">const</span> <span class="keywordtype">char</span> *stubs,
<a name="l03305"></a>03305                         FILE *fdh,
<a name="l03306"></a>03306                         FILE *fdc, FILE *fdstubsfe,
<a name="l03307"></a>03307                         FILE *fdstubsbe,
<a name="l03308"></a>03308                         FILE *fdmthfe,
<a name="l03309"></a>03309                         FILE *fdmthbe)
<a name="l03310"></a>03310   {
<a name="l03311"></a>03311     GenContext ctxH(fdh), ctxC(fdc), ctxStubsFe(fdstubsfe),
<a name="l03312"></a>03312       ctxStubsBe(fdstubsbe), ctxMthFe(fdmthfe), ctxMthBe(fdmthbe);
<a name="l03313"></a>03313 
<a name="l03314"></a>03314     ctxC.push();
<a name="l03315"></a>03315     generateMethodBody_C(m, &amp;ctxC, &amp;ctxStubsFe, &amp;ctxStubsBe,
<a name="l03316"></a>03316                          &amp;ctxMthFe, &amp;ctxMthBe);
<a name="l03317"></a>03317     ctxC.pop();
<a name="l03318"></a>03318 
<a name="l03319"></a>03319     generateClassComponent_C(&amp;ctxC);
<a name="l03320"></a>03320     generateAttrComponent_C(&amp;ctxC);
<a name="l03321"></a>03321 
<a name="l03322"></a>03322     <span class="keywordflow">return</span> Success;
<a name="l03323"></a>03323   }
<a name="l03324"></a>03324 
<a name="l03325"></a>03325   Status
<a name="l03326"></a>03326   AgregatClass::generateCode_C(Schema *m,
<a name="l03327"></a>03327                                <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix,
<a name="l03328"></a>03328                                <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l03329"></a>03329                                <span class="keyword">const</span> <span class="keywordtype">char</span> *stubs,
<a name="l03330"></a>03330                                FILE *fdh,
<a name="l03331"></a>03331                                FILE *fdc, FILE *fdstubsfe,
<a name="l03332"></a>03332                                FILE *fdstubsbe,
<a name="l03333"></a>03333                                FILE *fdmthfe,
<a name="l03334"></a>03334                                FILE *fdmthbe)
<a name="l03335"></a>03335   {
<a name="l03336"></a>03336     GenContext ctxH(fdh), ctxC(fdc), ctxStubsFe(fdstubsfe),
<a name="l03337"></a>03337       ctxStubsBe(fdstubsbe), ctxMthFe(fdmthfe), ctxMthBe(fdmthbe);
<a name="l03338"></a>03338 
<a name="l03339"></a>03339     <span class="keywordtype">int</span> i;
<a name="l03340"></a>03340     Status status;
<a name="l03341"></a>03341 
<a name="l03342"></a>03342     phints = &amp;hints;
<a name="l03343"></a>03343     class_enums = hints.class_enums;
<a name="l03344"></a>03344     attr_cache  = hints.attr_cache;
<a name="l03345"></a>03345 
<a name="l03346"></a>03346     <span class="keywordflow">if</span> (<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCODE))
<a name="l03347"></a>03347       generateClassDesc_C(&amp;ctxC, <span class="stringliteral">&quot;&quot;</span>);
<a name="l03348"></a>03348 
<a name="l03349"></a>03349     generateClassComponent_C(&amp;ctxC);
<a name="l03350"></a>03350     generateAttrComponent_C(&amp;ctxC);
<a name="l03351"></a>03351 
<a name="l03352"></a>03352     <span class="keywordflow">if</span> (!<a class="code" href="classeyedb_1_1Object.html#a599f8a7f3828f3195238b0492f904460" title="Not yet documented.">getUserData</a>(odlGENCODE))
<a name="l03353"></a>03353       <span class="keywordflow">return</span> Success;
<a name="l03354"></a>03354 
<a name="l03355"></a>03355     fprintf(fdh, <span class="stringliteral">&quot;class %s : public %s {\n&quot;</span>, name, className(parent));
<a name="l03356"></a>03356 
<a name="l03357"></a>03357     ctxH.push();
<a name="l03358"></a>03358 
<a name="l03359"></a>03359     <span class="keywordflow">if</span> (stubs)
<a name="l03360"></a>03360       fprintf(fdh, <span class="stringliteral">&quot;#include \&quot;%s\&quot;\n&quot;</span>, stubs);
<a name="l03361"></a>03361 
<a name="l03362"></a>03362 <span class="preprocessor">#ifndef NO_COMMENTS</span>
<a name="l03363"></a>03363 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot;\n%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03364"></a>03364     fprintf(fdh, <span class="stringliteral">&quot;%s// %s Interface\n&quot;</span>, ctxH.get(), name);
<a name="l03365"></a>03365     fprintf(fdh, <span class="stringliteral">&quot;%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03366"></a>03366 <span class="preprocessor">#else</span>
<a name="l03367"></a>03367 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03368"></a>03368 <span class="preprocessor">#endif</span>
<a name="l03369"></a>03369 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot; public:\n&quot;</span>);
<a name="l03370"></a>03370   
<a name="l03371"></a>03371     ctxC.push();
<a name="l03372"></a>03372 
<a name="l03373"></a>03373     generateConstructors_C(&amp;ctxH, &amp;ctxC);
<a name="l03374"></a>03374 
<a name="l03375"></a>03375     <span class="keywordflow">if</span> (hints.gen_down_casting)
<a name="l03376"></a>03376       generateDownCasting_C(&amp;ctxH, m);
<a name="l03377"></a>03377 
<a name="l03378"></a>03378     <span class="keywordflow">for</span> (i = 0; i &lt; items_cnt; i++)
<a name="l03379"></a>03379       {
<a name="l03380"></a>03380         <span class="keywordflow">if</span> (items[i]-&gt;class_owner == (<span class="keywordtype">void</span> *)<span class="keyword">this</span>)
<a name="l03381"></a>03381           {
<a name="l03382"></a>03382             status = items[i]-&gt;generateCode_C(<span class="keyword">this</span>, hints, &amp;ctxH, &amp;ctxC);
<a name="l03383"></a>03383             <span class="keywordflow">if</span> (status)
<a name="l03384"></a>03384               <span class="keywordflow">return</span> status;
<a name="l03385"></a>03385           }
<a name="l03386"></a>03386       }
<a name="l03387"></a>03387 
<a name="l03388"></a>03388     ctxC.pop();
<a name="l03389"></a>03389     generateMethodBody_C(m, &amp;ctxC, &amp;ctxStubsFe, &amp;ctxStubsBe,
<a name="l03390"></a>03390                          &amp;ctxMthFe, &amp;ctxMthBe);
<a name="l03391"></a>03391     ctxC.push();
<a name="l03392"></a>03392 
<a name="l03393"></a>03393     <span class="comment">/* include file */</span>
<a name="l03394"></a>03394 
<a name="l03395"></a>03395     generateMethodDecl_C(m, &amp;ctxH);
<a name="l03396"></a>03396 
<a name="l03397"></a>03397     fprintf(fdh, <span class="stringliteral">&quot;%svirtual ~%s() {garbageRealize();}\n&quot;</span>, ctxH.get(),
<a name="l03398"></a>03398             name);
<a name="l03399"></a>03399 
<a name="l03400"></a>03400     <span class="keywordflow">if</span> (attr_cache)
<a name="l03401"></a>03401       fprintf(fdh, <span class="stringliteral">&quot;\n%svoid attrCacheEmpty();\n&quot;</span>, ctxH.get());
<a name="l03402"></a>03402 
<a name="l03403"></a>03403     <span class="keywordflow">if</span> (getTiedCode())
<a name="l03404"></a>03404       {
<a name="l03405"></a>03405 <span class="preprocessor">#ifndef NO_COMMENTS</span>
<a name="l03406"></a>03406 <span class="preprocessor"></span>        fprintf(fdh, <span class="stringliteral">&quot;\n%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03407"></a>03407 <span class="preprocessor">#endif</span>
<a name="l03408"></a>03408 <span class="preprocessor"></span>        fprintf(fdh, <span class="stringliteral">&quot;%s// %s User Part\n&quot;</span>, ctxH.get(), name);
<a name="l03409"></a>03409 <span class="preprocessor">#ifndef NO_COMMENTS</span>
<a name="l03410"></a>03410 <span class="preprocessor"></span>        fprintf(fdh, <span class="stringliteral">&quot;%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03411"></a>03411 <span class="preprocessor">#endif</span>
<a name="l03412"></a>03412 <span class="preprocessor"></span>        fprintf(fdh, <span class="stringliteral">&quot;%s\n&quot;</span>, getTiedCode());
<a name="l03413"></a>03413       }
<a name="l03414"></a>03414 
<a name="l03415"></a>03415 <span class="preprocessor">#ifndef NO_COMMENTS</span>
<a name="l03416"></a>03416 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot;\n%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03417"></a>03417     fprintf(fdh, <span class="stringliteral">&quot;%s// %s Protected Part\n&quot;</span>, ctxH.get(), name);
<a name="l03418"></a>03418     fprintf(fdh, <span class="stringliteral">&quot;%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03419"></a>03419 <span class="preprocessor">#else</span>
<a name="l03420"></a>03420 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03421"></a>03421 <span class="preprocessor">#endif</span>
<a name="l03422"></a>03422 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot; protected:\n&quot;</span>);
<a name="l03423"></a>03423 
<a name="l03424"></a>03424     <span class="keywordflow">if</span> (attr_cache &amp;&amp; !isRootClass())
<a name="l03425"></a>03425       fprintf(fdh, <span class="stringliteral">&quot;%svirtual void garbage();\n&quot;</span>, ctxH.get());
<a name="l03426"></a>03426 
<a name="l03427"></a>03427     <span class="comment">//  fprintf(fdh, &quot;%s%s(Database *_db, int) : &quot;, ctxH.get(), name);</span>
<a name="l03428"></a>03428     fprintf(fdh, <span class="stringliteral">&quot;%s%s(eyedb::Database *_db, const eyedb::Dataspace *_dataspace, int) : &quot;</span>, ctxH.get(), name);
<a name="l03429"></a>03429 
<a name="l03430"></a>03430     const_f0(fdh, parent, <span class="stringliteral">&quot;_db, _dataspace&quot;</span>);
<a name="l03431"></a>03431 
<a name="l03432"></a>03432     fprintf(fdh, <span class="stringliteral">&quot; {}\n&quot;</span>);
<a name="l03433"></a>03433     fprintf(fdh, <span class="stringliteral">&quot;%s%s(const eyedb::Struct *x, eyedb::Bool share, int) : &quot;</span>,
<a name="l03434"></a>03434             ctxH.get(), name);
<a name="l03435"></a>03435     const_f01(fdh, parent, <span class="stringliteral">&quot;x&quot;</span>);
<a name="l03436"></a>03436     fprintf(fdh, <span class="stringliteral">&quot; {}\n&quot;</span>);
<a name="l03437"></a>03437 
<a name="l03438"></a>03438     fprintf(fdh, <span class="stringliteral">&quot;%s%s(const %s *x, eyedb::Bool share, int) : &quot;</span>, ctxH.get(), name, name);
<a name="l03439"></a>03439     const_f01(fdh, parent, <span class="stringliteral">&quot;x&quot;</span>);
<a name="l03440"></a>03440 
<a name="l03441"></a>03441     fprintf(fdh, <span class="stringliteral">&quot; {}\n&quot;</span>);
<a name="l03442"></a>03442 
<a name="l03443"></a>03443 <span class="preprocessor">#ifndef NO_COMMENTS</span>
<a name="l03444"></a>03444 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot;\n%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03445"></a>03445     fprintf(fdh, <span class="stringliteral">&quot;%s// %s Private Part\n&quot;</span>, ctxH.get(), name);
<a name="l03446"></a>03446     fprintf(fdh, <span class="stringliteral">&quot;%s// ----------------------------------------------------------------------\n&quot;</span>, ctxH.get());
<a name="l03447"></a>03447 <span class="preprocessor">#else</span>
<a name="l03448"></a>03448 <span class="preprocessor"></span>    fprintf(fdh, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03449"></a>03449 <span class="preprocessor">#endif</span>
<a name="l03450"></a>03450 <span class="preprocessor"></span>
<a name="l03451"></a>03451     fprintf(fdh, <span class="stringliteral">&quot; private:\n&quot;</span>, ctxH.get());
<a name="l03452"></a>03452   
<a name="l03453"></a>03453     fprintf(fdh, <span class="stringliteral">&quot;%svoid initialize(eyedb::Database *_db);\n&quot;</span>, ctxH.get());
<a name="l03454"></a>03454 
<a name="l03455"></a>03455     <span class="keywordflow">if</span> (attr_cache)
<a name="l03456"></a>03456       {
<a name="l03457"></a>03457         fprintf(fdh, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03458"></a>03458         <span class="keywordtype">int</span> i;
<a name="l03459"></a>03459         <span class="keywordflow">for</span> (i = 0; i &lt; items_cnt; i++)
<a name="l03460"></a>03460           <span class="keywordflow">if</span> (items[i]-&gt;getClassOwner()-&gt;<a class="code" href="classeyedb_1_1Class.html#a6e050f5722e61299c03dbc09f612c110" title="Not yet documented.">compare</a>(<span class="keyword">this</span>))
<a name="l03461"></a>03461             items[i]-&gt;genAttrCacheDecl(&amp;ctxH);
<a name="l03462"></a>03462       }
<a name="l03463"></a>03463 
<a name="l03464"></a>03464     fprintf(fdh, <span class="stringliteral">&quot;\n public: /* restricted */\n&quot;</span>, ctxH.get());
<a name="l03465"></a>03465     fprintf(fdh, <span class="stringliteral">&quot;%s%s(const eyedb::Struct *, eyedb::Bool = eyedb::False);\n&quot;</span>,
<a name="l03466"></a>03466             ctxH.get(), name);
<a name="l03467"></a>03467     fprintf(fdh, <span class="stringliteral">&quot;%s%s(const %s *, eyedb::Bool = eyedb::False);\n&quot;</span>,
<a name="l03468"></a>03468             ctxH.get(), name, name);
<a name="l03469"></a>03469     fprintf(fdh, <span class="stringliteral">&quot;%s%s(const eyedb::Class *, eyedb::Data);\n&quot;</span>, ctxH.get(), name);
<a name="l03470"></a>03470 
<a name="l03471"></a>03471     fprintf(fdh, <span class="stringliteral">&quot;};\n\n&quot;</span>);
<a name="l03472"></a>03472 
<a name="l03473"></a>03473     ctxH.pop();
<a name="l03474"></a>03474     ctxC.pop();
<a name="l03475"></a>03475 
<a name="l03476"></a>03476     <span class="keywordflow">return</span> Success;
<a name="l03477"></a>03477   }
<a name="l03478"></a>03478 
<a name="l03479"></a>03479   Status EnumClass::generateClassDesc_C(GenContext *ctx)
<a name="l03480"></a>03480   {
<a name="l03481"></a>03481     FILE *fd = ctx-&gt;getFile();
<a name="l03482"></a>03482     Status status;
<a name="l03483"></a>03483 
<a name="l03484"></a>03484     fprintf(fd, <span class="stringliteral">&quot;static eyedb::Size %s_idr_objsz, %s_idr_psize;\n\n&quot;</span>, name, name);
<a name="l03485"></a>03485 
<a name="l03486"></a>03486     fprintf(fd, <span class="stringliteral">&quot;static eyedb::EnumClass *%s_make(eyedb::EnumClass *%s_class = 0, eyedb::Schema *m = 0)\n{\n&quot;</span>, name, name);
<a name="l03487"></a>03487 
<a name="l03488"></a>03488     ctx-&gt;push();
<a name="l03489"></a>03489     fprintf(fd, <span class="stringliteral">&quot;%sif (!%s_class)\n&quot;</span>, ctx-&gt;get(), name);
<a name="l03490"></a>03490     fprintf(fd, <span class="stringliteral">&quot;%s  return new eyedb::EnumClass(\&quot;%s\&quot;);\n&quot;</span>, ctx-&gt;get(), getAliasName());
<a name="l03491"></a>03491 
<a name="l03492"></a>03492     fprintf(fd, <span class="stringliteral">&quot;%seyedb::EnumItem *en[%d];\n&quot;</span>, ctx-&gt;get(), items_cnt);
<a name="l03493"></a>03493 
<a name="l03494"></a>03494     <span class="keywordtype">int</span> i;
<a name="l03495"></a>03495     <span class="keywordflow">for</span> (i = 0; i &lt; items_cnt; i++)
<a name="l03496"></a>03496       fprintf(fd, <span class="stringliteral">&quot;%sen[%d] = new eyedb::EnumItem(\&quot;%s\&quot;, \&quot;%s\&quot;, (unsigned int)%d);\n&quot;</span>,
<a name="l03497"></a>03497               ctx-&gt;get(),
<a name="l03498"></a>03498               i, items[i]-&gt;getName(), items[i]-&gt;getAliasName(),
<a name="l03499"></a>03499               items[i]-&gt;getValue());
<a name="l03500"></a>03500   
<a name="l03501"></a>03501     fprintf(fd, <span class="stringliteral">&quot;\n%s%s_class-&gt;setEnumItems(en, %d);\n&quot;</span>, ctx-&gt;get(),
<a name="l03502"></a>03502             name, items_cnt);
<a name="l03503"></a>03503 
<a name="l03504"></a>03504     fprintf(fd, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03505"></a>03505     <span class="keywordflow">for</span> (i = 0; i &lt; items_cnt; i++)
<a name="l03506"></a>03506       fprintf(fd, <span class="stringliteral">&quot;%sdelete en[%d];\n&quot;</span>, ctx-&gt;get(), i);
<a name="l03507"></a>03507     fprintf(fd, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03508"></a>03508 
<a name="l03509"></a>03509     <span class="keywordflow">if</span> (isSystem() || odl_system_class)
<a name="l03510"></a>03510       fprintf(fd, <span class="stringliteral">&quot;%seyedb::ClassPeer::setMType(%s_class, eyedb::Class::System);\n&quot;</span>,
<a name="l03511"></a>03511               ctx-&gt;get(), name);
<a name="l03512"></a>03512 
<a name="l03513"></a>03513     fprintf(fd, <span class="stringliteral">&quot;\n%sreturn %s_class;\n}\n\n&quot;</span>, ctx-&gt;get(), name);
<a name="l03514"></a>03514 
<a name="l03515"></a>03515     fprintf(fd, <span class="stringliteral">&quot;static void %s_init_p()\n{\n&quot;</span>, name);
<a name="l03516"></a>03516     fprintf(fd, <span class="stringliteral">&quot;%s%s%s = %s_make();\n&quot;</span>, ctx-&gt;get(), name, classSuffix, name);
<a name="l03517"></a>03517     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l03518"></a>03518 
<a name="l03519"></a>03519     fprintf(fd, <span class="stringliteral">&quot;static void %s_init()\n{\n&quot;</span>, name);
<a name="l03520"></a>03520     fprintf(fd, <span class="stringliteral">&quot;%s%s_make(%s%s);\n\n&quot;</span>, ctx-&gt;get(), name, name, classSuffix);
<a name="l03521"></a>03521 
<a name="l03522"></a>03522     fprintf(fd, <span class="stringliteral">&quot;%s%s_idr_objsz = %s%s-&gt;getIDRObjectSize(&amp;%s_idr_psize, 0);\n\n&quot;</span>,
<a name="l03523"></a>03523             ctx-&gt;get(), name, name, classSuffix, name);
<a name="l03524"></a>03524 
<a name="l03525"></a>03525     fprintf(fd, <span class="stringliteral">&quot;%seyedb::ObjectPeer::setUnrealizable(%s%s, eyedb::True);\n&quot;</span>,
<a name="l03526"></a>03526             ctx-&gt;get(), name, classSuffix);
<a name="l03527"></a>03527     fprintf(fd, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l03528"></a>03528     ctx-&gt;pop();
<a name="l03529"></a>03529 
<a name="l03530"></a>03530     <span class="keywordflow">return</span> Success;
<a name="l03531"></a>03531   }
<a name="l03532"></a>03532 
<a name="l03533"></a>03533   Status
<a name="l03534"></a>03534   EnumClass::generateCode_C(Schema *,
<a name="l03535"></a>03535                             <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix,
<a name="l03536"></a>03536                             <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l03537"></a>03537                             <span class="keyword">const</span> <span class="keywordtype">char</span> *stubs,
<a name="l03538"></a>03538                             FILE *fdh, FILE *fdc, FILE *,
<a name="l03539"></a>03539                             FILE *, FILE *, FILE *)
<a name="l03540"></a>03540   {
<a name="l03541"></a>03541     GenContext ctxH(fdh), ctxC(fdc);
<a name="l03542"></a>03542     <span class="keywordtype">int</span> i;
<a name="l03543"></a>03543     Status status;
<a name="l03544"></a>03544 
<a name="l03545"></a>03545     phints = &amp;hints;
<a name="l03546"></a>03546     class_enums = hints.class_enums;
<a name="l03547"></a>03547     attr_cache  = hints.attr_cache;
<a name="l03548"></a>03548 
<a name="l03549"></a>03549     generateClassDesc_C(&amp;ctxC);
<a name="l03550"></a>03550 
<a name="l03551"></a>03551     ctxH.push();
<a name="l03552"></a>03552     ctxC.push();
<a name="l03553"></a>03553 
<a name="l03554"></a>03554     <span class="comment">//  fprintf(fdh, &quot;\n&quot;);</span>
<a name="l03555"></a>03555 
<a name="l03556"></a>03556     <span class="keyword">const</span> <span class="keywordtype">char</span> *indent_str;
<a name="l03557"></a>03557 
<a name="l03558"></a>03558     <span class="keywordflow">if</span> (class_enums) {
<a name="l03559"></a>03559       fprintf(fdh, <span class="stringliteral">&quot;class %s {\n&quot;</span>, name);
<a name="l03560"></a>03560       fprintf(fdh, <span class="stringliteral">&quot;\npublic:\n&quot;</span>);
<a name="l03561"></a>03561       fprintf(fdh, <span class="stringliteral">&quot;  enum %s {\n&quot;</span>, enum_type);
<a name="l03562"></a>03562       indent_str = <span class="stringliteral">&quot;    &quot;</span>;
<a name="l03563"></a>03563     }
<a name="l03564"></a>03564     <span class="keywordflow">else</span> {
<a name="l03565"></a>03565       fprintf(fdh, <span class="stringliteral">&quot;enum %s {\n&quot;</span>, name);
<a name="l03566"></a>03566       indent_str = <span class="stringliteral">&quot;  &quot;</span>;
<a name="l03567"></a>03567     }
<a name="l03568"></a>03568 
<a name="l03569"></a>03569     EnumItem **it;
<a name="l03570"></a>03570     <span class="keywordflow">for</span> (i = 0, it = items; i &lt; items_cnt; i++, it++)
<a name="l03571"></a>03571       {
<a name="l03572"></a>03572         <span class="keywordflow">if</span> (i) fprintf(fdh, <span class="stringliteral">&quot;,\n&quot;</span>);
<a name="l03573"></a>03573         fprintf(fdh, <span class="stringliteral">&quot;%s%s = %d&quot;</span>, indent_str, 
<a name="l03574"></a>03574                 (*it)-&gt;getAliasName(), (*it)-&gt;getValue());
<a name="l03575"></a>03575       }
<a name="l03576"></a>03576 
<a name="l03577"></a>03577     <span class="keywordflow">if</span> (class_enums)
<a name="l03578"></a>03578       fprintf(fdh, <span class="stringliteral">&quot;\n  };&quot;</span>);
<a name="l03579"></a>03579 
<a name="l03580"></a>03580     fprintf(fdh, <span class="stringliteral">&quot;\n};\n\n&quot;</span>);
<a name="l03581"></a>03581 
<a name="l03582"></a>03582     ctxH.pop();
<a name="l03583"></a>03583     ctxC.pop();
<a name="l03584"></a>03584 
<a name="l03585"></a>03585     <span class="keywordflow">return</span> Success;
<a name="l03586"></a>03586   }
<a name="l03587"></a>03587 
<a name="l03588"></a>03588   Status CollectionClass::generateCode_C(Schema *,
<a name="l03589"></a>03589                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *prefix,
<a name="l03590"></a>03590                                          <span class="keyword">const</span> GenCodeHints &amp;hints,
<a name="l03591"></a>03591                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *stubs,
<a name="l03592"></a>03592                                          FILE *fdh,
<a name="l03593"></a>03593                                          FILE *fdc, FILE *, FILE *,
<a name="l03594"></a>03594                                          FILE *, FILE *)
<a name="l03595"></a>03595   {
<a name="l03596"></a>03596     GenContext ctxH(fdh), ctxC(fdc);
<a name="l03597"></a>03597     <span class="keywordtype">int</span> i;
<a name="l03598"></a>03598     Status status;
<a name="l03599"></a>03599     <span class="keyword">const</span> <span class="keywordtype">char</span> *c_name = <a class="code" href="classeyedb_1_1CollectionClass.html#a719c224b1e8f77645ccc15b9cea09c18" title="Not yet documented.">getCName</a>();
<a name="l03600"></a>03600     <span class="keyword">const</span> <span class="keywordtype">char</span> *_type = getCSuffix();
<a name="l03601"></a>03601 
<a name="l03602"></a>03602     phints = &amp;hints;
<a name="l03603"></a>03603     class_enums = hints.class_enums;
<a name="l03604"></a>03604     attr_cache  = hints.attr_cache;
<a name="l03605"></a>03605 
<a name="l03606"></a>03606     fprintf(fdc, <span class="stringliteral">&quot;static eyedb::%sClass *%s_make(eyedb::%sClass *cls = 0, eyedb::Schema *m = 0)\n{\n&quot;</span>, _type, c_name, _type);
<a name="l03607"></a>03607     ctxC.push();
<a name="l03608"></a>03608 
<a name="l03609"></a>03609     fprintf(fdc, <span class="stringliteral">&quot;%sif (!cls)\n%s  {\n&quot;</span>, ctxC.get(), ctxC.get());
<a name="l03610"></a>03610 
<a name="l03611"></a>03611     fprintf(fdc, <span class="stringliteral">&quot;%s    cls = new eyedb::%sClass((m ? m-&gt;getClass(\&quot;%s\&quot;) : %s%s), &quot;</span>,
<a name="l03612"></a>03612             ctxC.get(), _type, coll_class-&gt;getAliasName(), <span class="comment">// changed 27/04/00</span>
<a name="l03613"></a>03613             (coll_class-&gt;asCollectionClass() ? coll_class-&gt;getCName() :
<a name="l03614"></a>03614              className(coll_class)), classSuffix);
<a name="l03615"></a>03615 
<a name="l03616"></a>03616     <span class="keywordflow">if</span> (dim &gt; 1)
<a name="l03617"></a>03617       fprintf(fdc, <span class="stringliteral">&quot;%d);\n&quot;</span>, dim);
<a name="l03618"></a>03618     <span class="keywordflow">else</span>
<a name="l03619"></a>03619       fprintf(fdc, <span class="stringliteral">&quot;%s);\n&quot;</span>, (isref ? <span class="stringliteral">&quot;eyedb::True&quot;</span> : <span class="stringliteral">&quot;eyedb::False&quot;</span>));
<a name="l03620"></a>03620 
<a name="l03621"></a>03621     fprintf(fdc, <span class="stringliteral">&quot;%s    eyedb::ClassPeer::setMType(cls, eyedb::Class::System);\n&quot;</span>,
<a name="l03622"></a>03622             ctxC.get());
<a name="l03623"></a>03623     fprintf(fdc, <span class="stringliteral">&quot;%s  }\n&quot;</span>, ctxC.get());
<a name="l03624"></a>03624 
<a name="l03625"></a>03625     fprintf(fdc, <span class="stringliteral">&quot;%sreturn cls;\n&quot;</span>, ctxC.get());
<a name="l03626"></a>03626     fprintf(fdc, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l03627"></a>03627 
<a name="l03628"></a>03628     fprintf(fdc, <span class="stringliteral">&quot;static void %s_init_p()\n{\n&quot;</span>, c_name);
<a name="l03629"></a>03629     fprintf(fdc, <span class="stringliteral">&quot;%s%s%s = %s_make();\n&quot;</span>, ctxC.get(), c_name, classSuffix, c_name);
<a name="l03630"></a>03630     fprintf(fdc, <span class="stringliteral">&quot;}\n\n&quot;</span>);
<a name="l03631"></a>03631 
<a name="l03632"></a>03632     <span class="keywordflow">return</span> Success;
<a name="l03633"></a>03633   }
<a name="l03634"></a>03634 }
<a name="l03635"></a>03635   
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 26 10:25:02 2010 for eyedb by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
